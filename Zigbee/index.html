<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota. Open source firmware for ESP8266 devices with easy configuration using webUI, OTA updates, automation using timers or rules, expandability and entirely local control over MQTT, HTTP, serial or KNX."><link href=https://tasmota.github.io/docs/Zigbee/ rel=canonical><link rel="shortcut icon" href=../_media/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-5.1.6"><title>Zigbee - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.4b9ffd7b.min.css><link rel=stylesheet href=../assets/stylesheets/palette.b79bcd20.min.css><meta name=theme-color content=#2196f3><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Barlow",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-140681905-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#zigbee-introduction class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://tasmota.github.io/docs/ title=Tasmota class="md-header-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Tasmota </span> <span class="md-header-nav__topic md-ellipsis"> Zigbee </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class="md-tabs__link md-tabs__link--active"> Features </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://tasmota.github.io/docs/ title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Home class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../About/ title=About class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ title=Upgrading class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ title=MQTT class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ title=Commands class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ title=Templates class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ title=Components class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ title=Modules class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Peripherals/ title=Peripherals class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../WebUI/ title=WebUI class=md-nav__link> WebUI </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12 type=checkbox id=nav-12 checked> <label class=md-nav__link for=nav-12> Features <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Features data-md-level=1> <label class=md-nav__title for=nav-12> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ title="Buttons and Switches" class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ title="Device Groups" class=md-nav__link> Device Groups </a> </li> <li class=md-nav__item> <a href=../Lights/ title=Lights class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ title="PIR Motion Sensors" class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ title="Power Monitoring Calibration" class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ title="PWM Dimmer" class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../Rules/ title=Rules class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ title="Shutters and Blinds" class=md-nav__link> Shutters and Blinds </a> </li> <li class=md-nav__item> <a href=../Timers/ title=Timers class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ title=TuyaMCU class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ title=Bluetooth class=md-nav__link> Bluetooth </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Zigbee <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title=Zigbee class="md-nav__link md-nav__link--active"> Zigbee </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#zigbee-introduction class=md-nav__link> Zigbee Introduction </a> </li> <li class=md-nav__item> <a href=#required-hardware class=md-nav__link> Required Hardware </a> </li> <li class=md-nav__item> <a href=#configuration class=md-nav__link> Configuration </a> <nav class=md-nav aria-label=Configuration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#flash-zigbee-adapter class=md-nav__link> Flash Zigbee Adapter </a> </li> <li class=md-nav__item> <a href=#flash-tasmota class=md-nav__link> Flash Tasmota </a> </li> <li class=md-nav__item> <a href=#connect-zigbee-adapter-to-tasmota class=md-nav__link> Connect Zigbee Adapter to Tasmota </a> </li> <li class=md-nav__item> <a href=#tasmota-settings class=md-nav__link> Tasmota Settings </a> </li> <li class=md-nav__item> <a href=#first-run class=md-nav__link> First Run </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> </li> <li class=md-nav__item> <a href=#pairing-zigbee-devices class=md-nav__link> Pairing Zigbee Devices </a> <nav class=md-nav aria-label="Pairing Zigbee Devices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#zigbee-friendly-names class=md-nav__link> Zigbee Friendly Names </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reading-sensors class=md-nav__link> Reading Sensors </a> </li> <li class=md-nav__item> <a href=#device-information class=md-nav__link> Device Information </a> <nav class=md-nav aria-label="Device Information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#understanding-endpoints class=md-nav__link> Understanding Endpoints </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sending-commands class=md-nav__link> Sending Commands </a> <nav class=md-nav aria-label="Sending Commands"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#low-level-commands class=md-nav__link> Low-level Commands </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#receiving-commands class=md-nav__link> Receiving Commands </a> </li> <li class=md-nav__item> <a href=#zigbee-groups class=md-nav__link> Zigbee Groups </a> </li> <li class=md-nav__item> <a href=#zigbee-binding class=md-nav__link> Zigbee Binding </a> </li> <li class=md-nav__item> <a href=#zigbee-and-hue-emulation-for-alexa class=md-nav__link> Zigbee and Hue Emulation for Alexa </a> </li> <li class=md-nav__item> <a href=#specific-device-tutorials class=md-nav__link> Specific Device Tutorials </a> <nav class=md-nav aria-label="Specific Device Tutorials"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#osram-mini-switch-and-plug class=md-nav__link> OSRAM mini switch and plug </a> </li> <li class=md-nav__item> <a href=#philips-hue-motion-sensor class=md-nav__link> Philips Hue Motion Sensor </a> </li> <li class=md-nav__item> <a href=#ikea-onoff-switch-e1743 class=md-nav__link> Ikea ON/OFF Switch (E1743) </a> </li> <li class=md-nav__item> <a href=#aqara-water-leak-sensor-sjcgq11lm class=md-nav__link> Aqara Water Leak Sensor (SJCGQ11LM) </a> </li> <li class=md-nav__item> <a href=#unrecognized-commands-or-attributes class=md-nav__link> Unrecognized commands or attributes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#zigbee2tasmota-status-codes class=md-nav__link> Zigbee2Tasmota Status Codes </a> </li> <li class=md-nav__item> <a href=#zigbee-internals class=md-nav__link> Zigbee internals </a> <nav class=md-nav aria-label="Zigbee internals"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cc2530-serial-protocol class=md-nav__link> CC2530 Serial protocol </a> </li> <li class=md-nav__item> <a href=#state-machine-cc2530-initialization-and-configuration class=md-nav__link> State machine - CC2530 initialization and configuration </a> </li> <li class=md-nav__item> <a href=#pairing-devices class=md-nav__link> Pairing devices </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ title="IR Communication" class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ title=DeepSleep class=md-nav__link> DeepSleep </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ title="Dynamic Sleep" class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../I2CDevices/ title="I2C Devices" class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ title=Scripting class=md-nav__link> Scripting </a> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ title="Smart Meter Interface" class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../TasmotaSlave/ title=TasmotaSlave class=md-nav__link> TasmotaSlave </a> </li> <li class=md-nav__item> <a href=../Subscribe-%26-Unsubscribe/ title="Subscribe & Unsubscribe" class=md-nav__link> Subscribe & Unsubscribe </a> </li> <li class=md-nav__item> <a href=../TLS/ title="TLS Secured MQTT" class=md-nav__link> TLS Secured MQTT </a> </li> <li class=md-nav__item> <a href=../Tutorials/ title=Tutorials class=md-nav__link> Tutorials </a> </li> <li class=md-nav__item> <a href=../For-Developers/ title="For Developers" class=md-nav__link> For Developers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-13 type=checkbox id=nav-13> <label class=md-nav__link for=nav-13> Smart Home Integrations <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Smart Home Integrations" data-md-level=1> <label class=md-nav__title for=nav-13> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../Alexa/ title=Alexa class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ title="AWS IoT" class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ title=Domoticz class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ title="Home Assistant" class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ title=Homebridge class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ title=HomeSeer class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ title="IP Symcon" class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ title=KNX class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ title=NodeRed class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ title=nymea class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../Octoprint/ title=OctoPrint class=md-nav__link> OctoPrint </a> </li> <li class=md-nav__item> <a href=../openHAB/ title=openHAB class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ title=Otto class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 title=IOBroker class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter title="Mozilla WebThings Adapter" class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/BrettSheleski/SmartThingsPublic/tree/master/devicetypes/brettsheleski/sonoff-tasmota.src title=SmartThings class=md-nav__link> SmartThings </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-14 type=checkbox id=nav-14> <label class=md-nav__link for=nav-14> Peripherals <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Peripherals data-md-level=1> <label class=md-nav__title for=nav-14> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Peripherals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Supported-Peripherals/ title="Supported Peripherals" class=md-nav__link> Supported Peripherals </a> </li> <li class=md-nav__item> <a href=../ADC/ title="Analog pin" class=md-nav__link> Analog pin </a> </li> <li class=md-nav__item> <a href=../Buzzer/ title=Buzzer class=md-nav__link> Buzzer </a> </li> <li class=md-nav__item> <a href=../Displays/ title=Displays class=md-nav__link> Displays </a> </li> <li class=md-nav__item> <a href=../ESP32/ title="ESP32 Support (Early alpha development)" class=md-nav__link> ESP32 Support (Early alpha development) </a> </li> <li class=md-nav__item> <a href=../A4988-Stepper-Motor-Controller/ title="A4988 stepper motor controller" class=md-nav__link> A4988 stepper motor controller </a> </li> <li class=md-nav__item> <a href=../AHT1x/ title="AHT1x temperature and humidity sensor" class=md-nav__link> AHT1x temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../AM2301/ title="AM2301 temperature and humidity sensor" class=md-nav__link> AM2301 temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../APDS-9960/ title="APDS-9960 light and gesture sensor" class=md-nav__link> APDS-9960 light and gesture sensor </a> </li> <li class=md-nav__item> <a href=../AS3935/ title="AS3935 Franklin Lightning sensor" class=md-nav__link> AS3935 Franklin Lightning sensor </a> </li> <li class=md-nav__item> <a href=../AZ-7798/ title="AZ7798 CO2 meter" class=md-nav__link> AZ7798 CO<sub>2</sub> meter </a> </li> <li class=md-nav__item> <a href=../BH1750/ title="BH1750 ambient light sensor" class=md-nav__link> BH1750 ambient light sensor </a> </li> <li class=md-nav__item> <a href=../BME280/ title="BME280 temperature, humidity and pressure sensor" class=md-nav__link> BME280 temperature, humidity and pressure sensor </a> </li> <li class=md-nav__item> <a href=../BME680/ title="BME680 temperature, humidity, pressure and gas sensor" class=md-nav__link> BME680 temperature, humidity, pressure and gas sensor </a> </li> <li class=md-nav__item> <a href=../CC2530/ title="CC2530 Zigbee module" class=md-nav__link> CC2530 Zigbee module </a> </li> <li class=md-nav__item> <a href=../Moisture-Sensor-and-Chirp%21-Sensor/ title="Chirp! moisture sensor" class=md-nav__link> Chirp! moisture sensor </a> </li> <li class=md-nav__item> <a href=../DHT11/ title="DHT11 temperature and humidity sensor" class=md-nav__link> DHT11 temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../DS18x20/ title="DS18x20 temperature sensor" class=md-nav__link> DS18x20 temperature sensor </a> </li> <li class=md-nav__item> <a href=../DS3231/ title="DS3231 Real Time Clock" class=md-nav__link> DS3231 Real Time Clock </a> </li> <li class=md-nav__item> <a href=../HM-10/ title="HM-10 Bluetooth module" class=md-nav__link> HM-10 Bluetooth module </a> </li> <li class=md-nav__item> <a href=../HM-17/ title="HM-17 Bluetooth module" class=md-nav__link> HM-17 Bluetooth module </a> </li> <li class=md-nav__item> <a href=../HC-SR04/ title="HC-SR04 ultrasonic ranging sensor" class=md-nav__link> HC-SR04 ultrasonic ranging sensor </a> </li> <li class=md-nav__item> <a href=../Honeywell-HIH/ title="Honeywell HIH temperature and humidity sensor" class=md-nav__link> Honeywell HIH temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../IAQ/ title="iAQ-Core indoor air quality sensor" class=md-nav__link> iAQ-Core indoor air quality sensor </a> </li> <li class=md-nav__item> <a href=../IR-Remote/ title="IR Remote" class=md-nav__link> IR Remote </a> </li> <li class=md-nav__item> <a href=../LM75AD/ title="LM75AD temperature sensor" class=md-nav__link> LM75AD temperature sensor </a> </li> <li class=md-nav__item> <a href=../MCP230xx/ title="MCP23008 / MCP23017 GPIO Expander" class=md-nav__link> MCP23008 / MCP23017 GPIO Expander </a> </li> <li class=md-nav__item> <a href=../MGC3130/ title="MGC3130 3D tracking and gesture controller" class=md-nav__link> MGC3130 3D tracking and gesture controller </a> </li> <li class=md-nav__item> <a href=../MH-Z19B/ title="MH-Z19B CO2 Sensor" class=md-nav__link> MH-Z19B CO<sub>2</sub> Sensor </a> </li> <li class=md-nav__item> <a href=../MLX90614/ title="MLX90614 infrared thermometer" class=md-nav__link> MLX90614 infrared thermometer </a> </li> <li class=md-nav__item> <a href=../MPR121/ title="MPR121 capacitive touch sensor" class=md-nav__link> MPR121 capacitive touch sensor </a> </li> <li class=md-nav__item> <a href=../MPU-6050/ title="MPU-6050 gyroscope and accelerometer" class=md-nav__link> MPU-6050 gyroscope and accelerometer </a> </li> <li class=md-nav__item> <a href=../NRF24L01/ title="NRF24L01 Bluetooth module" class=md-nav__link> NRF24L01 Bluetooth module </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ title=OpenTherm class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../P1-Smart-Meter/ title="Kaifa MA105C Energy Meter" class=md-nav__link> Kaifa MA105C Energy Meter </a> </li> <li class=md-nav__item> <a href=../PAJ7620/ title="PAJ7620U2 gesture sensor" class=md-nav__link> PAJ7620U2 gesture sensor </a> </li> <li class=md-nav__item> <a href=../PCA9685/ title="PCA9685 12-bit PWM controller" class=md-nav__link> PCA9685 12-bit PWM controller </a> </li> <li class=md-nav__item> <a href=../PN532/ title="PN532 NFC reader" class=md-nav__link> PN532 NFC reader </a> </li> <li class=md-nav__item> <a href=../PZEM-0XX/ title="PZEM-0xx power monitor" class=md-nav__link> PZEM-0xx power monitor </a> </li> <li class=md-nav__item> <a href=../RCWL-0516/ title="RCWL-0516 microwave radar motion sensor" class=md-nav__link> RCWL-0516 microwave radar motion sensor </a> </li> <li class=md-nav__item> <a href=../RDM6300/ title="RDM6300 RFID reader" class=md-nav__link> RDM6300 RFID reader </a> </li> <li class=md-nav__item> <a href=../SDS011/ title="SDS011 air quality sensor" class=md-nav__link> SDS011 air quality sensor </a> </li> <li class=md-nav__item> <a href=../SHT30/ title="SHT30 temperature sensor" class=md-nav__link> SHT30 temperature sensor </a> </li> <li class=md-nav__item> <a href=../TX2x/ title="TX20/TX23 anemometer" class=md-nav__link> TX20/TX23 anemometer </a> </li> <li class=md-nav__item> <a href=../TSL2561/ title="TSL2561 light sensor" class=md-nav__link> TSL2561 light sensor </a> </li> <li class=md-nav__item> <a href=../VEML6070/ title="VEML6070 UV light sensor" class=md-nav__link> VEML6070 UV light sensor </a> </li> <li class=md-nav__item> <a href=../VL53L0x/ title="VL53L0X laser ranging module" class=md-nav__link> VL53L0X laser ranging module </a> </li> <li class=md-nav__item> <a href=../WS2812B-RGB-Shield/ title="WS2812B RGB Shield" class=md-nav__link> WS2812B RGB Shield </a> </li> <li class=md-nav__item> <a href=../WS2812B-and-WS2813/ title="WS2812B and WS2813" class=md-nav__link> WS2812B and WS2813 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-15 type=checkbox id=nav-15> <label class=md-nav__link for=nav-15> Supported Devices <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Supported Devices" data-md-level=1> <label class=md-nav__title for=nav-15> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ title="Configure Unknown Device" class=md-nav__link> Configure Unknown Device </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' title="All Supported Devices" class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ title="Supported Modules" class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-16 type=checkbox id=nav-16> <label class=md-nav__link for=nav-16> Help <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Help data-md-level=1> <label class=md-nav__title for=nav-16> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ title=FAQ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ title=Troubleshooting class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ title="Device Recovery" class=md-nav__link> Device Recovery </a> </li> <li class=md-nav__item> <a href="http://thehackbox.org/tasmota/release/ " target='_blank""' title="Discord Support" class=md-nav__link> Discord Support </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Compile-your-build/ title=Compiling class=md-nav__link> Compiling </a> </li> <li class=md-nav__item> <a href=../Contributing/ title=Contributing class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href="http://thehackbox.org/tasmota/release/ " target='_blank""' title=Download class=md-nav__link> Download </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#zigbee-introduction class=md-nav__link> Zigbee Introduction </a> </li> <li class=md-nav__item> <a href=#required-hardware class=md-nav__link> Required Hardware </a> </li> <li class=md-nav__item> <a href=#configuration class=md-nav__link> Configuration </a> <nav class=md-nav aria-label=Configuration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#flash-zigbee-adapter class=md-nav__link> Flash Zigbee Adapter </a> </li> <li class=md-nav__item> <a href=#flash-tasmota class=md-nav__link> Flash Tasmota </a> </li> <li class=md-nav__item> <a href=#connect-zigbee-adapter-to-tasmota class=md-nav__link> Connect Zigbee Adapter to Tasmota </a> </li> <li class=md-nav__item> <a href=#tasmota-settings class=md-nav__link> Tasmota Settings </a> </li> <li class=md-nav__item> <a href=#first-run class=md-nav__link> First Run </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> </li> <li class=md-nav__item> <a href=#pairing-zigbee-devices class=md-nav__link> Pairing Zigbee Devices </a> <nav class=md-nav aria-label="Pairing Zigbee Devices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#zigbee-friendly-names class=md-nav__link> Zigbee Friendly Names </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reading-sensors class=md-nav__link> Reading Sensors </a> </li> <li class=md-nav__item> <a href=#device-information class=md-nav__link> Device Information </a> <nav class=md-nav aria-label="Device Information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#understanding-endpoints class=md-nav__link> Understanding Endpoints </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sending-commands class=md-nav__link> Sending Commands </a> <nav class=md-nav aria-label="Sending Commands"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#low-level-commands class=md-nav__link> Low-level Commands </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#receiving-commands class=md-nav__link> Receiving Commands </a> </li> <li class=md-nav__item> <a href=#zigbee-groups class=md-nav__link> Zigbee Groups </a> </li> <li class=md-nav__item> <a href=#zigbee-binding class=md-nav__link> Zigbee Binding </a> </li> <li class=md-nav__item> <a href=#zigbee-and-hue-emulation-for-alexa class=md-nav__link> Zigbee and Hue Emulation for Alexa </a> </li> <li class=md-nav__item> <a href=#specific-device-tutorials class=md-nav__link> Specific Device Tutorials </a> <nav class=md-nav aria-label="Specific Device Tutorials"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#osram-mini-switch-and-plug class=md-nav__link> OSRAM mini switch and plug </a> </li> <li class=md-nav__item> <a href=#philips-hue-motion-sensor class=md-nav__link> Philips Hue Motion Sensor </a> </li> <li class=md-nav__item> <a href=#ikea-onoff-switch-e1743 class=md-nav__link> Ikea ON/OFF Switch (E1743) </a> </li> <li class=md-nav__item> <a href=#aqara-water-leak-sensor-sjcgq11lm class=md-nav__link> Aqara Water Leak Sensor (SJCGQ11LM) </a> </li> <li class=md-nav__item> <a href=#unrecognized-commands-or-attributes class=md-nav__link> Unrecognized commands or attributes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#zigbee2tasmota-status-codes class=md-nav__link> Zigbee2Tasmota Status Codes </a> </li> <li class=md-nav__item> <a href=#zigbee-internals class=md-nav__link> Zigbee internals </a> <nav class=md-nav aria-label="Zigbee internals"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cc2530-serial-protocol class=md-nav__link> CC2530 Serial protocol </a> </li> <li class=md-nav__item> <a href=#state-machine-cc2530-initialization-and-configuration class=md-nav__link> State machine - CC2530 initialization and configuration </a> </li> <li class=md-nav__item> <a href=#pairing-devices class=md-nav__link> Pairing devices </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/Zigbee.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Zigbee</h1> <div class="admonition info"> <p class=admonition-title>Zigbee2Tasmota serves as a gateway for devices connected to a Zigbee wireless network to bridge their communications over to Wi-Fi</p> </div> <p>Zigbee2Tasmota is a lightweight Zigbee solution running on an ESP82xx Wi-Fi chip. Hence it is easier to deploy wherever you want in your home. It is largely inspired by <a href=https://www.zigbee2mqtt.io/ >Zigbee2mqtt</a> but it's a complete rewrite to make it fit on an ESP82xx with 80kB of RAM and only 1MB of flash memory.</p> <p>A list of compatible coordinators and Zigbee devices is maintained in the <a href=https://zigbee.blakadder.com/zigbee2tasmota.html>Zigbee Device Compatibility Repository</a>. </p> <h2 id=zigbee-introduction>Zigbee Introduction<a class=headerlink href=#zigbee-introduction title="Permanent link">~</a></h2> <p>Before using Zigbee to Tasmota, you need to understand a few concepts. Here is a simplified comparison to the Wi-Fi equivalent (sort of).</p> <table> <thead> <tr> <th>Zigbee concept</th> <th>Wi-Fi equivalent</th> </tr> </thead> <tbody> <tr> <td><strong>Zigbee coordinator</strong><br>The coordinator is responsible for selecting the channel, PanID, security policy, and stack profile for a network. Zigbee2Tasmota will act as a coordinator.<br>You can have multiple coordinators as long as they have different PanIDs.</td> <td>Wi-Fi Access Point</td> </tr> <tr> <td><strong>PanID</strong><br>(Personal Area Network IDentifier)<br>This parameter is unique in a Zigbee network (16-bit integer, 0x0000–0x3FFF).<br><em>Default: 0x1A63</em></td> <td>SSID (the Wi-Fi network name)</td> </tr> <tr> <td><strong>ShortAddr</strong><br>Address of the device on the Zigbee network. This address is randomly assigned when the device first connects to the coordinator (16 bits integer, 0x0000–0xFFF7). The coordinator has address 0x0000.<br>You need to track which device has which address or assing a "Friendly Name" to each new discovered device.</td> <td>IP address</td> </tr> <tr> <td><strong>GroupAddr</strong><br>Group address of a collection of devices, it allows a single message to address multiple devices at once (16 bits integer, 0x0000–0xFFFF). For example a remote can turn on/off a group of lights. GroupAddr 0x0000 is not assigned.</td> <td>Multicast</td> </tr> <tr> <td><strong>Endpoint</strong><br>The endpoint on the coordinator or on the Zigbee device the message is sent from/to. You can see endpoints as logical device providing distinct features (8 bits integer, 1–240).</td> <td>IP Port</td> </tr> <tr> <td><strong>IEEEAddr</strong><br>Device hardware address (64 bits). This is unique per device and factory assigned.</td> <td>MAC address</td> </tr> <tr> <td><strong>Channel</strong> 11-26<br><em>Default: 11</em> (See <a href=https://www.metageek.com/training/resources/zigbee-wifi-coexistence.html>Zigbee-Wifi coexistence</a>)</td> <td>Wi-Fi Channel</td> </tr> <tr> <td><strong>Encryption Key</strong><br>128-bit encryption key.<br><em>default: 0x0D0C0A08060402000F0D0B0907050301</em></td> <td>Wi-Fi password</td> </tr> <tr> <td><strong>Pairing</strong><br>By default the coordinator does not accept new devices unless put in pairing mode. When in pairing mode, it will accept pairing requests from any device within range.<br><em>Default: pairing disabled</em></td> <td>WPS</td> </tr> </tbody> </table> <h2 id=required-hardware>Required Hardware<a class=headerlink href=#required-hardware title="Permanent link">~</a></h2> <h4>TI CC253x Zigbee Adapter</h4> <p>Any TI CC2530 or CC2531 chip based module can serve as a coordinator. See <a href=https://zigbee.blakadder.com/zigbee2tasmota.html>list of supported modules</a> with their pinouts and flashing instructions. </p> <div class="admonition info"> <p class=admonition-title>Devices based on CC2531 <em>can</em> be used with Tasmota but <em>not in USB mode</em>!</p> <p>Normally CC2531 supports USB communication, but Zigbee2Tasmota requires serial communication. When CC2530 firmware is flashed onto a CC2531, the CC2531 can be wired up for serial serial communication as described below.</p> </div> <p>These PCB make all the connections required to flash the CC2530 and to run Z2T. </p> <h4>SuperHouse.tv</h4> <p>Jon Oxer created a <a href=https://github.com/SuperHouse/Z2T>custom PCB</a> to connect a Wemos D1 Mini and a CC2530 board (with or without CC2591). </p> <p><img alt=Pinout src=../_media/zigbee/superhouse-z2t.jpg></p> <h4>H4NC</h4> <p>User <em><strong>h4nc</strong></em> created a <a href=https://github.com/h4nc/Zigbee2Tasmota_PCB>custom PCB</a> to connect a NodeMCU and a CC2530 board. </p> <p>You can also get a complete Z2T module with case, pre-flashed and ready to configure and deploy.<br> <img alt=Pinout src=../_media/zigbee/Z2T.jpg></p> <h4>Wi-Fi Adapter</h4> <p>Using an ESP82xx device such as a Wemos D1 Mini or a NodeMCU to flash the CC2530 is a lower cost alternative than using a single purpose <a href=https://www.aliexpress.com/item/32869263224.html>CC_DEBUGGER</a>. </p> <p>In normal operation two free GPIOs are needed for the serial communication with the CC2530. </p> <h2 id=configuration>Configuration<a class=headerlink href=#configuration title="Permanent link">~</a></h2> <h3 id=flash-zigbee-adapter>Flash Zigbee Adapter<a class=headerlink href=#flash-zigbee-adapter title="Permanent link">~</a></h3> <p>Zigbee2Tasmota requires a TI CC253x based module flashed with <a href=https://github.com/Koenkk/Z-Stack-firmware/tree/master/coordinator/Z-Stack_Home_1.2/bin/default>Z-Stack CC2530 firmware file</a> from <a href=https://github.com/Koenkk>Koen Kanters</a>. </p> <p>Due to memory constraints of the CC253x, you can only pair 16 devices to a coordinator (<a href=https://github.com/Koenkk/Z-Stack-firmware/tree/master/coordinator>See details</a>). </p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>There is an alternative firmware allowing for Zigbee routers to create a mesh network and go beyond 16 devices. This is currently tested and in development.</p> </div> <p>Flashing options:</p> <ul> <li>Flashing with <a href=https://zigbee.blakadder.com/flashing_ccloader.html>CCLoader</a> and ESP8266 <mark>(recommended)</mark></li> <li>Flashing with <a href=../Zigbee-CCLib-Flashing/ >CCLib</a> and ESP8266</li> <li>Flash with a dedicated <a href=https://ptvo.info/how-to-select-and-flash-cc2530-144/ >CC Debugger</a> and Windows PC </li> <li>Flash with <a href=https://github.com/jmichault/flash_cc2531>RaspberryPi</a> </li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Flash the CC2531 USB Stick with the <a href=https://github.com/Koenkk/Z-Stack-firmware/tree/master/coordinator/Z-Stack_Home_1.2/bin/default>Z-Stack CC2530</a> firmware file as mentioned above. Not with the CC2531 Firmware!</p> </div> <h3 id=flash-tasmota>Flash Tasmota<a class=headerlink href=#flash-tasmota title="Permanent link">~</a></h3> <p>Once the Zigbee adapter flashing process completes, you can re-use the ESP82xx and flash Tasmota with Zigbee2Tasmota enabled firmware. Otherwise, you can use any ESP82xx device. </p> <div class="admonition failure"> <p class=admonition-title>Zigbee feature is not included in precompiled binaries</p> </div> <p>To use it you must <a href=../Compile-your-build/ >compile your build</a>. Add the following to <code>user_config_override.h</code>:</p> <div class=codehilite><pre><span></span><code><span class=cp>#define USE_ZIGBEE </span>
</code></pre></div> <h4>Optional</h4> <p>Run the ESP at 160MHz instead of 80MHz which ensures higher reliability in serial communication with CC2530.</p> <p>In <code>platformio_override.ini</code> uncomment line 51:</p> <p><code>board_build.f_cpu = 160000000L</code></p> <p>If you find that your Zigbee2Tasmota operation is unstable, you may have an ESP82xx device that cannot operate reliably at the higher frequency. If you are using hardware serial (see below) and you still have unreliability, try compiling for 80MHz (reverse the options above) and flash the ESP82xx device again to see if operating at a lower frequency improves stability. Running at 80MHz will impact software serial communications so hardware serial is highly recommended if running the ESP82xx at 80MHz.</p> <p>Flash the newly compiled binary usig the <a href=../Getting-Started/#flashing>normal flashing process</a>.</p> <h3 id=connect-zigbee-adapter-to-tasmota>Connect Zigbee Adapter to Tasmota<a class=headerlink href=#connect-zigbee-adapter-to-tasmota title="Permanent link">~</a></h3> <p>If you are using your ESP82xx device to flash the Zigbee adapter as described in tutorials you may want to leave these connections in place in case you ever need to update Zigbee adapter firmware. If not, any of the free GPIOs can be used.</p> <div class="admonition note"> <p class=admonition-title>It is recommended that hardware serial pins be used (GPIO1/GPIO3 or GPIO13[Rx]/GPIO15[Tx])</p> <p>Due to ESP82xx GPIO pin constraints, GPIO15 can only be used as serial Tx. </p> </div> <p>The interface between the ESP82xx Wi-Fi device and the Zigbee adapter uses high speed serial. </p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Tasmota also provides serial communications emulation through software (i.e., software serial). This allows any GPIO to be used. TasmotaSerial version 2.4.x (PR <a href=https://github.com/arendst/Tasmota/pull/6377>#6377</a>) has improved the reliability of software serial making it feasible for use in this application. However, if you have an option to use hardware serial, choose that.</p> </div> <div class="admonition bug"> <p class=admonition-title>Z2T uses software serial by default to allow for serial logging on GPIO1/GPIO3</p> <p>Use <code>SerialLog 0</code> to enable <strong>hardware serial on GPIO13[Rx]/GPIO15[Tx]</strong>.</p> </div> <p>Recommended wiring: </p> <table> <thead> <tr> <th align=center>ESP<br>Device</th> <th align=center>Tasmota</th> <th align=center><br>CC2530</th> </tr> </thead> <tbody> <tr> <td align=center>GPIO13</td> <td align=center>Zigbee RX (166)</td> <td align=center>CC_TXD<br>(A.K.A. P0_3)</td> </tr> <tr> <td align=center>GPIO15</td> <td align=center>Zigbee TX (165)</td> <td align=center>CC_RXD<br>(A.K.A. P0_2)</td> </tr> <tr> <td align=center>3V3</td> <td align=center>VCC</td> <td align=center></td> </tr> <tr> <td align=center>GND</td> <td align=center>GND</td> <td align=center></td> </tr> </tbody> </table> <h3 id=tasmota-settings>Tasmota Settings<a class=headerlink href=#tasmota-settings title="Permanent link">~</a></h3> <p>In the <strong><em>Configuration -&gt; Configure Module</em></strong> page assign:</p> <ul> <li>GPIO13 to <code>Zigbee RX (166)</code> </li> <li>GPIO15 to <code>Zigbee TX (165)</code></li> </ul> <p><img src=https://user-images.githubusercontent.com/49731213/64920989-ec043400-d7bd-11e9-8f5c-74ece5c4e26c.jpg width=240></p> <p>You can quickly configure Tasmota using a custom template instead. </p> <p>Use this one for the recommended wiring scheme:</p> <div class=codehilite><pre><span></span><code><span class=p>{</span><span class=nt>&quot;NAME&quot;</span><span class=p>:</span><span class=s2>&quot;Zigbee&quot;</span><span class=p>,</span><span class=nt>&quot;GPIO&quot;</span><span class=p>:[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>166</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>165</span><span class=p>,</span><span class=mi>0</span><span class=p>],</span><span class=nt>&quot;FLAG&quot;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span><span class=nt>&quot;BASE&quot;</span><span class=p>:</span><span class=mi>18</span><span class=p>}</span>
</code></pre></div> <h4>CC2531 USB Wiring</h4> <p>On a CC2531 USB adapter some of the connectors of the CC2531 are connected to extra solder pads. Among those are RX/TX as seen on the image (CC_RXD(P0.3), CC_TXD(P0.1)): </p> <p><img alt=Pinout src=../_media/zigbee/cc2531usb.jpg></p> <p>If you want to supply power to the USB stick via 3.3V and GND from your ESP82xx board, you can use the corresponding pins of the debug header. GND is located at pin 1 and 3.3V at pin 9 of the DebugHeader. In addition, on some sticks, it is necessary to solder a bridge between the two small pads to the left of the "DEBUG" label just below the left side of the button, right next to the "D" of "Debug". You can see that one of the solder pads is connected to pin 9 of the debug header.</p> <p><img alt="Solderpads on CC2531" src=../_media/zigbee/cc2531_solderpads.jpg></p> <div class="admonition failure"> <p class=admonition-title>Be careful not to solder a short circuit between the pads and the housing of the button</p> </div> <h3 id=first-run>First Run<a class=headerlink href=#first-run title="Permanent link">~</a></h3> <p>When the Tasmota device boots, Zigbee2Tasmota will wait for 15 seconds before initializing the CC2530. This time allows for Wi-Fi and MQTT to connect (hopefully).</p> <p>First boot:</p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;Message&quot;</span><span class=o>:</span><span class=s2>&quot;CC2530 booted&quot;</span><span class=o>,</span><span class=s2>&quot;RestartReason&quot;</span><span class=o>:</span><span class=s2>&quot;Watchdog&quot;</span><span class=o>,</span><span class=s2>&quot;MajorRel&quot;</span><span class=o>:</span><span class=mi>2</span><span class=o>,</span><span class=s2>&quot;MinorRel&quot;</span><span class=o>:</span><span class=mi>6</span><span class=o>}}</span>
<span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>50</span><span class=o>,</span><span class=s2>&quot;MajorRel&quot;</span><span class=o>:</span><span class=mi>2</span><span class=o>,</span><span class=s2>&quot;MinorRel&quot;</span><span class=o>:</span><span class=mi>6</span><span class=o>,</span><span class=s2>&quot;MaintRel&quot;</span><span class=o>:</span><span class=mi>3</span><span class=o>,</span><span class=s2>&quot;Revision&quot;</span><span class=o>:</span><span class=mi>20190608</span><span class=o>}}</span>
<span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>2</span><span class=o>,</span><span class=s2>&quot;Message&quot;</span><span class=o>:</span><span class=s2>&quot;Reseting configuration&quot;</span><span class=o>}}</span>
<span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>3</span><span class=o>,</span><span class=s2>&quot;Message&quot;</span><span class=o>:</span><span class=s2>&quot;Configured, starting coordinator&quot;</span><span class=o>}}</span>
<span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>51</span><span class=o>,</span><span class=s2>&quot;IEEEAddr&quot;</span><span class=o>:</span><span class=s2>&quot;0x00124B00199DF06F&quot;</span><span class=o>,</span><span class=s2>&quot;ShortAddr&quot;</span><span class=o>:</span><span class=s2>&quot;0x0000&quot;</span><span class=o>,</span><span class=s2>&quot;DeviceType&quot;</span><span class=o>:</span><span class=mi>7</span><span class=o>,</span><span class=s2>&quot;DeviceState&quot;</span><span class=o>:</span><span class=mi>9</span><span class=o>,</span><span class=s2>&quot;NumAssocDevices&quot;</span><span class=o>:</span><span class=mi>0</span><span class=o>}}</span>
<span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/tasmota/Zigbee_home/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>0</span><span class=o>,</span><span class=s2>&quot;Message&quot;</span><span class=o>:</span><span class=s2>&quot;Started&quot;</span><span class=o>}}</span>
<span class=n>ZIG</span><span class=o>:</span> <span class=n>Zigbee</span> <span class=n>started</span>
<span class=n>ZIG</span><span class=o>:</span> <span class=n>No</span> <span class=n>zigbee</span> <span class=n>devices</span> <span class=n>data</span> <span class=k>in</span> <span class=n>Flash</span>
</code></pre></div> <p>Zigbee will automatically boot the CC2530 device, configure the device and wait for Zigbee messages.</p> <p>Normal boot looks like: </p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;Message&quot;</span><span class=o>:</span><span class=s2>&quot;CC2530 booted&quot;</span><span class=o>,</span><span class=s2>&quot;RestartReason&quot;</span><span class=o>:</span><span class=s2>&quot;Watchdog&quot;</span><span class=o>,</span><span class=s2>&quot;MajorRel&quot;</span><span class=o>:</span><span class=mi>2</span><span class=o>,</span><span class=s2>&quot;MinorRel&quot;</span><span class=o>:</span><span class=mi>6</span><span class=o>}}</span>
<span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>50</span><span class=o>,</span><span class=s2>&quot;MajorRel&quot;</span><span class=o>:</span><span class=mi>2</span><span class=o>,</span><span class=s2>&quot;MinorRel&quot;</span><span class=o>:</span><span class=mi>6</span><span class=o>,</span><span class=s2>&quot;MaintRel&quot;</span><span class=o>:</span><span class=mi>3</span><span class=o>,</span><span class=s2>&quot;Revision&quot;</span><span class=o>:</span><span class=mi>20190608</span><span class=o>}}</span>
<span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>3</span><span class=o>,</span><span class=s2>&quot;Message&quot;</span><span class=o>:</span><span class=s2>&quot;Configured, starting coordinator&quot;</span><span class=o>}}</span>
<span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>51</span><span class=o>,</span><span class=s2>&quot;IEEEAddr&quot;</span><span class=o>:</span><span class=s2>&quot;0x00124B00199DF06F&quot;</span><span class=o>,</span><span class=s2>&quot;ShortAddr&quot;</span><span class=o>:</span><span class=s2>&quot;0x0000&quot;</span><span class=o>,</span><span class=s2>&quot;DeviceType&quot;</span><span class=o>:</span><span class=mi>7</span><span class=o>,</span><span class=s2>&quot;DeviceState&quot;</span><span class=o>:</span><span class=mi>9</span><span class=o>,</span><span class=s2>&quot;NumAssocDevices&quot;</span><span class=o>:</span><span class=mi>0</span><span class=o>}}</span>
<span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbState&quot;</span><span class=o>:{</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>0</span><span class=o>,</span><span class=s2>&quot;Message&quot;</span><span class=o>:</span><span class=s2>&quot;Started&quot;</span><span class=o>}}</span>
<span class=n>ZIG</span><span class=o>:</span> <span class=n>Zigbee</span> <span class=n>started</span>
<span class=n>ZIG</span><span class=o>:</span> <span class=n>Zigbee</span> <span class=n>devices</span> <span class=n>data</span> <span class=k>in</span> <span class=n>Flash</span> <span class=o>(</span><span class=mi>516</span> <span class=n>bytes</span><span class=o>)</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>You can force a factory reset of your CC2530 with <code>ZigbeeReset 1</code> and reboot</p> </div> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">~</a></h2> <p>For a list of available command see <a href=../Commands/#zigbee>Zigbee Commands</a>. </p> <h2 id=pairing-zigbee-devices>Pairing Zigbee Devices<a class=headerlink href=#pairing-zigbee-devices title="Permanent link">~</a></h2> <p>When you first create a Zigbee network, it contains no device except the coordinator. The first step is to add devices to the network, which is called <strong>pairing</strong>.</p> <p>By default, and for security reasons, the Zigbee coordinator does not automatically accept new devices. To pair new devices, use <a href=../Commands/#zbpermitjoin><code>ZbPermitJoin 1</code></a>. Once Zigbee2Tasmota is in pairing mode, put the Zigbee device into pairing mode. This is usually accomplished by pressing the button on the device for 5 seconds or more. To stop pairing, use <a href=../Commands/#zbpermitjoin><code>ZbPermitJoin 0</code></a>.</p> <div class=codehilite><pre><span></span><code><span class=err>ZbPermitJoin</span> <span class=mi>1</span>

<span class=err>CMD:</span> <span class=err>ZbPermitJoin</span> <span class=mi>1</span>
<span class=err>MQT:</span> <span class=err>stat/%topic%/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbPermitJoin&quot;</span><span class=p>:</span><span class=s2>&quot;Done&quot;</span><span class=p>}</span>
<span class=err>MQT:</span> <span class=err>tele/%topic%/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbState&quot;</span><span class=p>:{</span><span class=nt>&quot;Status&quot;</span><span class=p>:</span><span class=mi>21</span><span class=p>,</span><span class=nt>&quot;Message&quot;</span><span class=p>:</span><span class=s2>&quot;Enable Pairing mode for 60 seconds&quot;</span><span class=p>}}</span>
</code></pre></div> <p>60 seconds later:</p> <div class=codehilite><pre><span></span><code><span class=err>MQT:</span> <span class=err>tele/%topic%/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbState&quot;</span><span class=p>:{</span><span class=nt>&quot;Status&quot;</span><span class=p>:</span><span class=mi>20</span><span class=p>,</span><span class=nt>&quot;Message&quot;</span><span class=p>:</span><span class=s2>&quot;Disable Pairing mode&quot;</span><span class=p>}}</span>
</code></pre></div> <p>Although this is highly discouraged, you can permanently enable Zigbee pairing, until the next reboot, with <code>ZbPermitJoin 99</code>.</p> <div class=codehilite><pre><span></span><code><span class=err>ZbPermitJoin</span> <span class=mi>99</span>

<span class=err>MQT:</span> <span class=err>tele/%topic%/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbState&quot;</span><span class=p>:{</span><span class=nt>&quot;Status&quot;</span><span class=p>:</span><span class=mi>22</span><span class=p>,</span><span class=nt>&quot;Message&quot;</span><span class=p>:</span><span class=s2>&quot;Enable Pairing mode until next boot&quot;</span><span class=p>}}</span>

<span class=err>ZbPermitJoin</span> <span class=mi>0</span>
<span class=err>MQT:</span> <span class=err>tele/%topic%/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbState&quot;</span><span class=p>:{</span><span class=nt>&quot;Status&quot;</span><span class=p>:</span><span class=mi>20</span><span class=p>,</span><span class=nt>&quot;Message&quot;</span><span class=p>:</span><span class=s2>&quot;Disable Pairing mode&quot;</span><span class=p>}}</span>
</code></pre></div> <div class=codehilite><pre><span></span><code><span class=err>MQT:</span> <span class=err>tele/%topic%/SENSOR</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbState&quot;</span><span class=p>:{</span><span class=nt>&quot;Status&quot;</span><span class=p>:</span><span class=mi>30</span><span class=p>,</span><span class=nt>&quot;IEEEAddr&quot;</span><span class=p>:</span><span class=s2>&quot;0x00158D00036B50AE&quot;</span><span class=p>,</span><span class=nt>&quot;ShortAddr&quot;</span><span class=p>:</span><span class=s2>&quot;0x8F20&quot;</span><span class=p>,</span><span class=nt>&quot;PowerSource&quot;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&quot;ReceiveWhenIdle&quot;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&quot;Security&quot;</span><span class=p>:</span><span class=kc>false</span><span class=p>}}</span>
</code></pre></div> <h4>Example for Aqara Temperature &amp; Humidity Sensor</h4> <p>To pair this sensor, press and hold the button for 5 seconds. The led will flash several times and you will see logs entries, especially this one:</p> <ol> <li>Put Zigbee2Tasmota into pairing mode using the <code>ZigbeePermitJoin</code> command as described above</li> <li>Press the Xiaomi Aqara sensor's button for 5 seconds to pair the devices. You will see a message as follows: </li> </ol> <p><code>MQT: tele/%topic%/SENSOR = {"ZbState":{"Status":30,"IEEEAddr":"0x00158D00036B50AE","ShortAddr":"0x8F20","PowerSource":false,"ReceiveWhenIdle":false,"Security":false}}</code></p> <p>Message with <code>"Status":30</code> shows some characteristics of the device:</p> <table> <thead> <tr> <th>Field name</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td><code>Status</code></td> <td><code>30</code> indicates a device connect or reconnect. This is the opportunity to match IEEEAddress and short address</td> </tr> <tr> <td><code>IEEEAddr</code></td> <td>Long unique address (64 bits) of the device - factory set</td> </tr> <tr> <td><code>ShortAddr</code></td> <td>Short address (16 bits) randomly assigned to the device on this Zigbee network</td> </tr> <tr> <td><code>PowerSource</code></td> <td><code>true</code> = the device is connected to a power source<br><code>false</code> = the device runs on battery</td> </tr> <tr> <td><code>ReceiveWhenIdle</code></td> <td><code>true</code> = the device can receive commands when idle<br><code>false</code> = the device is not listening. Commands should be sent when the device reconnects and is idle</td> </tr> <tr> <td><code>Security</code></td> <td>Security capability (meaning unknown, to be determined)</td> </tr> </tbody> </table> <h3 id=zigbee-friendly-names>Zigbee Friendly Names<a class=headerlink href=#zigbee-friendly-names title="Permanent link">~</a></h3> <p>Supported since version 8.2!</p> <p>Instead of a short address like <code>"0x4773"</code> you can assign a memorable friendly name like <code>"Room_Plug"</code>.</p> <p>See <a href=../Commands/#zbname><code>ZbName</code></a> command to set names.</p> <div class="admonition example"> <p class=admonition-title>Xiaomi Aqara Cube with address <code>0x128F</code></p> </div> <div class=codehilite><pre><span></span><code><span class=err>MQT:</span> <span class=err>tele/%topic%/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbReceived&quot;</span><span class=p>:{</span><span class=nt>&quot;0x128F&quot;</span><span class=p>:{</span><span class=nt>&quot;AqaraVibrationMode&quot;</span><span class=p>:</span><span class=s2>&quot;tilt&quot;</span><span class=p>,</span><span class=nt>&quot;AqaraVibrationsOrAngle&quot;</span><span class=p>:</span><span class=mi>162</span><span class=p>,</span><span class=nt>&quot;AqaraAccelerometer&quot;</span><span class=p>:[</span><span class=mi>-690</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>138</span><span class=p>],</span><span class=nt>&quot;AqaraAngles&quot;</span><span class=p>:[</span><span class=mi>-78</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>11</span><span class=p>],</span><span class=nt>&quot;LinkQuality&quot;</span><span class=p>:</span><span class=mi>158</span><span class=p>}}}</span>
</code></pre></div> <p>Setting its friendly name to <code>Vibration_sensor</code>:</p> <div class=codehilite><pre><span></span><code><span class=err>ZigbeeName</span> <span class=mi>0</span><span class=err>x</span><span class=mi>128</span><span class=err>F,Vibration_sensor</span>
<span class=err>CMD:</span> <span class=err>ZbName</span> <span class=mi>0</span><span class=err>x</span><span class=mi>128</span><span class=err>F,Vibration_sensor</span>
<span class=err>MQT:</span> <span class=err>stat/%topic%/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;0x128F&quot;</span><span class=p>:{</span><span class=nt>&quot;Name&quot;</span><span class=p>:</span><span class=s2>&quot;Vibration_sensor&quot;</span><span class=p>}}</span>

<span class=err>(</span><span class=mi>10</span> <span class=err>seconds</span> <span class=err>later)</span>
<span class=err>ZIG:</span> <span class=err>Zigbee</span> <span class=err>Devices</span> <span class=err>Data</span> <span class=err>store</span> <span class=err>in</span> <span class=err>Flash</span> <span class=err>(</span><span class=mi>0</span><span class=err>x</span><span class=mi>402</span><span class=err>FF</span><span class=mi>800</span> <span class=err>-</span> <span class=mi>270</span> <span class=err>bytes)</span>
</code></pre></div> <p>Now the sensor readings includes the friendly name:</p> <div class=codehilite><pre><span></span><code><span class=err>MQT:</span> <span class=err>tele/%topic%/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbReceived&quot;</span><span class=p>:{</span><span class=nt>&quot;0x128F&quot;</span><span class=p>:{</span><span class=nt>&quot;Name&quot;</span><span class=p>:</span><span class=s2>&quot;Vibration_sensor&quot;</span><span class=p>,</span><span class=nt>&quot;AqaraVibrationMode&quot;</span><span class=p>:</span><span class=s2>&quot;tilt&quot;</span><span class=p>,</span><span class=nt>&quot;AqaraVibrationsOrAngle&quot;</span><span class=p>:</span><span class=mi>171</span><span class=p>,</span><span class=nt>&quot;AqaraAccelerometer&quot;</span><span class=p>:[</span><span class=mi>-691</span><span class=p>,</span><span class=mi>12</span><span class=p>,</span><span class=mi>130</span><span class=p>],</span><span class=nt>&quot;AqaraAngles&quot;</span><span class=p>:[</span><span class=mi>-78</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>11</span><span class=p>],</span><span class=nt>&quot;LinkQuality&quot;</span><span class=p>:</span><span class=mi>153</span><span class=p>}}}</span>
</code></pre></div> <p>If you set <a href=../Commands/#setoption83><code>SetOption83 1</code></a> sensor readings will use the friendly name as KSON key, short address is added as <code>Device</code>:</p> <div class=codehilite><pre><span></span><code><span class=err>MQT:</span> <span class=err>tele/%topic%/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbReceived&quot;</span><span class=p>:{</span><span class=nt>&quot;Vibration_sensor&quot;</span><span class=p>:{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;0x128F&quot;</span><span class=p>,</span><span class=nt>&quot;AqaraVibrationMode&quot;</span><span class=p>:</span><span class=s2>&quot;tilt&quot;</span><span class=p>,</span><span class=nt>&quot;AqaraVibrationsOrAngle&quot;</span><span class=p>:</span><span class=mi>171</span><span class=p>,</span><span class=nt>&quot;AqaraAccelerometer&quot;</span><span class=p>:[</span><span class=mi>-691</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>136</span><span class=p>],</span><span class=nt>&quot;AqaraAngles&quot;</span><span class=p>:[</span><span class=mi>-78</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>11</span><span class=p>],</span><span class=nt>&quot;LinkQuality&quot;</span><span class=p>:</span><span class=mi>153</span><span class=p>}}}</span>
</code></pre></div> <h2 id=reading-sensors>Reading Sensors<a class=headerlink href=#reading-sensors title="Permanent link">~</a></h2> <p>Most sensors will spontaneously publish their readings, regularly or once a signifcant change happened: temperature, pressure, humidity, presence, illuminance...</p> <p>Sensor messages are published via MQTT when they are received from the Zigbee device. Similar to Zigbee2MQTT, Z2T tries to group and debounce sensor values when they are received within a 300ms window.</p> <div class="admonition example"> <p class=admonition-title>Aqara Temperature &amp; Humidity Sensor</p> </div> <p><img src=../_media/aqara.png style=float:right;width:10em></p> <p>This sensor monitors humidity, temperature, and air pressure. Its Zigbee model ID is <code>lumi.weather</code>.</p> <p>This device publishes sensor values roughly every hour or when a change occurs. You can also force an update pressing the device's button. It sends two kinds of messages, either 3x standard Zigbee messages, or a single proprietary message containing all sensor values. </p> <p><code>0x8F20</code> is the ShortAddress of the sensor, and its name is <code>Kitchen</code> if you used <code>ZbName 0x8F20,Kithchen</code>.</p> <div class=codehilite><pre><span></span><code><span class=err>MQT:</span> <span class=err>tele/%topic%/SENSOR</span> <span class=err>=</span><span class=p>{</span><span class=nt>&quot;ZbReceived&quot;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&quot;0x8F20&quot;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&quot;Name&quot;</span><span class=p>:</span> <span class=s2>&quot;Kitchen&quot;</span><span class=p>,</span> <span class=nt>&quot;Voltage&quot;</span><span class=p>:</span> <span class=mf>2.995</span><span class=p>,</span> <span class=nt>&quot;Battery&quot;</span><span class=p>:</span> <span class=mi>98</span><span class=p>,</span> <span class=nt>&quot;Temperature&quot;</span><span class=p>:</span> <span class=mf>21.01</span><span class=p>,</span> <span class=nt>&quot;Humidity&quot;</span><span class=p>:</span> <span class=mf>53.68</span><span class=p>,</span> <span class=nt>&quot;Pressure&quot;</span><span class=p>:</span> <span class=mf>1004.04</span><span class=p>,</span> <span class=nt>&quot;PressureUnit&quot;</span><span class=p>:</span> <span class=s2>&quot;hPa&quot;</span><span class=p>,</span> <span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nt>&quot;LinkQuality&quot;</span><span class=p>:</span> <span class=mi>88</span><span class=p>}}</span>
</code></pre></div> <p>or prefixed by name if you set <code>SetOption83 1</code></p> <div class=codehilite><pre><span></span><code><span class=err>MQT:</span> <span class=err>tele/%topic%/SENSOR</span> <span class=err>=</span><span class=p>{</span><span class=nt>&quot;ZbReceived&quot;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&quot;Kitchen&quot;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span> <span class=s2>&quot;0x8F20&quot;</span><span class=p>,</span> <span class=nt>&quot;Voltage&quot;</span><span class=p>:</span> <span class=mf>2.995</span><span class=p>,</span> <span class=nt>&quot;Battery&quot;</span><span class=p>:</span> <span class=mi>98</span><span class=p>,</span> <span class=nt>&quot;Temperature&quot;</span><span class=p>:</span> <span class=mf>21.01</span><span class=p>,</span> <span class=nt>&quot;Humidity&quot;</span><span class=p>:</span> <span class=mf>53.68</span><span class=p>,</span> <span class=nt>&quot;Pressure&quot;</span><span class=p>:</span> <span class=mf>1004.04</span><span class=p>,</span> <span class=nt>&quot;PressureUnit&quot;</span><span class=p>:</span> <span class=s2>&quot;hPa&quot;</span><span class=p>,</span> <span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nt>&quot;LinkQuality&quot;</span><span class=p>:</span> <span class=mi>88</span><span class=p>}}</span>
</code></pre></div> <p>Topic is device specific, to allow more effective retained messages, if you set <code>SetOption89 1</code></p> <div class=codehilite><pre><span></span><code><span class=err>MQT:</span> <span class=err>tele/%topic%/</span><span class=mi>8</span><span class=err>F</span><span class=mi>20</span><span class=err>/SENSOR</span> <span class=err>=</span><span class=p>{</span><span class=nt>&quot;ZbReceived&quot;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&quot;Kitchen&quot;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span> <span class=s2>&quot;0x8F20&quot;</span><span class=p>,</span> <span class=nt>&quot;Voltage&quot;</span><span class=p>:</span> <span class=mf>2.995</span><span class=p>,</span> <span class=nt>&quot;Battery&quot;</span><span class=p>:</span> <span class=mi>98</span><span class=p>,</span> <span class=nt>&quot;Temperature&quot;</span><span class=p>:</span> <span class=mf>21.01</span><span class=p>,</span> <span class=nt>&quot;Humidity&quot;</span><span class=p>:</span> <span class=mf>53.68</span><span class=p>,</span> <span class=nt>&quot;Pressure&quot;</span><span class=p>:</span> <span class=mf>1004.04</span><span class=p>,</span> <span class=nt>&quot;PressureUnit&quot;</span><span class=p>:</span> <span class=s2>&quot;hPa&quot;</span><span class=p>,</span> <span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nt>&quot;LinkQuality&quot;</span><span class=p>:</span> <span class=mi>88</span><span class=p>}}</span>
</code></pre></div> <p>Supported values: </p> <table> <thead> <tr> <th>Field name</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td><code>LinkQuality</code></td> <td>Stength of the Zigbee signal, between 1 and 254 (integer). See this <a href=https://www.metageek.com/training/resources/zigbee-wifi-coexistence.html>ZigBee and WiFi Coexistence</a></td> </tr> <tr> <td><code>Humidity</code></td> <td>Humidity in percentage (float)</td> </tr> <tr> <td><code>Pressure</code> and <code>PressureUnit</code></td> <td>Atmospheric pressure (float) and unit (string)<br>Currently only <code>hPa</code> (A.K.A. mbar) is supported</td> </tr> <tr> <td><code>Temperature</code></td> <td>Temperature in Celsius (float)</td> </tr> <tr> <td><code>Voltage</code></td> <td>Battery voltage (float)</td> </tr> <tr> <td><code>Battery</code></td> <td>Battery charge in percentage (integer)</td> </tr> <tr> <td><code>ModelId</code></td> <td>Model name of the Zigbee device (string)<br>Ex: <code>lumi.weather</code></td> </tr> <tr> <td><code>ScaledValue</code> and <code>Scale</code></td> <td>Give the raw measure and the scale correction as 10^scale</td> </tr> <tr> <td>And many more...</td> <td></td> </tr> </tbody> </table> <p>If a value is not decoded, it will appear as <code>"&lt;cluster&gt;_&lt;attr&gt;":&lt;value&gt;</code> where <code>&lt;cluster&gt;</code> is the Zigbee ZCL Cluster of the attribute (family), <code>&lt;attr&gt;</code> is the attribute number and <code>&lt;value&gt;</code> its published value.</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p><code>"0402_0000":2240</code> is attribute 0x0000 from cluster 0x0402, which is the temperature in hundredth of °C. It is automatically converted to <code>"Temperature":22.40</code>.</p> </div> <h2 id=device-information>Device Information<a class=headerlink href=#device-information title="Permanent link">~</a></h2> <p>You can dump the internal information gathered about connected Zigbee devices with the command <a href=../Commands/#zigbeestatus><code>ZigbeeStatus</code></a>.</p> <p>You can use <code>ZbStatus2</code> to display all information and endpoints. If probing was successful (at pairing time or using <code>ZbProbe</code>), Tasmota will automatically find the right endpoint.</p> <p>Depending on the number of device you have, <code>ZbStatus2</code> output can exceed tha maximum MQTT message size. You can request the status of each individual device using <code>ZbStatus2 1</code>, <code>ZbStatus2 2</code>, <code>ZbStatus2 3</code>...</p> <p><code>ZbStatus1</code> - List all connected devices </p> <div class=codehilite><pre><span></span><code><span class=p>{</span><span class=nt>&quot;ZbStatus1&quot;</span><span class=p>:[{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;0x6B58&quot;</span><span class=p>},{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;0xE9C3&quot;</span><span class=p>},{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;0x3D82&quot;</span><span class=p>}]}</span>
</code></pre></div> <p><code>ZbStatus2</code> - Display detailed information for each device, including long address, model and manufacturer: </p> <div class=codehilite><pre><span></span><code><span class=p>{</span><span class=nt>&quot;ZbStatus2&quot;</span><span class=p>:[{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;0x4773&quot;</span><span class=p>,</span><span class=nt>&quot;IEEEAddr&quot;</span><span class=p>:</span><span class=s2>&quot;0x7CB03EAA0A0292DD&quot;</span><span class=p>,</span><span class=nt>&quot;ModelId&quot;</span><span class=p>:</span><span class=s2>&quot;Plug 01&quot;</span><span class=p>,</span><span class=nt>&quot;Manufacturer&quot;</span><span class=p>:</span><span class=s2>&quot;OSRAM&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoints&quot;</span><span class=p>:[</span><span class=s2>&quot;0x03&quot;</span><span class=p>]},{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;0x135D&quot;</span><span class=p>,</span><span class=nt>&quot;Name&quot;</span><span class=p>:</span><span class=s2>&quot;Temp_sensor&quot;</span><span class=p>,</span><span class=nt>&quot;IEEEAddr&quot;</span><span class=p>:</span><span class=s2>&quot;0x00158D00036B50AE&quot;</span><span class=p>,</span><span class=nt>&quot;ModelId&quot;</span><span class=p>:</span><span class=s2>&quot;lumi.weather&quot;</span><span class=p>,</span><span class=nt>&quot;Manufacturer&quot;</span><span class=p>:</span><span class=s2>&quot;LUMI&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoints&quot;</span><span class=p>:[</span><span class=s2>&quot;0x01&quot;</span><span class=p>]}]}</span>
</code></pre></div> <p><em>(formatted for readability)</em> </p> <div class=codehilite><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;ZbStatus2&quot;</span><span class=p>:</span> <span class=p>[{</span>
        <span class=nt>&quot;Device&quot;</span><span class=p>:</span> <span class=s2>&quot;0x4773&quot;</span><span class=p>,</span>
        <span class=nt>&quot;IEEEAddr&quot;</span><span class=p>:</span> <span class=s2>&quot;0x7CB03EAA0A0292DD&quot;</span><span class=p>,</span>
        <span class=nt>&quot;ModelId&quot;</span><span class=p>:</span> <span class=s2>&quot;Plug 01&quot;</span><span class=p>,</span>
        <span class=nt>&quot;Manufacturer&quot;</span><span class=p>:</span> <span class=s2>&quot;OSRAM&quot;</span><span class=p>,</span>
        <span class=nt>&quot;Endpoints&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;0x03&quot;</span><span class=p>]</span>
    <span class=p>},</span> <span class=p>{</span>
        <span class=nt>&quot;Device&quot;</span><span class=p>:</span> <span class=s2>&quot;0x135D&quot;</span><span class=p>,</span>
        <span class=nt>&quot;Name&quot;</span><span class=p>:</span> <span class=s2>&quot;Temp_sensor&quot;</span><span class=p>,</span>
        <span class=nt>&quot;IEEEAddr&quot;</span><span class=p>:</span> <span class=s2>&quot;0x00158D00036B50AE&quot;</span><span class=p>,</span>
        <span class=nt>&quot;ModelId&quot;</span><span class=p>:</span> <span class=s2>&quot;lumi.weather&quot;</span><span class=p>,</span>
        <span class=nt>&quot;Manufacturer&quot;</span><span class=p>:</span> <span class=s2>&quot;LUMI&quot;</span><span class=p>,</span>
        <span class=nt>&quot;Endpoints&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;0x01&quot;</span><span class=p>]</span>
    <span class=p>}]</span>
<span class=p>}</span>
</code></pre></div> <h3 id=understanding-endpoints>Understanding Endpoints<a class=headerlink href=#understanding-endpoints title="Permanent link">~</a></h3> <p>The endpoint on the coordinator or on the Zigbee device the message is sent from/to.</p> <p>Z2T will automatically take the first endpoint in the list; this works most of the time. You normally don't need to specify the endpoint number. In rare case, you can still force a specific endpoint.</p> <p>Example Endpoints:</p> <table> <thead> <tr> <th>Device</th> <th>Endpoint</th> </tr> </thead> <tbody> <tr> <td>OSRAM Plug</td> <td><code>0x03</code></td> </tr> <tr> <td>Philips Hue Bulb</td> <td><code>0x0B</code></td> </tr> </tbody> </table> <h2 id=sending-commands>Sending Commands<a class=headerlink href=#sending-commands title="Permanent link">~</a></h2> <p>You can send commands to device or groups of device, for example to turn on/off a light, set its brightness of open/close shutters.</p> <p>Here is a list of supported commands, see below how to send any command if it's not in the list.</p> <table> <thead> <tr> <th>Command</th> <th>Parameters</th> <th>Cluster</th> </tr> </thead> <tbody> <tr> <td>Power</td> <td><code>1|true|"true"|"on"</code>: On<br><code>0|false|"false"|"off"</code>: Off<br><code>2|"Toggle"</code>: Toggle</td> <td>0x0006</td> </tr> <tr> <td>Dimmer</td> <td><code>0..254</code>: Dimmer value<br>255 is normally considered as invalid, and may be converted to 254</td> <td>0x0008</td> </tr> <tr> <td>DimmerUp</td> <td><code>null</code>: no parameter. Increases dimmer by 10%</td> <td>0x0008</td> </tr> <tr> <td>DimmerDown</td> <td><code>null</code>: no parameter. Decreases dimmer by 10%</td> <td>0x0008</td> </tr> <tr> <td>DimmerStop</td> <td><code>null</code>: no parameter. Stops any running increase of decrease of dimmer.</td> <td>0x0008</td> </tr> <tr> <td>ResetAlarm</td> <td><code>&lt;alarmcode&gt;,&lt;clusterid&gt;</code>: (to be documented later)</td> <td>0x0009</td> </tr> <tr> <td>ResetAllAlarms</td> <td><code>null</code>: no parameter, (to be documented later)</td> <td>0x0009</td> </tr> <tr> <td>Hue</td> <td><code>0..254</code>: change Hue value</td> <td>0x0300</td> </tr> <tr> <td>Sat</td> <td><code>0..254</code>: change Sat value</td> <td>0x0300</td> </tr> <tr> <td>HueSat</td> <td><code>0..254,0..254</code>: change both Hue and Sat values</td> <td>0x0300</td> </tr> <tr> <td>Color</td> <td><code>0..65534,0..65534</code>: change the color using [x,y] coordinates</td> <td>0x0300</td> </tr> <tr> <td>CT</td> <td><code>0..65534</code>: change the white color-temperature in Mireds</td> <td>0x0300</td> </tr> <tr> <td>Shutter</td> <td><code>0..254</code>: send any Shutter command (prefer the commands below)</td> <td>0x0102</td> </tr> <tr> <td>ShutterOpen</td> <td><code>null</code>: no parameter, open shutter</td> <td>0x0102</td> </tr> <tr> <td>ShutterClose</td> <td><code>null</code>: no parameter, close shutter</td> <td>0x0102</td> </tr> <tr> <td>ShutterStop</td> <td><code>null</code>: no parameter, stop shutter movement</td> <td>0x0102</td> </tr> <tr> <td>ShutterLift</td> <td><code>0..100</code>: move shutter to a specific position in percent<br><code>0</code>%=open, <code>100</code>%=closed</td> <td>0x0102</td> </tr> <tr> <td>ShutterTilt</td> <td><code>0..100</code>: move the shutter to the specific tilt position in percent</td> <td>0x0102</td> </tr> </tbody> </table> <p>The format of the command is following:</p> <p><code>ZbSend {"Device":"&lt;device&gt;","Send":{"&lt;sendcmd&gt;":&lt;sendparam&gt;}}</code> where<br><code>&lt;device&gt;</code>identifies the target and can be a shortaddr <code>0x1234</code>, a longaddr <code>0x1234567812345678</code> or a name <code>Kitchen</code>.<br>  <code>"&lt;sendcmd&gt;":&lt;sendparam&gt;</code> the command and its parameters</p> <p>If the device has been correctly paired and its endpoints recorded by Z2T, you shouldn't need to specify a target endpoint. You can use an option <code>"endpoitn":&lt;endpoint&gt;</code> parameter if Z2T can't find the correct endpoint or if you want to change from the default endpoint. See below <strong>Understanding endpoints</strong>.</p> <h3 id=low-level-commands>Low-level Commands<a class=headerlink href=#low-level-commands title="Permanent link">~</a></h3> <p>There is a special syntax if you want to send arbitrary commands: <code>"Send":"&lt;send_bytes&gt;"</code> where <code>&lt;send_bytes&gt;</code> has the following syntax:</p> <p><code>"&lt;cluster&gt;_&lt;cmd&gt;/&lt;bytes&gt;"</code>: send a non-cluster specific command for cluster id <code>&lt;cluster&gt;</code>, command id <code>&lt;cmd&gt;</code> and payload <code>&lt;bytes&gt;</code>. </p> <p>Example: <code>ZbSend {"Device":"0x1234","Send":"0000_00/0500"}</code> I.e. send a Read command (0x00) to the general cluster (0x0000) for attribute ManufId (0x0005). Note: all values are little-endian.</p> <p>Or use '!' instead of '_' to specify cluster-specific commands:</p> <p><code>"&lt;cluster&gt;!&lt;cmd&gt;/&lt;bytes&gt;"</code>: send a cluster specific command for cluster id <code>&lt;cluster&gt;</code>, command id <code>&lt;cmd&gt;</code> and payload <code>&lt;bytes&gt;</code>.</p> <p>Example: <code>ZbSend {"Device":"0x1234","Send":"0008_04/800A00"}</code> I.e. send a Dimmer command (0x04) from Level Control cluster (0x0008) with payload being: Dimmer value 0x80, and transition time of 1 second (0x000A = 10 tenths of seconds).</p> <p>Of course the latter example could be simply: <code>ZbSend {"Device":"0x1234","Send":{"Dimmer":"0x80"}</code></p> <h3 id=examples>Examples<a class=headerlink href=#examples title="Permanent link">~</a></h3> <h4>OSRAM Plug</h4> <div class=codehilite><pre><span></span><code><span class=err>ZbSend</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x4773&quot;</span><span class=p>,</span> <span class=nt>&quot;send&quot;</span><span class=p>:{</span><span class=nt>&quot;Power&quot;</span><span class=p>:</span><span class=s2>&quot;On&quot;</span><span class=p>}</span> <span class=p>}</span>
<span class=err>ZbSend</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x4773&quot;</span><span class=p>,</span> <span class=nt>&quot;send&quot;</span><span class=p>:{</span><span class=nt>&quot;Power&quot;</span><span class=p>:</span><span class=mi>1</span><span class=p>}</span> <span class=p>}</span>
<span class=err>ZbSend</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x4773&quot;</span><span class=p>,</span> <span class=nt>&quot;send&quot;</span><span class=p>:{</span><span class=nt>&quot;Power&quot;</span><span class=p>:</span><span class=kc>false</span><span class=p>}</span> <span class=p>}</span>
<span class=err>ZbSend</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x4773&quot;</span><span class=p>,</span> <span class=nt>&quot;send&quot;</span><span class=p>:{</span><span class=nt>&quot;Power&quot;</span><span class=p>:</span><span class=s2>&quot;Toggle&quot;</span><span class=p>}</span> <span class=p>}</span>
</code></pre></div> <p>Read the On/Off status: (all three commands below are synonyms)</p> <div class=codehilite><pre><span></span><code><span class=err>ZbRead</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x4773&quot;</span><span class=p>,</span> <span class=nt>&quot;endpoint&quot;</span><span class=p>:</span><span class=s2>&quot;0x03&quot;</span><span class=p>,</span> <span class=nt>&quot;cluster&quot;</span><span class=p>:</span><span class=s2>&quot;0x0006&quot;</span><span class=p>,</span> <span class=nt>&quot;read&quot;</span><span class=p>:</span><span class=s2>&quot;0x0000&quot;</span> <span class=p>}</span>
<span class=err>ZbRead</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x4773&quot;</span><span class=p>,</span> <span class=nt>&quot;endpoint&quot;</span><span class=p>:</span><span class=s2>&quot;0x03&quot;</span><span class=p>,</span> <span class=nt>&quot;cluster&quot;</span><span class=p>:</span><span class=s2>&quot;0x0006&quot;</span><span class=p>,</span> <span class=nt>&quot;read&quot;</span><span class=p>:[</span><span class=s2>&quot;0x0000&quot;</span><span class=p>]</span> <span class=p>}</span>
<span class=err>ZbRead</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x4773&quot;</span><span class=p>,</span> <span class=nt>&quot;endpoint&quot;</span><span class=p>:</span><span class=mi>3</span><span class=p>,</span> <span class=nt>&quot;cluster&quot;</span><span class=p>:</span><span class=mi>6</span><span class=p>,</span> <span class=nt>&quot;read&quot;</span><span class=p>:</span><span class=mi>0</span> <span class=p>}</span>
</code></pre></div> <div class=codehilite><pre><span></span><code><span class=err>MQT:</span> <span class=err>tele/tasmota/SENSOR</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbReceived&quot;</span><span class=p>:{</span><span class=nt>&quot;0x4773&quot;</span><span class=p>:{</span><span class=nt>&quot;Power&quot;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&quot;LinkQuality&quot;</span><span class=p>:</span><span class=mi>52</span><span class=p>}}}</span>
</code></pre></div> <h4>Philips Hue bulb</h4> <div class=codehilite><pre><span></span><code><span class=err>ZbSend</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x3D82&quot;</span><span class=p>,</span> <span class=nt>&quot;send&quot;</span><span class=p>:{</span><span class=nt>&quot;Power&quot;</span><span class=p>:</span><span class=s2>&quot;Off&quot;</span><span class=p>}</span> <span class=p>}</span>
<span class=err>ZbSend</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x3D82&quot;</span><span class=p>,</span> <span class=nt>&quot;send&quot;</span><span class=p>:{</span><span class=nt>&quot;Dimmer&quot;</span><span class=p>:</span><span class=mi>128</span><span class=p>}</span> <span class=p>}</span>
<span class=err>ZbSend</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x3D82&quot;</span><span class=p>,</span> <span class=nt>&quot;send&quot;</span><span class=p>:{</span><span class=nt>&quot;Dimmer&quot;</span><span class=p>:</span><span class=mi>254</span><span class=p>}</span> <span class=p>}</span>
<span class=err>ZbSend</span> <span class=p>{</span> <span class=nt>&quot;device&quot;</span><span class=p>:</span><span class=s2>&quot;0x3D82&quot;</span><span class=p>,</span> <span class=nt>&quot;endpoint&quot;</span><span class=p>:</span><span class=s2>&quot;0x0B&quot;</span><span class=p>,</span> <span class=nt>&quot;send&quot;</span><span class=p>:{</span><span class=nt>&quot;Dimmer&quot;</span><span class=p>:</span><span class=mi>0</span><span class=p>}</span> <span class=p>}</span>
</code></pre></div> <h2 id=receiving-commands>Receiving Commands<a class=headerlink href=#receiving-commands title="Permanent link">~</a></h2> <p>If you pair device like switches and remotes, you will also see received commands from thos devices.</p> <p>When a command is received, attributes are published both in their low-level and high-level formats (if known).</p> <p>Low level format is the following: <code>"&lt;cluster&gt;!&lt;cmd&gt;":"&lt;payload"</code></p> <p>Example for IKEA Remote: <code>{"ZbReceived":{"IKEA_remote":{"Device":"0xF72F","0006!02":"","Power":2,"Endpoint":1,"LinkQuality":31}}}</code></p> <p>The command received <code>"0006!02":""</code> is Power Toggle (0x02) from On/Off cluster (0x0006) with no payload. It is also translated as <code>"Power":2</code>. <code>"Endpoint":1</code> tells you from which endpoint the command was send. Some Xiaomi multi-switches use different endpoints for each switch.</p> <h4>Light State Tracking</h4> <p>Once Z2T receives a command related to a light (Power, Dimmer, Color, ColorTemp), it sends right after a Read command to get the actual state of the light. This is used for Hue Emulation and Alexa support. The final attributes are read betwenn 200ms and 1000ms later, to allow for the light to achieve its target state.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code><span class=mi>16</span><span class=o>:</span><span class=mi>02</span><span class=o>:</span><span class=mi>04</span> <span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_remote&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0xF72F&quot;</span><span class=o>,</span><span class=s2>&quot;0006!02&quot;</span><span class=o>:</span><span class=s2>&quot;&quot;</span><span class=o>,</span><span class=s2>&quot;Power&quot;</span><span class=o>:</span><span class=mi>2</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;Group&quot;</span><span class=o>:</span><span class=mi>100</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>75</span><span class=o>}}}</span>
<span class=mi>16</span><span class=o>:</span><span class=mi>02</span><span class=o>:</span><span class=mi>05</span> <span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_Light&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0x5ADF&quot;</span><span class=o>,</span><span class=s2>&quot;Power&quot;</span><span class=o>:</span><span class=kc>true</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>80</span><span class=o>}}}</span>
<span class=mi>16</span><span class=o>:</span><span class=mi>02</span><span class=o>:</span><span class=mi>06</span> <span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_remote&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0xF72F&quot;</span><span class=o>,</span><span class=s2>&quot;0008!06&quot;</span><span class=o>:</span><span class=s2>&quot;002B0500&quot;</span><span class=o>,</span><span class=s2>&quot;DimmerUp&quot;</span><span class=o>:</span><span class=kc>true</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;Group&quot;</span><span class=o>:</span><span class=mi>100</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>75</span><span class=o>}}}</span>
<span class=mi>16</span><span class=o>:</span><span class=mi>02</span><span class=o>:</span><span class=mi>08</span> <span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_Light&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0x5ADF&quot;</span><span class=o>,</span><span class=s2>&quot;Dimmer&quot;</span><span class=o>:</span><span class=mi>102</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>80</span><span class=o>}}}</span>
</code></pre></div> <h4>Ikea Remote (E1524/E1810)</h4> <p><code>"ModelId":"TRADFRI remote control","Manufacturer":"IKEA of Sweden"</code></p> <ul> <li>Short press center button - <code>"0006!02":""</code> and <code>"Power":2</code></li> <li>Short press dimmer up - <code>"0008!06":"002B0500"</code> and <code>"DimmerUp":true</code></li> <li>Short press dimmer down - <code>"0008!02":"012B05000000"</code> and <code>"DimmerStep":1</code></li> <li>Short press arrow right - <code>"0005!07":"00010D00"</code> and <code>"ArrowClick":0</code></li> <li>Short press arrow left - <code>"0xF72F","0005!07":"01010D00"</code> and <code>"ArrowClick":1</code></li> <li>Long press dimmer up - <code>"0008!05":"0054"</code> and <code>"DimmerMove":0</code></li> <li>Long press dimmer up release - <code>"0008!07":""</code> and <code>"DimmerStop":true</code></li> <li>Long press dimmer down - <code>"0008!01":"01540000"</code> and <code>"DimmerMove":1</code></li> <li>Long press dimmer down release - <code>,"0008!03":"0000"</code> and <code>"DimmerStop":true</code></li> </ul> <h2 id=zigbee-groups>Zigbee Groups<a class=headerlink href=#zigbee-groups title="Permanent link">~</a></h2> <p>Zigbee has a unique feature call Groups. It allows you to send a single command to a group of devices. For example a remote can control a group of multiple lights.</p> <p>Zigbee groups are 16 bits arbitrary numbers that you can freely assign. When you send to a group, you don't specify a targer address anymore nor an endpoint.</p> <p>Groups works in two steps: first you add devices to groups, second you send commands to groups. See the below <strong>Zigbee Binding</strong> to configure a remote to send commands to a specific group.</p> <p>Configuring groups for devices requires to send commands. Make sure the device is powered and awake (i.e. wake-up battery powered devices).</p> <h4>List all groups for a device.</h4> <p><code>ZbSend {"device":"IKEA_Light","Send":{"GetAllGroups":true}}</code></p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_Light&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0x5ADF&quot;</span><span class=o>,</span><span class=s2>&quot;0004&lt;02&quot;</span><span class=o>:</span><span class=s2>&quot;FF00&quot;</span><span class=o>,</span><span class=s2>&quot;GetGroupCapacity&quot;</span><span class=o>:</span><span class=mi>255</span><span class=o>,</span><span class=s2>&quot;GetGroupCount&quot;</span><span class=o>:</span><span class=mi>0</span><span class=o>,</span><span class=s2>&quot;GetGroup&quot;</span><span class=o>:[],</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>80</span><span class=o>}}}</span>
</code></pre></div> <p>The following response tells you: <code>"GetGroupCount":1</code> the light belongs to one group <code>"GetGroup":[100]</code> and the group number is <code>100</code>.</p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_Light&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0x5ADF&quot;</span><span class=o>,</span><span class=s2>&quot;0004&lt;02&quot;</span><span class=o>:</span><span class=s2>&quot;FF016400&quot;</span><span class=o>,</span><span class=s2>&quot;GetGroupCapacity&quot;</span><span class=o>:</span><span class=mi>255</span><span class=o>,</span><span class=s2>&quot;GetGroupCount&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;GetGroup&quot;</span><span class=o>:[</span><span class=mi>100</span><span class=o>],</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>80</span><span class=o>}}}</span>
</code></pre></div> <h4>Add a group to a device</h4> <p><code>ZbSend {"device":"IKEA_Light","Send":{"AddGroup":100}}</code></p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_Light&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0x5ADF&quot;</span><span class=o>,</span><span class=s2>&quot;0004&lt;00&quot;</span><span class=o>:</span><span class=s2>&quot;006400&quot;</span><span class=o>,</span><span class=s2>&quot;AddGroup&quot;</span><span class=o>:</span><span class=mi>100</span><span class=o>,</span><span class=s2>&quot;AddGroupStatus&quot;</span><span class=o>:</span><span class=mi>0</span><span class=o>,</span><span class=s2>&quot;AddGroupStatusMsg&quot;</span><span class=o>:</span><span class=s2>&quot;SUCCESS&quot;</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>80</span><span class=o>}}}</span>
</code></pre></div> <p>Or if the group already exists:</p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_Light&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0x5ADF&quot;</span><span class=o>,</span><span class=s2>&quot;0004&lt;00&quot;</span><span class=o>:</span><span class=s2>&quot;8A6400&quot;</span><span class=o>,</span><span class=s2>&quot;AddGroup&quot;</span><span class=o>:</span><span class=mi>100</span><span class=o>,</span><span class=s2>&quot;AddGroupStatus&quot;</span><span class=o>:</span><span class=mi>138</span><span class=o>,</span><span class=s2>&quot;AddGroupStatusMsg&quot;</span><span class=o>:</span><span class=s2>&quot;DUPLICATE_EXISTS&quot;</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>80</span><span class=o>}}}</span>
</code></pre></div> <h4>Remove a group</h4> <p><code>ZbSend {"device":"IKEA_Light","Send":{"RemoveGroup":100}}</code></p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_Light&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0x5ADF&quot;</span><span class=o>,</span><span class=s2>&quot;0004&lt;03&quot;</span><span class=o>:</span><span class=s2>&quot;006400&quot;</span><span class=o>,</span><span class=s2>&quot;RemoveGroup&quot;</span><span class=o>:</span><span class=mi>100</span><span class=o>,</span><span class=s2>&quot;RemoveGroupStatus&quot;</span><span class=o>:</span><span class=mi>0</span><span class=o>,</span><span class=s2>&quot;RemoveGroupStatusMsg&quot;</span><span class=o>:</span><span class=s2>&quot;SUCCESS&quot;</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>80</span><span class=o>}}}</span>
</code></pre></div> <p>or if the group does not exist</p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;IKEA_Light&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0x5ADF&quot;</span><span class=o>,</span><span class=s2>&quot;0004&lt;03&quot;</span><span class=o>:</span><span class=s2>&quot;8B6400&quot;</span><span class=o>,</span><span class=s2>&quot;RemoveGroup&quot;</span><span class=o>:</span><span class=mi>100</span><span class=o>,</span><span class=s2>&quot;RemoveGroupStatus&quot;</span><span class=o>:</span><span class=mi>139</span><span class=o>,</span><span class=s2>&quot;RemoveGroupStatusMsg&quot;</span><span class=o>:</span><span class=s2>&quot;NOT_FOUND&quot;</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>80</span><span class=o>}}}</span>
</code></pre></div> <h4>Remove all groups</h4> <p><code>ZbSend {"device":"IKEA_Light","Send":{"RemoveAllGroups":true}}</code></p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbResponse&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0x5ADF&quot;</span><span class=o>,</span><span class=s2>&quot;Name&quot;</span><span class=o>:</span><span class=s2>&quot;IKEA_Light&quot;</span><span class=o>,</span><span class=s2>&quot;Command&quot;</span><span class=o>:</span><span class=s2>&quot;0004!04&quot;</span><span class=o>,</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>0</span><span class=o>,</span><span class=s2>&quot;StatusMessage&quot;</span><span class=o>:</span><span class=s2>&quot;SUCCESS&quot;</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>80</span><span class=o>}}</span>
</code></pre></div> <h4>Sending commands to a group</h4> <p>Just use the attribute <code>"Group":&lt;group_id&gt;</code> instead of <code>"Device":&lt;device&gt;</code> when sending a command.</p> <p>Example:</p> <ul> <li>power on all light in group 100: <code>ZbSend {"group":100,"Send":{"Power":1}}</code></li> <li>set all dimmers in group 100 to 50%: <code>ZbSend {"group":100,"Send":{"Dimmer":127}}</code></li> </ul> <h2 id=zigbee-binding>Zigbee Binding<a class=headerlink href=#zigbee-binding title="Permanent link">~</a></h2> <p>Binding allows a device to send command to another device in the same Zigbee network, without any additional logic. For example, you can set a remote to control directly a group of lights, without any rules on the coordinator. The coordinator will still receive all commands.</p> <p>Example of direct binding <code>ZbBind {"Device":"0xC2EF","ToDevice":"0x5ADF","Endpoint":1,"ToEndpoint":1,"Cluster":6}</code></p> <p>This command links the device <code>0xC2EF</code> that will send all commands for cluster <code>6</code> (On/off cluster) frome endpoint <code>1</code> to the target device <code>0x5ADF</code> on endpoint <code>1</code>.</p> <p>Example of group binding <code>ZbBind {"Device":"0xC2EF","ToGroup":100,"Endpoint":1,"Cluster":6}</code></p> <p>This command links the device <code>0xC2EF</code> that will send all commands for cluster <code>6</code> (On/off clustre) and from endpoint <code>1</code> to the group <code>100</code>.</p> <p>Reponse in case of success:</p> <div class=codehilite><pre><span></span><code><span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/%topic%/</span><span class=n>RESULT</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbBind&quot;</span><span class=o>:{</span><span class=s2>&quot;Device&quot;</span><span class=o>:</span><span class=s2>&quot;0xF72F&quot;</span><span class=o>,</span><span class=s2>&quot;Name&quot;</span><span class=o>:</span><span class=s2>&quot;IKEA_Remote&quot;</span><span class=o>,</span><span class=s2>&quot;Status&quot;</span><span class=o>:</span><span class=mi>0</span><span class=o>,</span><span class=s2>&quot;StatusMessage&quot;</span><span class=o>:</span><span class=s2>&quot;SUCCESS&quot;</span><span class=o>}}</span>
</code></pre></div> <h4>Example: IKEA remote and IKEA Light</h4> <p>IKEA remotes only support 1 group, and can be linked to a light only via group numbers (no direct binding).</p> <ol> <li> <p>Add the light to group 100 <code>ZbSend {"device":"IKEA_Light","Send":{"AddGroup":100}}</code></p> </li> <li> <p>Bind the remote to group 100. Note: you need to press a button on the remote right before sending this command to make sure it's not in sleep mode <code>ZbBind {"Device":"IKEA_Remote","ToGroup":100,"Endpoint":1,"Cluster":6}</code></p> </li> </ol> <h2 id=zigbee-and-hue-emulation-for-alexa>Zigbee and Hue Emulation for Alexa<a class=headerlink href=#zigbee-and-hue-emulation-for-alexa title="Permanent link">~</a></h2> <p>Z2T now supports Hue Emulation for Zigbee lights. It will mimic most of Zigbee gateways, and allows you to control Zigbee lights directly with Alexa, without any MQTT broker nor Alexa skill.</p> <p>Command <code>ZbLight</code> configures a Zigbee device to be Alexa controllable. Specify the number of channels the light supports:</p> <ul> <li><code>0</code> Simple On/Off light</li> <li><code>1</code> White Light with Dimmer</li> <li><code>2</code> White Light with Dimmer and Cold/Warm White</li> <li><code>3</code> RGB Light</li> <li><code>4</code> RGBW Light</li> <li><code>5</code> RGBCW Light, RGB and Cold/Warm White</li> </ul> <p>To set the light, use <code>ZbLight &lt;device&gt;,&lt;nb_of_channels</code>. Ex:</p> <div class=codehilite><pre><span></span><code><span class=err>ZbLight 0x1234,2</span>
<span class=err>ZbLight Kitchen_Light,1   (see ZbName)</span>
</code></pre></div> <p>Once a light is declared, Z2T will monitor any change made to the light via Z2T or via remotes, either from a direct message or via a group message. Z2T will then send a read command to the light, between 200ms and 1000ms later, and memorize the last value.</p> <p>To read the last known status of a light, use <code>ZbLight &lt;device&gt;</code></p> <p>Ex:</p> <div class=codehilite><pre><span></span><code><span class=err>ZbLight Kitchen_Light</span>
<span class=c>MQT: stat/%topic%/RESULT = {&quot;ZbLight&quot;:{&quot;Kitchen_Light&quot;:{&quot;Device&quot;:&quot;0x5ADF&quot;,&quot;Light&quot;:2,&quot;Power&quot;:0,&quot;Dimmer&quot;:130,&quot;Colormode&quot;:2,&quot;CT&quot;:350}}}</span>
</code></pre></div> <h2 id=specific-device-tutorials>Specific Device Tutorials<a class=headerlink href=#specific-device-tutorials title="Permanent link">~</a></h2> <h3 id=osram-mini-switch-and-plug>OSRAM mini switch and plug<a class=headerlink href=#osram-mini-switch-and-plug title="Permanent link">~</a></h3> <p><img src=../_media/zigbee/OSRAM_Switch_mini.jpg style=float:right;width:8em><img src=../_media/zigbee/OSRAM_Plug_AB3257001NJ.jpg style=float:right;width:8em></p> <p>Here is a short tutorial to configuring an ORSRAM switch bound to an OSRAM plug.</p> <h4>1. Pair the OSRAM Plug</h4> <p>Initiate pairing mode:</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbPermitJoin</span> <span class=mi>1</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbPermitJoin&quot;</span><span class=kt>:</span><span class=s>&quot;Done&quot;</span><span class=p>}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>21</span><span class=p>,</span><span class=s>&quot;Message&quot;</span><span class=kt>:</span><span class=s>&quot;Enable Pairing mode for 60 seconds&quot;</span><span class=p>}}</span>
</code></pre></div> <p>Hold the on/off button until your hear a click (+- 10 seconds).</p> <div class=codehilite><pre><span></span><code><span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>34</span><span class=p>,</span><span class=s>&quot;IEEEAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0x7CB03EAA0A0292DD&quot;</span><span class=p>,</span><span class=s>&quot;ShortAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0xF75D&quot;</span><span class=p>,</span><span class=s>&quot;ParentNetwork&quot;</span><span class=kt>:</span><span class=s>&quot;0x0000&quot;</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>30</span><span class=p>,</span><span class=s>&quot;IEEEAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0x7CB03EAA0A0292DD&quot;</span><span class=p>,</span><span class=s>&quot;ShortAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0xF75D&quot;</span><span class=p>,</span><span class=s>&quot;PowerSource&quot;</span><span class=kt>:</span><span class=n>true</span><span class=p>,</span><span class=s>&quot;ReceiveWhenIdle&quot;</span><span class=kt>:</span><span class=n>true</span><span class=p>,</span><span class=s>&quot;Security&quot;</span><span class=kt>:</span><span class=n>false</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>32</span><span class=p>,</span><span class=s>&quot;ActiveEndpoints&quot;</span><span class=kt>:</span><span class=p>[</span><span class=s>&quot;0x03&quot;</span><span class=p>]}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>SENSOR</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbReceived&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;OSRAM_Plug&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0xF75D&quot;</span><span class=p>,</span><span class=s>&quot;Manufacturer&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM&quot;</span><span class=p>,</span><span class=s>&quot;ModelId&quot;</span><span class=kt>:</span><span class=s>&quot;Plug 01&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>3</span><span class=p>,</span><span class=s>&quot;LinkQuality&quot;</span><span class=kt>:</span><span class=mi>44</span><span class=p>}}}</span>
</code></pre></div> <p><strong>(Optional) Give the device a name</strong></p> <p>Giving the device a name makes it easier to configure than using the short address. When naming a device, it is preferable to use the long address <code>IEEEAddr</code> which remains unchanged if you need to pair again your device.</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbName</span> <span class=mh>0x7CB03EAA0A0292DD</span><span class=p>,</span><span class=kt>OSRAM_Plug</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;0xF75D&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Name&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Plug&quot;</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>ZIG:</span> <span class=kt>Zigbee</span> <span class=kt>Devices</span> <span class=kt>Data</span> <span class=n>store</span> <span class=kr>in</span> <span class=kt>Flash</span> <span class=p>(</span><span class=mh>0x402FF800</span> <span class=o>-</span> <span class=n>xxx</span> <span class=n>bytes</span><span class=p>)</span>
</code></pre></div> <h4>2. Pair the OSRAM Switch mini</h4> <p>Hold the Middle and Arrow Down Buttons for 10 Seconds to Reset the Device. </p> <p>Initiate pairing mode:</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbPermitJoin</span> <span class=mi>1</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbPermitJoin&quot;</span><span class=kt>:</span><span class=s>&quot;Done&quot;</span><span class=p>}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>21</span><span class=p>,</span><span class=s>&quot;Message&quot;</span><span class=kt>:</span><span class=s>&quot;Enable Pairing mode for 60 seconds&quot;</span><span class=p>}}</span>
</code></pre></div> <p>Hold the Middle and Arrow Up Buttons for 3 Seconds to connect.</p> <div class=codehilite><pre><span></span><code><span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>34</span><span class=p>,</span><span class=s>&quot;IEEEAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0x000D6F00109C732A&quot;</span><span class=p>,</span><span class=s>&quot;ShortAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0x080C&quot;</span><span class=p>,</span><span class=s>&quot;ParentNetwork&quot;</span><span class=kt>:</span><span class=s>&quot;0x0000&quot;</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>30</span><span class=p>,</span><span class=s>&quot;IEEEAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0x000D6F00109C732A&quot;</span><span class=p>,</span><span class=s>&quot;ShortAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0x080C&quot;</span><span class=p>,</span><span class=s>&quot;PowerSource&quot;</span><span class=kt>:</span><span class=n>false</span><span class=p>,</span><span class=s>&quot;ReceiveWhenIdle&quot;</span><span class=kt>:</span><span class=n>false</span><span class=p>,</span><span class=s>&quot;Security&quot;</span><span class=kt>:</span><span class=n>false</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>32</span><span class=p>,</span><span class=s>&quot;ActiveEndpoints&quot;</span><span class=kt>:</span><span class=p>[</span><span class=s>&quot;0x01&quot;</span><span class=p>,</span><span class=s>&quot;0x02&quot;</span><span class=p>,</span><span class=s>&quot;0x03&quot;</span><span class=p>]}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>SENSOR</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbReceived&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0x080C&quot;</span><span class=p>,</span><span class=s>&quot;Manufacturer&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM&quot;</span><span class=p>,</span><span class=s>&quot;ModelId&quot;</span><span class=kt>:</span><span class=s>&quot;Lightify Switch Mini&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;LinkQuality&quot;</span><span class=kt>:</span><span class=mi>46</span><span class=p>}}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>ZIG:</span> <span class=kt>Zigbee</span> <span class=kt>Devices</span> <span class=kt>Data</span> <span class=n>store</span> <span class=kr>in</span> <span class=kt>Flash</span> <span class=p>(</span><span class=mh>0x402FF800</span> <span class=o>-</span> <span class=n>xxx</span> <span class=n>bytes</span><span class=p>)</span>
</code></pre></div> <p><strong>(Optional) Give the device a name</strong></p> <div class=codehilite><pre><span></span><code><span class=kt>ZbName</span> <span class=mh>0x000D6F00109C732A</span><span class=p>,</span><span class=kt>OSRAM_Remote</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;0x080C&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Name&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;0xF75D&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Name&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Plug&quot;</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>ZIG:</span> <span class=kt>Zigbee</span> <span class=kt>Devices</span> <span class=kt>Data</span> <span class=n>store</span> <span class=kr>in</span> <span class=kt>Flash</span> <span class=p>(</span><span class=mh>0x402FF800</span> <span class=o>-</span> <span class=n>xxx</span> <span class=n>bytes</span><span class=p>)</span>
</code></pre></div> <h4>3. Configure OSRAM switch bindings</h4> <p>By default the OSRAM switch broadcasts the on/off commands to the entire network. Pressing the Up arrow turns on all devices, and the Down arrows turns off all devices.</p> <p>This is often not desirable. We will now bind the remote to a group address so you can selectively turn on and off a group of devices.</p> <p>We will choose group address <code>101</code> below, but you can take any number between 1 and 65535. We need to bind cluster 6 (On/Off) for <strong>both endpoints 1 and 2</strong>.</p> <blockquote> <p><strong>Press any button on the switch</strong> to get it out of sleep mode and immediatly after send the following command:</p> </blockquote> <div class=codehilite><pre><span></span><code><span class=kt>ZbBind</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=p>,</span><span class=s>&quot;ToGroup&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=mi>6</span><span class=p>}</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbBind&quot;</span><span class=kt>:</span><span class=s>&quot;Done&quot;</span><span class=p>}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbBind&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0x080C&quot;</span><span class=p>,</span><span class=s>&quot;Name&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=p>,</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>0</span><span class=p>,</span><span class=s>&quot;StatusMessage&quot;</span><span class=kt>:</span><span class=s>&quot;SUCCESS&quot;</span><span class=p>}}</span>
</code></pre></div> <p>Make sure you see <strong><code>"StatusMessage":"SUCCESS"</code></strong></p> <blockquote> <p><strong>Press any button on the switch</strong> to get it out of sleep mode and immediatly after send the following command:</p> </blockquote> <div class=codehilite><pre><span></span><code><span class=kt>ZbBind</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=p>,</span><span class=s>&quot;ToGroup&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=mi>6</span><span class=p>}</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbBind&quot;</span><span class=kt>:</span><span class=s>&quot;Done&quot;</span><span class=p>}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbBind&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0x080C&quot;</span><span class=p>,</span><span class=s>&quot;Name&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=p>,</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>0</span><span class=p>,</span><span class=s>&quot;StatusMessage&quot;</span><span class=kt>:</span><span class=s>&quot;SUCCESS&quot;</span><span class=p>}}</span>
</code></pre></div> <p>Make sure you see <strong><code>"StatusMessage":"SUCCESS"</code></strong></p> <p>Now the switch will only send commands to the group address <code>101</code>and no more to all devices.</p> <p>You can check the current bindings with the following command (JSON indentation for to ease readability):</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbBindState</span> <span class=kt>OSRAM_Remote</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbBindState&quot;</span><span class=kt>:</span><span class=s>&quot;Done&quot;</span><span class=p>}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span>
    <span class=p>{</span><span class=s>&quot;ZbBindState&quot;</span><span class=kt>:</span>
      <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0x080C&quot;</span><span class=p>,</span><span class=s>&quot;Name&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=p>,</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>0</span><span class=p>,</span><span class=s>&quot;StatusMessage&quot;</span><span class=kt>:</span><span class=s>&quot;SUCCESS&quot;</span><span class=p>,</span>
       <span class=s>&quot;BindingsTotal&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;Bindings&quot;</span><span class=kt>:</span><span class=p>[</span>
         <span class=p>{</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=s>&quot;0x0006&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;ToGroup&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>},</span>
         <span class=p>{</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=s>&quot;0x0006&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;ToGroup&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>}]}}</span>
</code></pre></div> <p>You can now see what happens when you press the Up and Down arrow:</p> <div class=codehilite><pre><span></span><code><span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>SENSOR</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbReceived&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0x080C&quot;</span><span class=p>,</span><span class=s>&quot;0006!01&quot;</span><span class=kt>:</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=s>&quot;Power&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;Group&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>,</span><span class=s>&quot;LinkQuality&quot;</span><span class=kt>:</span><span class=mi>13</span><span class=p>}}}</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>SENSOR</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbReceived&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0x080C&quot;</span><span class=p>,</span><span class=s>&quot;0006!00&quot;</span><span class=kt>:</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=s>&quot;Power&quot;</span><span class=kt>:</span><span class=mi>0</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;Group&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>,</span><span class=s>&quot;LinkQuality&quot;</span><span class=kt>:</span><span class=mi>5</span><span class=p>}}}</span>
</code></pre></div> <h4>4. Add the Plug to the group address</h4> <p>Now we need to configure the plug to listen to group <code>101</code>.</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbSend</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Plug&quot;</span><span class=p>,</span><span class=s>&quot;Send&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;AddGroup&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>}}</span>


<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbSend&quot;</span><span class=kt>:</span><span class=s>&quot;Done&quot;</span><span class=p>}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>SENSOR</span> <span class=ow>=</span>
      <span class=p>{</span><span class=s>&quot;ZbReceived&quot;</span><span class=kt>:</span>
        <span class=p>{</span><span class=s>&quot;OSRAM_Plug&quot;</span><span class=kt>:</span>
          <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0xF75D&quot;</span><span class=p>,</span><span class=s>&quot;0004&lt;00&quot;</span><span class=kt>:</span><span class=s>&quot;006500&quot;</span><span class=p>,</span><span class=s>&quot;AddGroup&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>,</span>
            <span class=s>&quot;AddGroupStatus&quot;</span><span class=kt>:</span><span class=mi>0</span><span class=p>,</span><span class=s>&quot;AddGroupStatusMsg&quot;</span><span class=kt>:</span><span class=s>&quot;SUCCESS&quot;</span><span class=p>,</span>
            <span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>3</span><span class=p>,</span><span class=s>&quot;LinkQuality&quot;</span><span class=kt>:</span><span class=mi>46</span><span class=p>}}}</span>
</code></pre></div> <p>Make sure you see <strong><code>"AddGroupStatusMsg":"SUCCESS"</code></strong></p> <p>You can also check existing bindings with the following command:</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbSend</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Plug&quot;</span><span class=p>,</span><span class=s>&quot;Send&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;GetAllGroups&quot;</span><span class=kt>:</span><span class=n>true</span><span class=p>}}</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbSend&quot;</span><span class=kt>:</span><span class=s>&quot;Done&quot;</span><span class=p>}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>SENSOR</span> <span class=ow>=</span>
      <span class=p>{</span><span class=s>&quot;ZbReceived&quot;</span><span class=kt>:</span>
        <span class=p>{</span><span class=s>&quot;OSRAM_Plug&quot;</span><span class=kt>:</span>
          <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0xF75D&quot;</span><span class=p>,</span><span class=s>&quot;0004&lt;02&quot;</span><span class=kt>:</span><span class=s>&quot;07016500&quot;</span><span class=p>,</span><span class=s>&quot;GetGroupCapacity&quot;</span><span class=kt>:</span><span class=mi>7</span><span class=p>,</span><span class=s>&quot;GetGroupCount&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span>
           <span class=s>&quot;GetGroup&quot;</span><span class=kt>:</span><span class=p>[</span><span class=mi>101</span><span class=p>],</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>3</span><span class=p>,</span><span class=s>&quot;LinkQuality&quot;</span><span class=kt>:</span><span class=mi>46</span><span class=p>}}}</span>
</code></pre></div> <h4>5. (Optional) Control the Plug with Alexa</h4> <p>You can also control your switch with Alexa through Philip Hue Emulation. It will be displayed as an On/Off light (0 channel).</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbLight</span> <span class=kt>OSRAM_Plug</span><span class=p>,</span><span class=mi>0</span>
</code></pre></div> <h4>Recap of commands</h4> <div class=codehilite><pre><span></span><code><span class=kt>ZbPermitJoin</span> <span class=mi>1</span>
</code></pre></div> <p>On the Plug: hold the on/off button until your hear a click (+- 10 seconds).</p> <p>On the Switch: hold the Middle and Arrow Up Buttons for 3 Seconds to connect.</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbName</span> <span class=mh>0x7CB03EAA0A0292DD</span><span class=p>,</span><span class=kt>OSRAM_Plug</span>      <span class=p>(</span><span class=n>adapt</span> <span class=n>to</span> <span class=n>your</span> <span class=n>actual</span> <span class=kt>IEEE</span> <span class=kt>Addresses</span><span class=p>)</span>
<span class=kt>ZbName</span> <span class=mh>0x000D6F00109C732A</span><span class=p>,</span><span class=kt>OSRAM_Remote</span>    <span class=p>(</span><span class=n>adapt</span> <span class=n>to</span> <span class=n>your</span> <span class=n>actual</span> <span class=kt>IEEE</span> <span class=kt>Addresses</span><span class=p>)</span>
<span class=kt>ZbSend</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Plug&quot;</span><span class=p>,</span><span class=s>&quot;Send&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;AddGroup&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>}}</span>
<span class=kt>ZbLight</span> <span class=kt>OSRAM_Plug</span><span class=p>,</span><span class=mi>0</span>
</code></pre></div> <p>Press any button on the switch to get it out of sleep mode.</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbBind</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=p>,</span><span class=s>&quot;ToGroup&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=mi>6</span><span class=p>}</span>
<span class=kt>ZbBind</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;OSRAM_Remote&quot;</span><span class=p>,</span><span class=s>&quot;ToGroup&quot;</span><span class=kt>:</span><span class=mi>101</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=mi>6</span><span class=p>}</span>
</code></pre></div> <h3 id=philips-hue-motion-sensor>Philips Hue Motion Sensor<a class=headerlink href=#philips-hue-motion-sensor title="Permanent link">~</a></h3> <p><img src=../_media/zigbee/Philips_motion_sensor_SML001.jpg style=float:right;width:10em></p> <p>Z2T supports Philips Hue Motion Sensor <code>SML001</code> and requires some additional configuration. By default the sensor will not report any value unless: </p> <ol> <li>you configure a Zigbee Binding to your coordinator</li> <li>you set an explicit Configuration Reporting policy on the sensor</li> </ol> <h4>1. Pair the device</h4> <p>Initiate pairing mode:</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbPermitJoin</span> <span class=mi>1</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbPermitJoin&quot;</span><span class=kt>:</span><span class=s>&quot;Done&quot;</span><span class=p>}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>21</span><span class=p>,</span><span class=s>&quot;Message&quot;</span><span class=kt>:</span><span class=s>&quot;Enable Pairing mode for 60 seconds&quot;</span><span class=p>}}</span>
</code></pre></div> <p>Press and hold the setup button on the rear of the device for +- 10 seconds (until the green light goes solid) to initiate pairing. Please note that the pairing indicator light is below the main sensor (as oppose to the obvious indicator above the main sensor).</p> <div class=codehilite><pre><span></span><code><span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>34</span><span class=p>,</span><span class=s>&quot;IEEEAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0x0017880103295B70&quot;</span><span class=p>,</span><span class=s>&quot;ShortAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0xB6CD&quot;</span><span class=p>,</span><span class=s>&quot;ParentNetwork&quot;</span><span class=kt>:</span><span class=s>&quot;0x0000&quot;</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>30</span><span class=p>,</span><span class=s>&quot;IEEEAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0x0017880103295B70&quot;</span><span class=p>,</span><span class=s>&quot;ShortAddr&quot;</span><span class=kt>:</span><span class=s>&quot;0xB6CD&quot;</span><span class=p>,</span><span class=s>&quot;PowerSource&quot;</span><span class=kt>:</span><span class=n>false</span><span class=p>,</span><span class=s>&quot;ReceiveWhenIdle&quot;</span><span class=kt>:</span><span class=n>false</span><span class=p>,</span><span class=s>&quot;Security&quot;</span><span class=kt>:</span><span class=n>false</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbState&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Status&quot;</span><span class=kt>:</span><span class=mi>32</span><span class=p>,</span><span class=s>&quot;ActiveEndpoints&quot;</span><span class=kt>:</span><span class=p>[</span><span class=s>&quot;0x02&quot;</span><span class=p>,</span><span class=s>&quot;0x01&quot;</span><span class=p>]}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>tele</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>SENSOR</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;ZbReceived&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;HueMotion&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;0xB6CD&quot;</span><span class=p>,</span><span class=s>&quot;Manufacturer&quot;</span><span class=kt>:</span><span class=s>&quot;Philips&quot;</span><span class=p>,</span><span class=s>&quot;ModelId&quot;</span><span class=kt>:</span><span class=s>&quot;SML001&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;LinkQuality&quot;</span><span class=kt>:</span><span class=mi>15</span><span class=p>}}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>ZIG:</span> <span class=kt>Zigbee</span> <span class=kt>Devices</span> <span class=kt>Data</span> <span class=n>store</span> <span class=kr>in</span> <span class=kt>Flash</span> <span class=p>(</span><span class=mh>0x402FF800</span> <span class=o>-</span> <span class=n>xxx</span> <span class=n>bytes</span><span class=p>)</span>
</code></pre></div> <p><strong>(Optional) Give the device a name</strong></p> <p>Giving the device a name makes it easier to configure than using the short address. When naming a device, it is preferable to use the long address <code>IEEEAddr</code> which remains unchanged if you need to pair again your device.</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbName</span> <span class=mh>0x0017880103295B70</span><span class=p>,</span><span class=kt>HueMotion</span>

<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>MQT:</span> <span class=n>stat</span><span class=o>/&lt;</span><span class=n>topic</span><span class=o>&gt;/</span><span class=kt>RESULT</span> <span class=ow>=</span> <span class=p>{</span><span class=s>&quot;0xB6CD&quot;</span><span class=kt>:</span><span class=p>{</span><span class=s>&quot;Name&quot;</span><span class=kt>:</span><span class=s>&quot;HueMotion&quot;</span><span class=p>}}</span>
<span class=nf>xx</span><span class=kt>:</span><span class=n>xx</span><span class=kt>:</span><span class=n>xx</span> <span class=kt>ZIG:</span> <span class=kt>Zigbee</span> <span class=kt>Devices</span> <span class=kt>Data</span> <span class=n>store</span> <span class=kr>in</span> <span class=kt>Flash</span> <span class=p>(</span><span class=mh>0x402FF800</span> <span class=o>-</span> <span class=n>xxx</span> <span class=n>bytes</span><span class=p>)</span>
</code></pre></div> <h4>2. Set the Zigbee bindings</h4> <p>This will tell the device to send attributes readings to the coordinator. Coordinator's address is always <code>0x0000</code>.</p> <div class=codehilite><pre><span></span><code><span class=err>ZbBind</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;HueMotion&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&quot;ToDevice&quot;</span><span class=p>:</span><span class=s2>&quot;0x0000&quot;</span><span class=p>,</span><span class=nt>&quot;ToEndpoint&quot;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&quot;Cluster&quot;</span><span class=p>:</span><span class=s2>&quot;0x0001&quot;</span><span class=p>}</span>
<span class=err>ZbBind</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;HueMotion&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&quot;ToDevice&quot;</span><span class=p>:</span><span class=s2>&quot;0x0000&quot;</span><span class=p>,</span><span class=nt>&quot;ToEndpoint&quot;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&quot;Cluster&quot;</span><span class=p>:</span><span class=s2>&quot;0x0400&quot;</span><span class=p>}</span>
<span class=err>ZbBind</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;HueMotion&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&quot;ToDevice&quot;</span><span class=p>:</span><span class=s2>&quot;0x0000&quot;</span><span class=p>,</span><span class=nt>&quot;ToEndpoint&quot;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&quot;Cluster&quot;</span><span class=p>:</span><span class=s2>&quot;0x0402&quot;</span><span class=p>}</span>
<span class=err>ZbBind</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;HueMotion&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&quot;ToDevice&quot;</span><span class=p>:</span><span class=s2>&quot;0x0000&quot;</span><span class=p>,</span><span class=nt>&quot;ToEndpoint&quot;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&quot;Cluster&quot;</span><span class=p>:</span><span class=s2>&quot;0x0406&quot;</span><span class=p>}</span>
</code></pre></div> <h4>3. Set Configure Reporting</h4> <p>This configuration tells the motion sensor to report attributes on a regular basis (min once per hour) and whenever a change occurs.</p> <div class=codehilite><pre><span></span><code><span class=err>ZbSend</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;HueMotion&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&quot;Send&quot;</span><span class=p>:</span><span class=s2>&quot;0001_06/00210020100E30F200&quot;</span><span class=p>}</span>
<span class=err>ZbSend</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;HueMotion&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&quot;Send&quot;</span><span class=p>:</span><span class=s2>&quot;0400_06/000000210000100E0000&quot;</span><span class=p>}</span>
<span class=err>ZbSend</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;HueMotion&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&quot;Send&quot;</span><span class=p>:</span><span class=s2>&quot;0402_06/000000290000100E1900&quot;</span><span class=p>}</span>
<span class=err>ZbSend</span> <span class=p>{</span><span class=nt>&quot;Device&quot;</span><span class=p>:</span><span class=s2>&quot;HueMotion&quot;</span><span class=p>,</span><span class=nt>&quot;Endpoint&quot;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&quot;Send&quot;</span><span class=p>:</span><span class=s2>&quot;0406_06/000000180000100E&quot;</span><span class=p>}</span>
</code></pre></div> <h4>Recap of commands</h4> <div class=codehilite><pre><span></span><code><span class=kt>ZbPermitJoin</span> <span class=mi>1</span>
</code></pre></div> <p>Press and hold the setup button on the rear of the device for +- 10 seconds (until the green light goes solid).</p> <div class=codehilite><pre><span></span><code><span class=kt>ZbName</span> <span class=mh>0x0017880103295B70</span><span class=p>,</span><span class=kt>HueMotion</span>       <span class=p>(</span><span class=n>adapt</span> <span class=n>to</span> <span class=n>your</span> <span class=n>actual</span> <span class=kt>IEEE</span> <span class=kt>Addresses</span><span class=p>)</span>

<span class=kt>ZbBind</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;HueMotion&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;ToDevice&quot;</span><span class=kt>:</span><span class=s>&quot;0x0000&quot;</span><span class=p>,</span><span class=s>&quot;ToEndpoint&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=s>&quot;0x0001&quot;</span><span class=p>}</span>
<span class=kt>ZbBind</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;HueMotion&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;ToDevice&quot;</span><span class=kt>:</span><span class=s>&quot;0x0000&quot;</span><span class=p>,</span><span class=s>&quot;ToEndpoint&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=s>&quot;0x0400&quot;</span><span class=p>}</span>
<span class=kt>ZbBind</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;HueMotion&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;ToDevice&quot;</span><span class=kt>:</span><span class=s>&quot;0x0000&quot;</span><span class=p>,</span><span class=s>&quot;ToEndpoint&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=s>&quot;0x0402&quot;</span><span class=p>}</span>
<span class=kt>ZbBind</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;HueMotion&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;ToDevice&quot;</span><span class=kt>:</span><span class=s>&quot;0x0000&quot;</span><span class=p>,</span><span class=s>&quot;ToEndpoint&quot;</span><span class=kt>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&quot;Cluster&quot;</span><span class=kt>:</span><span class=s>&quot;0x0406&quot;</span><span class=p>}</span>

<span class=kt>ZbSend</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;HueMotion&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;Send&quot;</span><span class=kt>:</span><span class=s>&quot;0001_06/00210020100E30F200&quot;</span><span class=p>}</span>
<span class=kt>ZbSend</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;HueMotion&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;Send&quot;</span><span class=kt>:</span><span class=s>&quot;0400_06/000000210000100E0000&quot;</span><span class=p>}</span>
<span class=kt>ZbSend</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;HueMotion&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;Send&quot;</span><span class=kt>:</span><span class=s>&quot;0402_06/000000290000100E1900&quot;</span><span class=p>}</span>
<span class=kt>ZbSend</span> <span class=p>{</span><span class=s>&quot;Device&quot;</span><span class=kt>:</span><span class=s>&quot;HueMotion&quot;</span><span class=p>,</span><span class=s>&quot;Endpoint&quot;</span><span class=kt>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&quot;Send&quot;</span><span class=kt>:</span><span class=s>&quot;0406_06/000000180000100E&quot;</span><span class=p>}</span>
</code></pre></div> <h3 id=ikea-onoff-switch-e1743>Ikea ON/OFF Switch (E1743)<a class=headerlink href=#ikea-onoff-switch-e1743 title="Permanent link">~</a></h3> <p><code>"ModelId":"TRADFRI on/off switch","Manufacturer":"IKEA of Sweden"</code></p> <ul> <li>Short press <code>O</code> - <code>0006!00</code></li> <li>Short press <code>I</code> - <code>0006!01</code></li> <li>Long press <code>O</code> - <code>0008!01</code></li> <li>Long press <code>I</code> - <code>0008!05</code></li> <li>Long press release <code>O</code> or <code>I</code> - <code>0008!07</code></li> </ul> <p>In this example Tradfri switch reports on <code>0x7596</code> and is used to control another Tasmota light device:</p> <div class=codehilite><pre><span></span><code><span class=kt>Rule</span>
  <span class=n>on</span> <span class=kt>ZbReceived</span><span class=o>#</span><span class=mh>0x7596</span><span class=o>#</span><span class=mi>0006</span><span class=o>!</span><span class=mi>00</span><span class=ow>=</span> <span class=kr>do</span> <span class=n>publish</span> <span class=n>cmnd</span><span class=o>/%</span><span class=n>topic</span><span class=o>%/</span><span class=kt>POWER</span> <span class=kt>OFF</span> <span class=n>endon</span> 
  <span class=n>on</span> <span class=kt>ZbReceived</span><span class=o>#</span><span class=mh>0x7596</span><span class=o>#</span><span class=mi>0006</span><span class=o>!</span><span class=mi>01</span><span class=ow>=</span> <span class=kr>do</span> <span class=n>publish</span> <span class=n>cmnd</span><span class=o>/%</span><span class=n>topic</span><span class=o>%/</span><span class=kt>POWER</span> <span class=kt>OFF</span> <span class=n>endon</span> 
  <span class=n>on</span> <span class=kt>ZbReceived</span><span class=o>#</span><span class=mh>0x7596</span><span class=o>#</span><span class=mi>0008</span><span class=o>!</span><span class=mi>01</span><span class=ow>=</span> <span class=kr>do</span> <span class=n>publish</span> <span class=n>cmnd</span><span class=o>/%</span><span class=n>topic</span><span class=o>%/</span><span class=kt>Dimmer</span> <span class=o>-</span> <span class=n>endon</span> 
  <span class=n>on</span> <span class=kt>ZbReceived</span><span class=o>#</span><span class=mh>0x7596</span><span class=o>#</span><span class=mi>0008</span><span class=o>!</span><span class=mi>05</span><span class=ow>=</span> <span class=kr>do</span> <span class=n>publish</span> <span class=n>cmnd</span><span class=o>/%</span><span class=n>topic</span><span class=o>%/</span><span class=kt>Dimmer</span> <span class=o>+</span> <span class=n>endon</span>
</code></pre></div> <h3 id=aqara-water-leak-sensor-sjcgq11lm>Aqara Water Leak Sensor (SJCGQ11LM)<a class=headerlink href=#aqara-water-leak-sensor-sjcgq11lm title="Permanent link">~</a></h3> <p><code>"ModelId":"lumi.sensor_wleak.aq1","Manufacturer":"LUMI"</code></p> <p>In this example sensor reports on <code>0x099F</code> and sends an mqtt message to topic <code>stat/leak_sensor/LEAK</code>:</p> <div class=codehilite><pre><span></span><code><span class=kt>Rule</span>
  <span class=n>on</span> <span class=kt>ZbReceived</span><span class=o>#</span><span class=mh>0x099F</span><span class=o>#</span><span class=mi>0500</span><span class=o>!</span><span class=mi>00</span><span class=ow>=</span><span class=mi>010000</span><span class=kt>FF0000</span> <span class=kr>do</span> <span class=n>publish</span> <span class=n>stat</span><span class=o>/</span><span class=n>leak_sensor</span><span class=o>/</span><span class=kt>LEAK</span> <span class=kt>ON</span> <span class=n>endon</span> 
  <span class=n>on</span> <span class=kt>ZbReceived</span><span class=o>#</span><span class=mh>0x099F</span><span class=o>#</span><span class=mi>0500</span><span class=o>!</span><span class=mi>00</span><span class=ow>=</span><span class=mi>000000</span><span class=kt>FF0000</span> <span class=kr>do</span> <span class=n>publish</span> <span class=n>stat</span><span class=o>/</span><span class=n>leak_sensor</span><span class=o>/</span><span class=kt>LEAK</span> <span class=kt>OFF</span> <span class=n>endon</span> 
</code></pre></div> <h3 id=unrecognized-commands-or-attributes>Unrecognized commands or attributes<a class=headerlink href=#unrecognized-commands-or-attributes title="Permanent link">~</a></h3> <p>If your device pairs successfully with Zigbee2Tasmota but doesn't report on standardized endpoint you will see messages like these: <br> <code>{"ZbReceived":{"0x099F":{"0500!00":"010000FF0000","LinkQuality":70}}}</code> <br> <code>{"ZbReceived":{"0x7596":{"0006!01":"","LinkQuality":65}}}</code></p> <p>In this case you will have to use rules or an external home automation solution to parse the ZbReceived messages. The following section will focus only on rules to utilize the device inside Tasmota ecosystem.</p> <h2 id=zigbee2tasmota-status-codes>Zigbee2Tasmota Status Codes<a class=headerlink href=#zigbee2tasmota-status-codes title="Permanent link">~</a></h2> <p>You can inspect the log output to determine whether Zigbee2Tasmota started correctly. Zigbee2Tasmota sends several status messages to inform the MQTT host about initialization. </p> <div class=codehilite><pre><span></span><code><span class=err>{&quot;ZbState&quot;:{&quot;Status&quot;:1,&quot;Message&quot;:&quot;CC2530 booted&quot;,&quot;RestartReason&quot;:&quot;Watchdog&quot;,&quot;MajorRel&quot;:2,&quot;MinorRel&quot;:6}}</span>
</code></pre></div> <ul> <li><code>Status</code> contains a numeric code about the status message<ul> <li><code>0</code>: initialization complete, <em>Zigbee2Tasmota is running normally</em></li> <li><code>1</code>: booting</li> <li><code>2</code>: resetting CC2530 configuration</li> <li><code>3</code>: starting Zigbee coordinator</li> <li><code>20</code>: disabling Permit Join</li> <li><code>21</code>: allowing Permit Join for 60 seconds</li> <li><code>22</code>: allowing Permit Join until next boot</li> <li><code>30</code>: Zigbee device connects or reconnects</li> <li><code>31</code>: Received Node Descriptor information for a Zigbee device</li> <li><code>32</code>: Received the list of active endpoints for a Zigbee device</li> <li><code>33</code>: Received the simple Descriptor with active ZCL clusters for a Zigbee device</li> <li><code>50</code>: reporting CC2530 firmware version</li> <li><code>51</code>: reporting CC2530 device information and associated devices</li> <li><code>98</code>: error, unsupported CC2530 firmware</li> <li><code>99</code>: general error, <mark>Zigbee2Tasmota was unable to start</mark></li> </ul> </li> <li><code>Message</code> (optional) a human-readable message</li> <li>other fields depending on the message (e.g., Status=<code>50</code> or Status=<code>51</code>)</li> </ul> <h2 id=zigbee-internals>Zigbee internals<a class=headerlink href=#zigbee-internals title="Permanent link">~</a></h2> <p>This page is for developers who want to understand how Zigbee2Tasmota (Z2T) works and its implementation details.</p> <h3 id=cc2530-serial-protocol>CC2530 Serial protocol<a class=headerlink href=#cc2530-serial-protocol title="Permanent link">~</a></h3> <p>The CC2530 is flashed with Texas Instrument ZNP Software version 1.2. The protocol is build on a serial communication between the main cpu and the CC2530.</p> <p><a href=../_media/zigbee/Z-Stack_API_1_2.pdf>Z-Stack 1.2 Monitor and Test API</a>{target=_blank}</p> <p>Serial communication is configured as 8N1, 115200 bauds. We suggest to use GPIO13/15 because they have hardware serial support. Please note that there is only one usable hardware serial, either on GPIO1/3 or GPIO13/15.</p> <p>To enable hardware serial on GPIO13/15 for Tasmota, set <code>Serial 0</code> and restart. Otherwise Z2T will use Software serial provided by TasmotaSerial.</p> <p>Receiving 115200 bauds in software is a timing challenge. Here is the anatomy of a byte transmitted in serial mode. Each bit is 8.7µs, or ~700 CPU cycles at 80MHz (1400 cycles at 160MHz).</p> <p>It all starts with a LOW "start bit" that generates an interrupt transferred to TasmotaSerial. Then TasmotaSerial enters a tightly controlled loop to read each bit (least sifnificant first). The frame stops with a HIGH stop bit.</p> <p><img alt="Typical serial frame" src=../_media/zigbee/Serial.png></p> <p>What can go wrong? Tasmota may be already handling an interrupt when the start bit arrives, potentially causing a shift by 1 bit and a wrong message.</p> <p>Here is a 0xFE byte correctly received:</p> <p><img alt="Frame 0xFE correctly read" src=../_media/zigbee/Serial_ok.png></p> <p>Same frame with a delay in the interrupt handler, and mistakenly read 0xFF:</p> <p><img alt="Frame 0xFE incorrectly read to 0xFF" src=../_media/zigbee/Serial_ko.png></p> <p>TasmotaSerial has been improved to allow receiving a train of bytes withtout any disruption.</p> <p>CC2530 generally sends all the bytes one after the other for a single ZNP message (up to 250 bytes). Instead of giving back control after the first byte, the TasmotaSerial interrupt handler continues to monitor the serial RX line for the next 4 bits and checks whether a new start bit arrived. It avoids any error after the first byte was received.</p> <p><img alt="Tasmota Serial chaining bytes without releasing interrupts" src=../_media/zigbee/Serial_tasmota.png></p> <p>Still the first byte in the message could have been wrong. Fortunately, the first byte sent by ZNP is always 0xFE (see below). This means that if the interrupt arrives too late, Tasmota will read 0xFF instead of 0xFE. Z2T software does automatic error correction in this case, i.e. if the first byte received is 0xFF, it is automatically assumed to be 0xFE and the rest of the message is read normally.</p> <p>With these two schemes, software serial for Zigbee proved to be extremely reliable, even at 80MHz. It is highly recommended though to run at 160MHz.</p> <h3 id=state-machine-cc2530-initialization-and-configuration>State machine - CC2530 initialization and configuration<a class=headerlink href=#state-machine-cc2530-initialization-and-configuration title="Permanent link">~</a></h3> <p>After Tasmota boots, it sends the sequence <code>410001</code> to force a CC2530 hardware reset. Z2T implements an asynchronous state machine to handle the initialization and configuration of the CC2530. The state machine sends commands and waits for responses (with time-outs) and takes different branches depending on the responses.</p> <h4>Instruction set</h4> <p>The program is encoded as a list of 32 bits instructions, stored in Flash in the <code>zb_prog</code> array of type <code>Zigbee_Instruction[]</code>. There is a PC (program counter) that is increased at each tick (i.e. every 50ms).</p> <p>The state machine has very simple instructions.</p> <p>Instructions encoded with 4 bytes:</p> <ul> <li><code>NOOP</code>: no-operation, do nothing and move to the next instruction</li> <li><code>LABEL(x)</code>: no-operation, and defines a Label (8 bits) that can be called by code.</li> <li><code>GOTO(x)</code>: moves the PC to the instruction with LABEL(x)</li> <li><code>ZI_ON_ERROR_GOTO(x)</code>: if an error occurs, move to label <x></li> <li><code>ZI_ON_TIMEOUT_GOTO(x)</code>: if a timeout occurs, move to lavel <x></li> <li><code>WAIT(y)</code>: wait for <y> milliseconds (unsigned 16 bits). Note the granularity is 50ms and the wait is non-blocking</li> <li><code>WAIT_FOREVER</code>: pause the state machine and wait for an external goto</li> <li><code>STOP</code>: stop completely the state machine, only used after an unrecoverable error</li> </ul> <p>Instructions encoded with 8 bytes:</p> <ul> <li><code>CALL(f, x)</code>: call a function, <f> is the address of the function of type <code>uint32_t f(uint8_t)</code>. The input parameter is <x>. The response is according to callbacks responses, except <code>-1</code> (time-out) simply continues the flow.</li> <li><code>LOG(m)</code>: log the string <m>. <m> can be in PROGMEM. For debugging only.</li> <li><code>MQTT_STATE(x, m)</code>: sends a MQTT <code>ZbState</code> message, with status code <x> and message <m>. <m> can be in PROGMEM.</li> <li><code>SEND(d)</code>: send a ZNP sequence to CC2530. <d> is an array of <uint8_t>, a macro computes automatically the size of the array. <d> can be in PROGMEM.</li> <li><code>WAIT_RECV(x, m)</code>: wait for a specific message <m> to be received with a time-out of <x> (uint16_t). Messages take into account are owly those matching the first 2 bytes. The complete message match is expected or an error is generated. If the message received is longer than <m>, additional bytes are ignored</li> <li><code>WAIT_UNTIL(x, m)</code>: similar to <code>WAIT_RECV</code> but message that don't match are ignored, until a matching message is received.</li> <li><code>ON_RECV_UNEXPECTED(f)</code>: if we received an unexpected (or unsupported) zigbee message, call function <f></li> </ul> <p>Instructions encoded with 12 bytes:</p> <ul> <li><code>WAIT_RECV_FUNC(x, m, f)</code>: similar to <code>WAIT_RECV</code> and a function <f> is called when the message matches.</li> </ul> <p>All callbacks return <code>int32_t</code> with the following effect:</p> <ul> <li><code>&gt; 0</code>: goto the corresponding label</li> <li><code>0</code>: continue</li> <li><code>-1</code>: signal a time-out</li> <li><code>&lt; -1</code>: trigger an error (goto on_error) </li> </ul> <h4>Initialization code for the state machine</h4> <p>At Tasmota start-up, the state-machine fires. The current Z2T pseudo-code does the following:</p> <p>Init:</p> <ul> <li>Set-up all the error handling functions</li> <li>Wait for 10.5 seconds after boot</li> <li>Send a RESET to CC2530</li> <li>Wait for CC2530 boot</li> </ul> <p>Check configuration (if something is wrong, go to CONFIGURE):</p> <ul> <li>Check if the CC2530 was previously configured. It uses the same 1-byte Non-Volatile 0xF00 address and stores 0x55.</li> <li>Checks the Z-Stack version</li> <li>Checks the internal configuration: PanID, Ext PanID, Channel, PFGK and PFGKEN.</li> <li>If all good, emit an MQTT message saying Zigbee is configured</li> <li>Goto Start</li> </ul> <p>Configure (only if needed):</p> <ul> <li>Emit an MQTT message for reconfiguration</li> <li>Do a factory reset of CC2530</li> <li>Reset the device once again</li> <li>Configure the following: PanId, Ext PanId, Channel, set type to Coordinator, PFKEY, PFKEYEN, Security Module</li> <li>Create NF 0xF00 location and store 0x55</li> <li>Goto Start</li> </ul> <p>Start:</p> <ul> <li>Wait for CC2530 message saying the coordinator sucessfully started</li> <li>Query DeviceInfo</li> <li>Query Node Descriptor</li> <li>Query Active Endpoints</li> <li>Register 2 endpoints with profile 0x0104 (Home Automation) : 0x01 (default), 0x0B (for Xiaomi)</li> <li>Query Active Endpoints to verify 0x01 and 0x0B are active</li> <li>Close PermitJoin: don't accept any pairing</li> <li>Emit an MQTT message to indicate Zigbee started</li> <li>Mark Zigbee as initialized, accept incoming messages</li> <li>Load device configuration from Flash</li> <li>Query any lights declared with <code>ZbLight</code> to read their current states</li> <li>Pause the state machine</li> </ul> <h3 id=pairing-devices>Pairing devices<a class=headerlink href=#pairing-devices title="Permanent link">~</a></h3> <p>When you open pairing with <code>ZbPermitJoin 1</code> (60 seconds) or <code>ZbPermitJoin 99</code> (until next reboot), you allow new devices to join the network.</p> <p>Example below is for an OSRAM Plug.</p> <p>When a new devices joins, Z2T receives a TC Device Indication: <code>ZDO_TC_DEV_IND</code> (45CA) message with the device short (16 bits) address and IEEEAddress (64 bits).</p> <div class=codehilite><pre><span></span><code><span class=mi>16</span><span class=err>:</span><span class=mi>39</span><span class=err>:</span><span class=mi>26</span> <span class=err>MQT:</span> <span class=err>tele/Zigbee_home/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbState&quot;</span><span class=p>:{</span><span class=nt>&quot;Status&quot;</span><span class=p>:</span><span class=mi>30</span><span class=p>,</span><span class=nt>&quot;IEEEAddr&quot;</span><span class=p>:</span><span class=s2>&quot;0x7CB03EAA0A0292DD&quot;</span><span class=p>,</span><span class=nt>&quot;ShortAddr&quot;</span><span class=p>:</span><span class=s2>&quot;0xF75D&quot;</span><span class=p>,</span><span class=nt>&quot;PowerSource&quot;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&quot;ReceiveWhenIdle&quot;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&quot;Security&quot;</span><span class=p>:</span><span class=kc>false</span><span class=p>}}</span>
</code></pre></div> <p>Z2T then queries the device for additional information, like <code>ZbProbe</code> would do.</p> <p>First probe for Active Endpoint <code>ZDO_ACTIVE_EP_REQ</code></p> <div class=codehilite><pre><span></span><code><span class=mi>16</span><span class=err>:</span><span class=mi>39</span><span class=err>:</span><span class=mi>26</span> <span class=err>MQT:</span> <span class=err>tele/Zigbee_home/RESULT</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;ZbState&quot;</span><span class=p>:{</span><span class=nt>&quot;Status&quot;</span><span class=p>:</span><span class=mi>32</span><span class=p>,</span><span class=nt>&quot;ActiveEndpoints&quot;</span><span class=p>:[</span><span class=s2>&quot;0x03&quot;</span><span class=p>]}}</span>
</code></pre></div> <p>Finally query for the following general attributes: Manufacturer Id and Model Id.</p> <div class=codehilite><pre><span></span><code><span class=mi>16</span><span class=o>:</span><span class=mi>39</span><span class=o>:</span><span class=mi>26</span> <span class=n>ZIG</span><span class=o>:</span> <span class=n>ZbZCLRawReceived</span><span class=o>:</span> <span class=o>{</span><span class=s2>&quot;0xF75D&quot;</span><span class=o>:{</span><span class=s2>&quot;0000/0004&quot;</span><span class=o>:</span><span class=s2>&quot;OSRAM&quot;</span><span class=o>,</span><span class=s2>&quot;0000/0005&quot;</span><span class=o>:</span><span class=s2>&quot;Plug 01&quot;</span><span class=o>}}</span>
<span class=mi>16</span><span class=o>:</span><span class=mi>39</span><span class=o>:</span><span class=mi>26</span> <span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/tasmota/Zigbee_home/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;ZbReceived&quot;</span><span class=o>:{</span><span class=s2>&quot;0xF75D&quot;</span><span class=o>:{</span><span class=s2>&quot;Manufacturer&quot;</span><span class=o>:</span><span class=s2>&quot;OSRAM&quot;</span><span class=o>,</span><span class=s2>&quot;ModelId&quot;</span><span class=o>:</span><span class=s2>&quot;Plug 01&quot;</span><span class=o>,</span><span class=s2>&quot;Endpoint&quot;</span><span class=o>:</span><span class=mi>3</span><span class=o>,</span><span class=s2>&quot;LinkQuality&quot;</span><span class=o>:</span><span class=mi>36</span><span class=o>}}}</span>
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../Bluetooth/ title=Bluetooth class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Bluetooth </div> </div> </a> <a href=../Tasmota-IR/ title="IR Communication" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> IR Communication </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M297.216 243.2c0 15.616-11.52 28.416-26.112 28.416-14.336 0-26.112-12.8-26.112-28.416s11.52-28.416 26.112-28.416c14.592 0 26.112 12.8 26.112 28.416zm-119.552-28.416c-14.592 0-26.112 12.8-26.112 28.416s11.776 28.416 26.112 28.416c14.592 0 26.112-12.8 26.112-28.416.256-15.616-11.52-28.416-26.112-28.416zM448 52.736V512c-64.494-56.994-43.868-38.128-118.784-107.776l13.568 47.36H52.48C23.552 451.584 0 428.032 0 398.848V52.736C0 23.552 23.552 0 52.48 0h343.04C424.448 0 448 23.552 448 52.736zm-72.96 242.688c0-82.432-36.864-149.248-36.864-149.248-36.864-27.648-71.936-26.88-71.936-26.88l-3.584 4.096c43.52 13.312 63.744 32.512 63.744 32.512-60.811-33.329-132.244-33.335-191.232-7.424-9.472 4.352-15.104 7.424-15.104 7.424s21.248-20.224 67.328-33.536l-2.56-3.072s-35.072-.768-71.936 26.88c0 0-36.864 66.816-36.864 149.248 0 0 21.504 37.12 78.08 38.912 0 0 9.472-11.52 17.152-21.248-32.512-9.728-44.8-30.208-44.8-30.208 3.766 2.636 9.976 6.053 10.496 6.4 43.21 24.198 104.588 32.126 159.744 8.96 8.96-3.328 18.944-8.192 29.44-15.104 0 0-12.8 20.992-46.336 30.464 7.68 9.728 16.896 20.736 16.896 20.736 56.576-1.792 78.336-38.912 78.336-38.912z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.a0c4167b.min.js></script> <script src=../assets/javascripts/bundle.fb26dd1d.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>