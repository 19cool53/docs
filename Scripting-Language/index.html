<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tasmota open source firmware for ESP8266 documentation and help"><link href=https://tasmota.github.io/docs/Scripting-Language/ rel=canonical><link rel="shortcut icon" href=../_media/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-5.0.0rc4"><title>Scripting - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.c1451e9e.min.css><link rel=stylesheet href=../assets/stylesheets/palette.4444686e.min.css><meta name=theme-color content=#2196f3><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Barlow",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-140681905-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#features class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://tasmota.github.io/docs/ title=Tasmota class="md-header-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z /></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Tasmota </span> <span class="md-header-nav__topic md-ellipsis"> Scripting </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z /></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Features </a> </li> <li class=md-tabs__item> <a href=../Alexa/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Displays/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://tasmota.github.io/docs/ title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Home class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../About/ title=About class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ title=Upgrading class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ title=MQTT class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ title=Commands class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ title=Templates class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ title=Components class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ title=Modules class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Rules/ title=Rules class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Timers/ title=Timers class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../Lights/ title=Lights class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ title="Buttons and Switches" class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ title=Peripherals class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ title=TuyaMCU class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ title="Device Groups" class=md-nav__link> Device Groups </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ title="Blinds and Shutters" class=md-nav__link> Blinds and Shutters </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ title="IR Communication" class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../WebUI/ title=WebUI class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ title=Compiling class=md-nav__link> Compiling </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-21 type=checkbox id=nav-21 checked> <label class=md-nav__link for=nav-21> Features <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Features data-md-level=1> <label class=md-nav__title for=nav-21> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ title=Scripting class="md-nav__link md-nav__link--active"> Scripting </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ title=Bluetooth class=md-nav__link> Bluetooth </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-21-3 type=checkbox id=nav-21-3> <label class=md-nav__link for=nav-21-3> Zigbee <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Zigbee data-md-level=2> <label class=md-nav__title for=nav-21-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Zigbee </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Zigbee/ title=Zigbee class=md-nav__link> Zigbee </a> </li> <li class=md-nav__item> <a href=../Zigbee-Internals/ title="Zigbee internals" class=md-nav__link> Zigbee internals </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../TasmotaSlave/ title=TasmotaSlave class=md-nav__link> TasmotaSlave </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ title=DeepSleep class=md-nav__link> DeepSleep </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ title="PWM Dimmer" class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../Buzzer/ title=Buzzer class=md-nav__link> Buzzer </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ title="Dynamic Sleep" class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../GPS-NTP-server/ title="GPS NTP server" class=md-nav__link> GPS NTP server </a> </li> <li class=md-nav__item> <a href=../I2CDevices/ title="I2C Devices" class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ title="Smart Meter Interface" class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ title="PIR Motion Sensors" class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ title="Power Monitoring Calibration" class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../Subscribe-%26-Unsubscribe/ title="Subscribe & Unsubscribe" class=md-nav__link> Subscribe & Unsubscribe </a> </li> <li class=md-nav__item> <a href=../TLS/ title="SSL/TLS on Tasmota" class=md-nav__link> SSL/TLS on Tasmota </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-22 type=checkbox id=nav-22> <label class=md-nav__link for=nav-22> Smart Home Integrations <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="Smart Home Integrations" data-md-level=1> <label class=md-nav__title for=nav-22> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Alexa/ title=Alexa class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ title="AWS IoT" class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ title=Domoticz class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ title="Home Assistant" class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ title=Homebridge class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ title=HomeSeer class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ title="IP Symcon" class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ title=KNX class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ title=NodeRed class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ title=nymea class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../OctoPrint.md title=None class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../openHAB/ title=openHAB class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ title=Otto class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 title=IOBroker class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter title="Mozilla WebThings Adapter" class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/BrettSheleski/SmartThingsPublic/blob/master/devicetypes/brettsheleski/sonoff-tasmota.src/readme.md title=SmartThings class=md-nav__link> SmartThings </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-23 type=checkbox id=nav-23> <label class=md-nav__link for=nav-23> Peripherals <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Peripherals data-md-level=1> <label class=md-nav__title for=nav-23> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Peripherals </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-23-1 type=checkbox id=nav-23-1> <label class=md-nav__link for=nav-23-1> Displays <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Displays data-md-level=2> <label class=md-nav__title for=nav-23-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Displays </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Displays/ title=Displays class=md-nav__link> Displays </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../A4988-Stepper-Motor-Controller/ title="A4988 stepper motor controller" class=md-nav__link> A4988 stepper motor controller </a> </li> <li class=md-nav__item> <a href=../AM2301/ title="AM2301 temperature and humidity sensor" class=md-nav__link> AM2301 temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../APDS-9960/ title="APDS 9960" class=md-nav__link> APDS 9960 </a> </li> <li class=md-nav__item> <a href=../AZ-7798/ title="AZ 7798" class=md-nav__link> AZ 7798 </a> </li> <li class=md-nav__item> <a href=../BH1750/ title=BH1750 class=md-nav__link> BH1750 </a> </li> <li class=md-nav__item> <a href=../BME280/ title=None class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../BME680/ title=BME680 class=md-nav__link> BME680 </a> </li> <li class=md-nav__item> <a href=../BME280/ title="BMP280 pressure sensor" class=md-nav__link> BMP280 pressure sensor </a> </li> <li class=md-nav__item> <a href=../CC2530/ title=CC2530 class=md-nav__link> CC2530 </a> </li> <li class=md-nav__item> <a href=../Moisture-Sensor-and-Chirp%21-Sensor/ title="Chirp! moisture sensor" class=md-nav__link> Chirp! moisture sensor </a> </li> <li class=md-nav__item> <a href=../DHT11/ title=DHT11 class=md-nav__link> DHT11 </a> </li> <li class=md-nav__item> <a href=../DS18x20/ title=DS18x20 class=md-nav__link> DS18x20 </a> </li> <li class=md-nav__item> <a href=../DS3231/ title=DS3231 class=md-nav__link> DS3231 </a> </li> <li class=md-nav__item> <a href=../HM-10/ title="HM 10" class=md-nav__link> HM 10 </a> </li> <li class=md-nav__item> <a href=../HM-17/ title="HM 17" class=md-nav__link> HM 17 </a> </li> <li class=md-nav__item> <a href=../HC-SR04/ title="HC SR04" class=md-nav__link> HC SR04 </a> </li> <li class=md-nav__item> <a href=../Honeywell-HIH/ title="Honeywell HIH" class=md-nav__link> Honeywell HIH </a> </li> <li class=md-nav__item> <a href=../IR-Remote/ title="IR Remote" class=md-nav__link> IR Remote </a> </li> <li class=md-nav__item> <a href=../LM75AD/ title=LM75AD class=md-nav__link> LM75AD </a> </li> <li class=md-nav__item> <a href=../MCP230xx/ title=MCP230xx class=md-nav__link> MCP230xx </a> </li> <li class=md-nav__item> <a href=../MGC3130/ title=MGC3130 class=md-nav__link> MGC3130 </a> </li> <li class=md-nav__item> <a href=../MH-Z19B/ title="MH Z19B" class=md-nav__link> MH Z19B </a> </li> <li class=md-nav__item> <a href=../MLX90614/ title=MLX90614 class=md-nav__link> MLX90614 </a> </li> <li class=md-nav__item> <a href=../MPR121/ title="MPR121 I2C Proximity Capacitive Touch Sensor Controller" class=md-nav__link> MPR121 I<sup>2</sup>C Proximity Capacitive Touch Sensor Controller </a> </li> <li class=md-nav__item> <a href=../MPU-6050/ title="MPU 6050" class=md-nav__link> MPU 6050 </a> </li> <li class=md-nav__item> <a href=../NRF24L01/ title=NRF24L01 class=md-nav__link> NRF24L01 </a> </li> <li class=md-nav__item> <a href=../P1-Smart-Meter/ title="Kaifa MA105C Energy Meter" class=md-nav__link> Kaifa MA105C Energy Meter </a> </li> <li class=md-nav__item> <a href=../PAJ7620/ title=PAJ7620 class=md-nav__link> PAJ7620 </a> </li> <li class=md-nav__item> <a href=../PCA9685/ title=PCA9685 class=md-nav__link> PCA9685 </a> </li> <li class=md-nav__item> <a href=../PN532/ title=PN532 class=md-nav__link> PN532 </a> </li> <li class=md-nav__item> <a href=../PZEM-0XX/ title="PZEM 0XX" class=md-nav__link> PZEM 0XX </a> </li> <li class=md-nav__item> <a href=../RCWL-0516/ title="RCWL 0516" class=md-nav__link> RCWL 0516 </a> </li> <li class=md-nav__item> <a href=../RDM6300/ title=RDM6300 class=md-nav__link> RDM6300 </a> </li> <li class=md-nav__item> <a href=../SDS011/ title=SDS011 class=md-nav__link> SDS011 </a> </li> <li class=md-nav__item> <a href=../SHT30/ title=SHT30 class=md-nav__link> SHT30 </a> </li> <li class=md-nav__item> <a href=../TX2x/ title=TX2x class=md-nav__link> TX2x </a> </li> <li class=md-nav__item> <a href=../TSL2561/ title=TSL2561 class=md-nav__link> TSL2561 </a> </li> <li class=md-nav__item> <a href=../VEML6070/ title=VEML6070 class=md-nav__link> VEML6070 </a> </li> <li class=md-nav__item> <a href=../VL53L0x/ title=VL53L0x class=md-nav__link> VL53L0x </a> </li> <li class=md-nav__item> <a href=../WS2812B-RGB-Shield/ title="WS2812B RGB Shield" class=md-nav__link> WS2812B RGB Shield </a> </li> <li class=md-nav__item> <a href=../WS2812B-and-WS2813/ title="WS2812B and WS2813" class=md-nav__link> WS2812B and WS2813 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-24 type=checkbox id=nav-24> <label class=md-nav__link for=nav-24> Supported Devices <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="Supported Devices" data-md-level=1> <label class=md-nav__title for=nav-24> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ title="Configuring unknown devices" class=md-nav__link> Configuring unknown devices </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' title="All Supported Devices" class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ title="Supported Modules" class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-25 type=checkbox id=nav-25> <label class=md-nav__link for=nav-25> Help <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Help data-md-level=1> <label class=md-nav__title for=nav-25> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ title=FAQ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ title=Troubleshooting class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ title="Device Recovery" class=md-nav__link> Device Recovery </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Contributing/ title=Contributing class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href="//discord.gg/Ks2Kzd4  " target='_blank""' title="Discord Community" class=md-nav__link> Discord Community </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/Scripting-Language.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/></svg> </a> <div class="admonition failure"> <p class=admonition-title>This feature is not included in precompiled binaries</p> </div> <p>To use it you must <a href=../Compile-your-build/ >compile your build</a>. Add the following to <code>user_config_override.h</code>:</p> <div class=codehilite><pre><span></span><code><span class=cp>#ifndef USE_SCRIPT</span>
<span class=cp>#define USE_SCRIPT  </span><span class=c1>// adds about 17k flash size, variable ram size</span>
<span class=cp>#endif</span>
<span class=cp>#ifdef USE_RULES</span>
<span class=cp>#undef USE_RULES</span>
<span class=cp>#endif  </span>
</code></pre></div> <h4>Optional Includes</h4> <p>Additional features are enabled by adding the following <code>#define</code> compiler directive parameters and then compiling the firmware. These parameters are explained further below in the article.</p> <table> <thead> <tr> <th>Feature</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>USE_BUTTON_EVENT</td> <td>enable <code>&gt;b</code> section (detect button state changes)</td> </tr> <tr> <td>USE_SCRIPT_JSON_EXPORT</td> <td>enable <code>&gt;J</code> section (publish JSON payload on <a href=../Commands/#teleperiod>TelePeriod</a>)</td> </tr> <tr> <td>USE_SCRIPT_SUB_COMMAND</td> <td>enables invoking named script subroutines via the Console or MQTT</td> </tr> <tr> <td>USE_SCRIPT_HUE</td> <td>enable <code>&gt;H</code> section (Alexa Hue emulation)</td> </tr> <tr> <td>USE_SCRIPT_STATUS</td> <td>enable <code>&gt;U</code> section (receive JSON payloads)</td> </tr> <tr> <td>SCRIPT_POWER_SECTION</td> <td>enable <code>&gt;P</code> section (execute on power changes)</td> </tr> <tr> <td>SUPPORT_MQTT_EVENT</td> <td>enables support for subscribe unsubscribe</td> </tr> <tr> <td>USE_SENDMAIL</td> <td>enable <code>&gt;m</code> section and support for sending e-mail</td> </tr> <tr> <td>USE_SCRIPT_WEB_DISPLAY</td> <td>enable <code>&gt;W</code> section (modify web UI)</td> </tr> <tr> <td>USE_TOUCH_BUTTONS</td> <td>enable virtual touch button support with touch displays</td> </tr> <tr> <td>USE_WEBSEND_RESPONSE</td> <td>enable receiving the response of a <a href=../Commands/#websend><code>WebSend</code></a> command (received in section E)</td> </tr> <tr> <td>SCRIPT_STRIP_COMMENTS</td> <td>enables stripping comments when attempting to paste a script that is too large to fit</td> </tr> <tr> <td>USE_ANGLE_FUNC</td> <td>add sin(x),acos(x) and sqrt(x) e.g. to allow calculation of horizontal cylinder volume</td> </tr> <tr> <td>USE_24C256</td> <td>enables use of 24C256 I<sup>2</sup>C EEPROM to expand script buffer (defaults to 4k)</td> </tr> <tr> <td>USE_SCRIPT_FATFS</td> <td>enables SD card support (on SPI bus). Specify the CS pin number. Also enables 4k script buffer</td> </tr> <tr> <td>USE_SCRIPT_FATFS_EXT</td> <td>enables additional FS commands</td> </tr> <tr> <td>SDCARD_DIR</td> <td>enables support for web UI for SD card directory upload and download</td> </tr> </tbody> </table> <hr> <h2 id=features>Features<a class=headerlink href=#features title="Permanent link">~</a></h2> <p>Scripting Language for Tasmota is an alternative to Tasmota <a href=../Rules/ >Rules</a>.</p> <p>To enter a script, go to <strong>Configuration -&gt; Edit script</strong> in the Tasmota web UI menu</p> <p>The maximum script size is 1535 bytes (uses rule set buffers). If the pasted script is larger than 1535 characters, comments will be stripped to attempt to make the script fit. </p> <p>To save code space almost no error messages are provided. However it is taken care of that at least it should not crash on syntax errors. </p> <p><strong>Features</strong> - Up to 50 variables (45 numeric and 5 strings - this may be changed by setting a compilation <code>#define</code> directive)<br> - Freely definable variable names (all variable names are intentionally <em><strong>case sensitive</strong></em>)<br> - Nested if,then,else up to a level of 8<br> - Math operators <code>+</code>,<code>-</code>,<code>*</code>,<code>/</code>,<code>%</code>,<code>&amp;</code>,<code>|</code>,<code>^</code><br> - All operators may be used in the <code>op=</code> form, e.g., <code>+=</code><br> - Comparison operators <code>==</code>,<code>!=</code>,<code>&gt;</code>,<code>&gt;=</code>,<code>&lt;</code>,<code>&lt;=</code><br> - <code>and</code> , <code>or</code> support<br> - Hexadecimal numbers with prefix <code>0x</code> are supported - Strings support <code>+</code> and <code>+=</code> operators<br> - Support for \n \r regular expressions on strings - String comparison <code>==</code>, <code>!=</code><br> - String size is 19 characters (default). This can be increased or decreased by the optional parameter on the <code>&gt;D</code> section definition</p> <p><strong>Script Interpreter</strong><br> - Execution is <em><strong>strictly sequential</strong></em>, <em><strong>line by line</strong></em> - Evaluation is <em><strong>left to right</strong></em> with optional brackets<br> - All <em><strong>numbers are float</strong></em>, e.g., temp=hum*(100/37.5)+temp-(timer*hum%10)<br> - <em><strong>No spaces are allowed between math operators</strong></em> - Comments start with <code>;</code> </p> <p><strong>Console Commands</strong> <br> <code>script &lt;n&gt;</code> \<n>: <code>0</code> = switch script off; <code>1</code> = switch script on<br> <code>script &gt;&lt;cmdline&gt;</code> execute \<cmdline><br> - Can be used to set variables, e.g., <code>script &gt;mintmp=15</code><br> - Multiple statements can be specified by separating each with a semicolon, e.g. <code>script &gt;mintmp=15;maxtemp=40</code><br> - The script itself can't be specified because the size would not fit the MQTT buffers</p> <h2 id=script-sections>Script Sections<a class=headerlink href=#script-sections title="Permanent link">~</a></h2> <p><em>Section descriptors (e.g., <code>&gt;E</code>) are <strong>case sensitive</strong></em><br> <code>&gt;D ssize</code> <br> <code>ssize</code> = optional max string size (default=19)<br> define and init variables here, must be the first section, no other code allowed<br> <code>p:vname</code> <br> specifies permanent variables. The number of permanent variables is limited by Tasmota rules space (50 bytes) - numeric variables are 4 bytes; string variables are one byte longer than the length of string<br> <code>t:vname</code> <br> specifies countdown timers, if &gt;0 they are decremented in seconds until zero is reached. see example below<br> <code>i:vname</code> <br> specifies auto increment counters if &gt;=0 (in seconds)<br> <code>m:vname</code> <br> specifies a median filter variable with 5 entries (for elimination of outliers)<br> <code>M:vname</code> <br> specifies a moving average filter variable with 8 entries (for smoothing data)<br> (max 5 filters in total m+M) optional another filter length (1..127) can be given after the definition.<br> Filter vars can be accessed also in indexed mode <code>vname[x]</code> (x = <code>1..N</code>, x = <code>0</code> returns current array index pointer)<br> Using this filter, vars can be used as arrays </p> <blockquote> <p>[!TIP] Keep variable names as short as possible. The length of all variable names taken together may not exceed 256 characters.<br> Memory is dynamically allocated as a result of the D section.<br> Copying a string to a number or reverse is supported </p> </blockquote> <p><code>&gt;B</code><br> executed on BOOT time and on save script </p> <p><code>&gt;E</code><br> Executed when a Tasmota MQTT <code>RESULT</code> message is received, e.g., on <code>POWER</code> change</p> <p><code>&gt;F</code><br> Executed every 100 ms </p> <p><code>&gt;S</code><br> Executed every second </p> <p><code>&gt;R</code><br> Executed on restart. p vars are saved automatically after this call </p> <p><code>&gt;T</code><br> Executed on <a href=../Commands/#teleperiod><code>TelePeriod</code></a> time (<code>SENSOR</code> and <code>STATE</code>), only put <code>tele-</code> vars in this section<br> Remark: json variable names (like all others) may not contain math operators like - , you should set <a href=../Commands/#setoption64><code>SetOption64 1</code></a> to replace <code>-</code> (<em>dash</em>) with <code>_</code> (<em>underscore</em>)</p> <p><code>&gt;H</code><br> Alexa Hue interface (up to 32 virtual hue devices) <em>(<a href=../Scripting-Cookbook/#hue-emulation>example</a>)</em><br> <code>device</code>,<code>type</code>,<code>onVars</code><br> Remark: hue values have a range from 0-65535. Divide by 182 to assign HSBcolors hue values.</p> <p><code>device</code> device name<br> <code>type</code> device type - <code>E</code> = extended color; <code>S</code> = switch<br> <code>onVars</code> assign Hue "on" extended color parameters for hue, saturation, brightness, and color temperature (hue,sat,bri,ct) to scripter variables </p> <blockquote> <p>[!EXAMPLE] <code>lamp1,E,on=pwr1,hue=hue1,sat=sat1,bri=bri1,ct=ct1</code></p> </blockquote> <p><code>&gt;U</code><br> status JSON Messages arrive here</p> <p><code>&gt;b</code> <em>(note lower case)</em><br> executed on button state change </p> <p><code>bt[x]</code> <br> read button state (x = <code>1.. MAX_KEYS</code>) </p> <blockquote> <p>[!EXAMPLE] </p> </blockquote> <div class=codehilite><pre><span></span><code><span class=err>if bt[1]==0  </span>
<span class=err>then  </span>
<span class=err>print falling edge of button1  </span>
<span class=err>endif  </span>
<span class=err>if bt[1]==1  </span>
<span class=err>then  </span>
<span class=err>print rising edge of button1  </span>
<span class=err>endif</span>
</code></pre></div> <p><code>&gt;J</code><br> The lines in this section are published via MQTT in a JSON payload on <a href=../Commands/#teleperiod>TelePeriod</a>. Requires compiling with <code>#define USE_SCRIPT_JSON_EXPORT</code>. </p> <p><code>&gt;W</code><br> The lines in this section are displayed in the web UI main page. Requires compiling with <code>#define USE_SCRIPT_WEB_DISPLAY</code>. </p> <p>You may put any html code here.<br> - Variables may be substituted using %var%<br> - HTML statements are displayed in the sensor section of the main page<br> - HTML statements preceded with a <code>@</code> are displayed at the top of the page<br> - USER IO elements are displayed at the top of the page </p> <p>A web user interface may be generated containing any of the following elements: toggle button, check box, slider, or text and number input.<br> - <strong>Button:</strong> <br> <code>bu(&lt;vn&gt; &lt;txt1&gt; &lt;txt2&gt;)</code> (up to 4 buttons may be defined in one row)<br> <code>&lt;vn&gt;</code> = name of variable to hold button state<br> <code>&lt;txt1&gt;</code> = text of ON state of button<br> <code>&lt;txt2&gt;</code> = text of OFF state of button - <strong>Checkbox:</strong> <br> <code>ck(&lt;vn&gt; &lt;txt&gt;)</code><br> <code>&lt;vn&gt;</code> = name of variable to hold checkbox state<br> <code>&lt;txt&gt;</code> = label text <br> - <strong>Slider:</strong> <br> <code>sl(&lt;min&gt; &lt;max&gt; &lt;vn&gt; &lt;ltxt&gt; &lt;mtxt&gt; &lt;rtxt&gt;)</code><br> <code>&lt;min&gt;</code> = slider minimum value<br> <code>&lt;max&gt;</code> = slider maximum value<br> <code>&lt;vn&gt;</code> = name of variable to hold slider value<br> <code>&lt;ltxt&gt;</code> = label left of slider<br> <code>&lt;mtxt&gt;</code> = label middle of slider<br> <code>&lt;rtxt&gt;</code> = label right of slider<br> - <strong>Text Input:</strong> <br> <code>tx(&lt;vn&gt; &lt;txt&gt;)</code><br> <code>&lt;vn&gt;</code> = name of string variable to hold text state<br> <code>&lt;txt&gt;</code> = label text <br> - <strong>Number Input:</strong> <br> <code>nm(&lt;min &lt;max&gt; &lt;step&gt; &lt;vn&gt; &lt;txt&gt;)</code><br> <code>&lt;min&gt;</code> = number minimum value<br> <code>&lt;max&gt;</code> = number maximum value<br> <code>&lt;step&gt;</code> = number step value for up/down arrows<br> <code>&lt;vn&gt;</code> = name of number variable to hold number<br> <code>&lt;txt&gt;</code> = label text </p> <p><code>&gt;M</code><br> <a href=../Smart-Meter-Interface/ >Smart Meter Interface</a> </p> <p>If a variable does not exist, <code>???</code> is displayed for commands </p> <p>If a Tasmota <code>SENSOR</code> or <code>STATUS</code> or <code>RESULT</code> message is not generated or a <code>Var</code> does not exist the destination variable is NOT updated. </p> <h2 id=special-variables>Special Variables<a class=headerlink href=#special-variables title="Permanent link">~</a></h2> <p>(read only)<br> <code>upsecs</code> = seconds since start<br> <code>uptime</code> = minutes since start<br> <code>time</code> = minutes since midnight<br> <code>sunrise</code> = sunrise minutes since midnight<br> <code>sunset</code> = sunset minutes since midnight<br> <code>tper</code> = <a href=../Commands/#teleperiod>TelePeriod</a> (<em><strong>may be set also</strong></em>)<br> <code>tstamp</code> = timestamp (local date and time)<br> <code>topic</code> = mqtt topic<br> <code>gtopic</code> = mqtt group topic<br> <code>prefixn</code> = prefix n = 1-3<br> <code>pwr[x]</code> = power state (x = 1..N)<br> <code>pc[x]</code> = pulse counter value (x = 1..4)<br> <code>tbut[x]</code> = touch screen button state (x = 1..N)<br> <code>sw[x]</code> = switch state (x = 1..N)<br> <code>bt[x]</code> = button state (x = 1..N) only valid in section &gt;b (if defined USE_BUTTON_EVENT)<br> <code>pin[x]</code> = GPIO pin level (x = 0..16)<br> <code>pn[x]</code> = GPIO for sensor code x. 99 if none<br> <code>pd[x]</code> = defined sensor for GPIO x. 999 if none<br> <code>sht[x]</code> = shutter position (x = 1..N) (if defined USE_SHUTTER)<br> <code>gtmp</code> = global temperature<br> <code>ghum</code> = global humidity<br> <code>gprs</code> = global pressure<br> <code>pow(x y)</code> = calculates exponential powers x^y<br> <code>med(n x)</code> = calculates a 5 value median filter of x (2 filters possible n=0,1)<br> <code>int(x)</code> = gets the integer part of x (like floor)<br> <code>hn(x)</code> = converts x (0..255) to a hex nibble string<br> <code>hx(x)</code> = converts x (0..65535) to a hex string<br> <code>st(svar c n)</code> = string token - retrieve the n<sup>th</sup> element of svar delimited by c<br> <code>sl(svar)</code> = gets the length of a string<br> <code>sb(svar p n)</code> = gets a substring from svar at position p (if p&lt;0 counts from end) and length n<br> <code>sin(x)</code> = calculates the sinus(x) (if defined USE_ANGLE_FUNC)<br> <code>acos(x)</code> = calculates the acos(x) (if defined USE_ANGLE_FUNC)<br> <code>sqrt(x)</code> = calculates the sqrt(x) (if defined USE_ANGLE_FUNC)<br> <code>s(x)</code> = explicit conversion from number x to string<br> <code>mqtts</code> = MQTT connection status: <code>0</code> = disconnected, <code>&gt;0</code> = connected<br> <code>wifis</code> = Wi-Fi connection status: <code>0</code> = disconnected, <code>&gt;0</code> = connected </p> <p><code>hours</code> = hours<br> <code>mins</code> = mins<br> <code>secs</code> = seconds<br> <code>day</code> = day of month<br> <code>wday</code> = day of week<br> <code>month</code> = month<br> <code>year</code> = year<br> <code>epoch</code> = epoch time (from 2019-1-1 00:00) </p> <p>The following variables are cleared after reading true:<br> <code>chg[var]</code> = true if a variables value was changed (numeric vars only)<br> <code>upd[var]</code> = true if a variable was updated<br> <code>boot</code> = true on BOOT<br> <code>tinit</code> = true on time init<br> <code>tset</code> = true on time set<br> <code>mqttc</code> = true on mqtt connect<br> <code>mqttd</code> = true on mqtt disconnect<br> <code>wific</code> = true on wifi connect<br> <code>wifid</code> = true on wifi disconnect </p> <p><strong>System variables</strong> (for debugging)<br> <code>stack</code> = stack size<br> <code>heap</code> = heap size<br> <code>ram</code> = used ram size<br> <code>slen</code> = script length<br> <code>micros</code> = running microseconds<br> <code>millis</code> = running milliseconds<br> <code>loglvl</code> = loglevel of script cmds (<em><strong>may be set also</strong></em>) </p> <p>Remarks:<br> If you define a variable with the same name as a special variable that special variable is discarded </p> <h2 id=commands>Commands<a class=headerlink href=#commands title="Permanent link">~</a></h2> <p><code>=&gt; &lt;command&gt;</code> Execute \<command> recursion disabled<br> <code>+&gt; &lt;command&gt;</code> Execute \<command> recursion enabled<br> <code>-&gt; &lt;command&gt;</code> Execute \<command> - do not send MQTT or log messages (i.e., silent execute - useful to reduce traffic) </p> <p><strong>Variable Substitution</strong><br> - A single percent sign must be given as <code>%%</code><br> - Variable replacement within commands is allowed using <code>%varname%</code>. Optionally, the decimal places precision for numeric values may be specified by placing a digit (<code>%Nvarname%</code>, N = <code>0..9</code>) in front of the substitution variable (e.g., <code>Humidity: %3hum%%%</code> will output <code>Humidity: 43.271%</code>) <br> - Linefeed and carriage return may be defined by \n and \r </p> <p><strong>Special</strong> commands:<br> <code>print</code> or <code>=&gt; print</code> prints to the log for debugging<br> &nbsp;&nbsp;&nbsp;&nbsp;A Tasmota MQTT RESULT message invokes the script's <code>&gt;E</code> section. Add <code>=&gt; print</code> statements to debug a script. </p> <blockquote> <p>[!EXAMPLE]<br> ``` slider=Dimmer power=POWER</p> <p>if upd[slider]&gt;0 then =&gt;print slider updated %slider% endif</p> <p>if upd[power]&gt;0 then =&gt;print power updated %power% endif ```</p> </blockquote> <p><code>break</code> exits a section or terminates a <code>for next</code> loop<br> <code>dpx</code> sets decimal precision to x (0-9)<br> <code>svars</code> save permanent vars<br> <code>delay(x)</code> pauses x milliseconds (should be as short as possible)<br> <code>spin(x b)</code> set GPIO <code>x</code> (0..16) to value <code>b</code> (0,1). Only bit 0 of <code>b</code> is used - even values set the GPIO to <code>0</code> and uneven values set the GPIO to <code>1</code><br> <code>spinm(x m)</code> set GPIO <code>x</code> (0..16) to mode <code>m</code> (input=0, output=1, input with pullup=2)<br> <code>ws2812(array)</code> copies an array (defined with <code>m:vname</code>) to the WS2812 LED chain. The array length should be defined as long as the number of pixels. Color is coded as 24 bit RGB.<br> <code>hsvrgb(h s v)</code> converts hue (0..360), saturation (0..100) and value (0..100) to RGB color </p> <p><code>#name</code> names a subroutine. Subroutine is called with <code>=#name</code><br> <code>#name(param)</code> names a subroutine with a parameter. Subroutine is called with <code>=#name(param)</code><br> Subroutines end with the next <code>#</code> or <code>&gt;</code> line or break. Subroutines may be nested<br> Parameters can be numbers or strings and on type mismatch are converted </p> <p>If <code>#define USE_SCRIPT_SUB_COMMAND</code> is included in your <code>user_config_override.h</code>, a subroutine may be invoked via the Console or MQTT using the subroutine's name. For example, a declared subroutine <code>#SETLED(num)</code> may be invoked by typing <code>SETLED 1</code> in the Console. The parameter <code>1</code> is passed into the <code>num</code> argument. This also works with string parameters. </p> <p>It is possible to "replace" internal Tasmota commands. For example, if a <code>#POWER1(num)</code> subroutine is declared, the command <code>POWER1</code> is processed in the scripter instead of in the main Tasmota code. </p> <p><code>=(svar)</code> executes a routine whose name is passed as a string in a variable (dynamic or self modifying code). The string has to start with <code>=&gt;</code> or <code>=#</code> for the routine to be executed.</p> <div class=codehilite><pre><span></span><code><span class=o>&gt;</span><span class=n>D</span>
<span class=n>svar</span><span class=o>=</span><span class=ss>&quot;=#subroutine&quot;</span>

<span class=o>&gt;</span><span class=n>S</span>
<span class=o>=</span><span class=p>(</span><span class=n>svar</span><span class=p>)</span>

<span class=o>#</span><span class=n>subroutine</span>
<span class=o>=&gt;</span><span class=n>print</span> <span class=n>subroutine</span> <span class=n>was</span> <span class=n>executed</span>
</code></pre></div> <p><strong>For loop</strong> (loop count must not be less than 1)</p> <div class=codehilite><pre><span></span><code><span class=err>for var &lt;from&gt; &lt;to&gt; &lt;inc&gt;  </span>
<span class=err>next  </span>
</code></pre></div> <p><strong>Switch selector</strong> (numeric or string)</p> <div class=codehilite><pre><span></span><code><span class=err>switch x  </span>
<span class=err>case a  </span>
<span class=err>case b  </span>
<span class=err>ends  </span>
</code></pre></div> <p><strong>Conditional Statements</strong><br> There are two syntax alternatives. You may <strong><em>NOT</em></strong> mix both formats. </p> <div class=codehilite><pre><span></span><code><span class=err>if a==b  </span>
<span class=err>and x==y  </span>
<span class=err>or k==i  </span>
<span class=err>then =&gt; do this  </span>
<span class=err>else =&gt; do that  </span>
<span class=err>endif  </span>
</code></pre></div> <p><strong>or</strong> </p> <div class=codehilite><pre><span></span><code><span class=err>if a==b  </span>
<span class=err>and x==y  </span>
<span class=err>or k==i {  </span>
<span class=err>  =&gt; do this  </span>
<span class=err>} else {  </span>
<span class=err>  =&gt; do that  </span>
<span class=err>}  </span>
</code></pre></div> <p>Remarks:<br> The last closing bracket must be on a separate line<br> Calculations are permitted in conditional expressions, e.g., </p> <div class=codehilite><pre><span></span><code><span class=err>if var1-var2==var3*var4</span>
</code></pre></div> <p>Conditional expressions may be enclosed in parentheses. The statement must be on a single line. e.g., </p> <div class=codehilite><pre><span></span><code><span class=err>if ((a==b) and ((c==d) or (c==e)) and (s!=&quot;x&quot;))</span>
</code></pre></div> <p><strong>E-mail</strong><br> <code>#define USE_SENDMAIL</code><br> Enabling this feature also enables <a href=../TLS/ >Tasmota TLS</a> as <code>sendmail</code> uses SSL. </p> <p><code>sendmail [server:port:user:passwd:from:to:subject] msg</code> </p> <blockquote> <p>[!EXAMPLE] </p> </blockquote> <div class=codehilite><pre><span></span><code><span class=err>sendmail [smtp.gmail.com:465:user:passwd:sender@gmail.com:&lt;rec@gmail.com&gt;:alarm] %string%</span>
</code></pre></div> <p>Remark:<br> A number of e-mail servers (such as Gmail) require the receiver's e-mail address to be enclosed by <code>&lt; ... &gt;</code> as in example above. Most other e-mail servers also accept this format. </p> <p>The following parameters can be specified during compilation via <code>#define</code> directives in <code>user_config_override.h</code>:<br> * <code>EMAIL_SERVER</code><br> * <code>EMAIL_PORT</code><br> * <code>EMAIL_USER</code><br> * <code>EMAIL_PASSWORD</code><br> * <code>EMAIL_FROM</code> </p> <p>To use any of these values, pass an <code>*</code> as its corresponding argument placeholder. </p> <blockquote> <p>[!EXAMPLE] <code>sendmail [*:*:*:*:*:&lt;rec@gmail.com&gt;:theSubject] theMessage</code> </p> </blockquote> <p>Instead of passing the <code>msg</code> as a string constant, the body of the e-mail message may also be composed using the script <code>&gt;m</code> <em>(note lower case)</em> section. The specified text in this script section must end with an <code>#</code> character. <code>sendmail</code> will use the <code>&gt;m</code> section if <code>*</code> is passed as the <code>msg</code> parameter. See [Scripting Cookbook Example].(Scripting-Cookbook#Send-e-mail) </p> <p><strong>Subscribe, Unsubscribe</strong><br> <code>#define SUPPORT_MQTT_EVENT</code><br> <code>subscribe</code> and <code>unsubscribe</code> commands are supported. In contrast to rules, no event is generated but the event name specifies a variable defined in <code>&gt;D</code> section and this variable is automatically set on transmission of the subscribed item </p> <p><strong>SD Card Support</strong> (+ 10k flash)<br> <code>#define USE_SCRIPT_FATFS</code> <code>CARD_CS</code><br> <code>CARD_CS</code> = GPIO of card chip select <br> SD card uses standard hardware SPI GPIO: mosi,miso,sclk<br> A maximum of four files may be open at a time<br> e.g., allows for logging sensors to a tab delimited file and then downloading the file (<a href=../Scripting-Cookbook/#sensor-logging>see Sensor Logging example</a>)<br> The downloading of files may be executed in a kind of "multitasking" when bit 7 of loglvl is set (128+loglevel)<br> Without multitasking 150kb/s (all processes are stopped during downloading), with multitasking 50kb/s (other Tasmota processes are running)<br> The script itself is also stored on the SD card with a default size of 4096 characters </p> <p>Enable SD card directory support (+ 1,2k flash)<br> <code>#define SDCARD_DIR</code><br> Shows a web SD card directory (submenu of scripter) where you can upload and download files to/from sd card </p> <p><code>fr=fo("fname" m)</code> open file fname, mode 0=read, 1=write (returns file reference (0-3) or -1 for error)<br> <code>res=fw("text" fr)</code> writes text to (the end of) file fr, returns number of bytes written<br> <code>res=fr(svar fr)</code> reads a string into svar, returns bytes read. String is read until delimiter (\t \n \r) or eof<br> <code>fc(fr)</code> close file<br> <code>ff(fr)</code> flush file, writes cached data and updates directory<br> <code>fd("fname")</code> delete file fname<br> <code>flx(fname)</code> create download link for file (x=1 or 2) fname = file name of file to download<br> <code>fsm</code> return 1 if filesystem is mounted, (valid SD card found) </p> <p><strong>Extended commands</strong> (+0,9k flash)<br> <code>#define USE_SCRIPT_FATFS_EXT</code><br> <code>fmd("fname")</code> make directory fname<br> <code>frd("fname")</code> remove directory fname<br> <code>fx("fname")</code> check if file fname exists<br> <code>fe("fname")</code> execute script fname (max 2048 bytes, script must start with the '&gt;' character on the first line) </p> <h1 id=scripting-cookbook><a href=../Scripting-Cookbook/ >Scripting Cookbook</a><a class=headerlink href=#scripting-cookbook title="Permanent link">~</a></h1> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../Compile-your-build/ title=Compiling class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Compiling </div> </div> </a> <a href=../Bluetooth/ title=Bluetooth class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Bluetooth </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z /></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M297.216 243.2c0 15.616-11.52 28.416-26.112 28.416-14.336 0-26.112-12.8-26.112-28.416s11.52-28.416 26.112-28.416c14.592 0 26.112 12.8 26.112 28.416zm-119.552-28.416c-14.592 0-26.112 12.8-26.112 28.416s11.776 28.416 26.112 28.416c14.592 0 26.112-12.8 26.112-28.416.256-15.616-11.52-28.416-26.112-28.416zM448 52.736V512c-64.494-56.994-43.868-38.128-118.784-107.776l13.568 47.36H52.48C23.552 451.584 0 428.032 0 398.848V52.736C0 23.552 23.552 0 52.48 0h343.04C424.448 0 448 23.552 448 52.736zm-72.96 242.688c0-82.432-36.864-149.248-36.864-149.248-36.864-27.648-71.936-26.88-71.936-26.88l-3.584 4.096c43.52 13.312 63.744 32.512 63.744 32.512-60.811-33.329-132.244-33.335-191.232-7.424-9.472 4.352-15.104 7.424-15.104 7.424s21.248-20.224 67.328-33.536l-2.56-3.072s-35.072-.768-71.936 26.88c0 0-36.864 66.816-36.864 149.248 0 0 21.504 37.12 78.08 38.912 0 0 9.472-11.52 17.152-21.248-32.512-9.728-44.8-30.208-44.8-30.208 3.766 2.636 9.976 6.053 10.496 6.4 43.21 24.198 104.588 32.126 159.744 8.96 8.96-3.328 18.944-8.192 29.44-15.104 0 0-12.8 20.992-46.336 30.464 7.68 9.728 16.896 20.736 16.896 20.736 56.576-1.792 78.336-38.912 78.336-38.912z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.23350dc5.min.js></script> <script src=../assets/javascripts/bundle.36a8f969.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.3bc815f0.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>