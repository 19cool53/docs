<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=../_media/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-5.0.0rc4"><title>Scripting Cookbook - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.c1451e9e.min.css><link rel=stylesheet href=../assets/stylesheets/palette.4444686e.min.css><meta name=theme-color content=#2196f3><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Barlow",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-140681905-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#prep class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z /></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Tasmota </span> <span class="md-header-nav__topic md-ellipsis"> Scripting Cookbook </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z /></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class="md-tabs__link md-tabs__link--active"> Home </a> </li> <li class=md-tabs__item> <a href=../Scripting-Language/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../Alexa/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Displays/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Home class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../About/ title=About class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ title=Upgrading class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ title=MQTT class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ title=Commands class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ title=Templates class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ title=Components class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ title=Modules class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Rules/ title=Rules class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Timers/ title=Timers class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../Lights/ title=Lights class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ title="Buttons and Switches" class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ title=Peripherals class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ title=TuyaMCU class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../Device-groups.md title=None class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ title="Blinds and Shutters" class=md-nav__link> Blinds and Shutters </a> </li> <li class=md-nav__item> <a href=../Shutter-and-Steppers/ title="Shutter and Steppers" class=md-nav__link> Shutter and Steppers </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ title="IR Communication" class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../WebUI/ title=WebUI class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ title=Compiling class=md-nav__link> Compiling </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-22 type=checkbox id=nav-22> <label class=md-nav__link for=nav-22> Features <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Features data-md-level=1> <label class=md-nav__title for=nav-22> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Scripting-Language/ title=Scripting class=md-nav__link> Scripting </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ title=Bluetooth class=md-nav__link> Bluetooth </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-22-3 type=checkbox id=nav-22-3> <label class=md-nav__link for=nav-22-3> Zigbee <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Zigbee data-md-level=2> <label class=md-nav__title for=nav-22-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Zigbee </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Zigbee/ title=Zigbee class=md-nav__link> Zigbee </a> </li> <li class=md-nav__item> <a href=../Zigbee-Internals/ title="Zigbee internals" class=md-nav__link> Zigbee internals </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../TasmotaSlave/ title=TasmotaSlave class=md-nav__link> TasmotaSlave </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ title=DeepSleep class=md-nav__link> DeepSleep </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ title="PWM Dimmer" class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../Buzzer/ title=Buzzer class=md-nav__link> Buzzer </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ title="Dynamic Sleep" class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../GPS-NTP-server/ title="GPS NTP server" class=md-nav__link> GPS NTP server </a> </li> <li class=md-nav__item> <a href=../I2CDevices/ title="I2C Devices" class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ title="Smart Meter Interface" class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ title="PIR Motion Sensors" class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ title="Power Monitoring Calibration" class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../Subscribe-%26-Unsubscribe/ title="Subscribe & Unsubscribe" class=md-nav__link> Subscribe & Unsubscribe </a> </li> <li class=md-nav__item> <a href=../TLS/ title="SSL/TLS on Tasmota" class=md-nav__link> SSL/TLS on Tasmota </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-23 type=checkbox id=nav-23> <label class=md-nav__link for=nav-23> Smart Home Integrations <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="Smart Home Integrations" data-md-level=1> <label class=md-nav__title for=nav-23> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Alexa/ title=Alexa class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ title="AWS IoT" class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ title=Domoticz class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ title="Home Assistant" class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ title=Homebridge class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ title=HomeSeer class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ title="IP Symcon" class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ title=KNX class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ title=NodeRed class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ title=nymea class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../OctoPrint.md title=None class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../openHAB/ title=openHAB class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ title=Otto class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 title=IOBroker class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter title="Mozilla WebThings Adapter" class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/BrettSheleski/SmartThingsPublic/blob/master/devicetypes/brettsheleski/sonoff-tasmota.src/readme.md title=SmartThings class=md-nav__link> SmartThings </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-24 type=checkbox id=nav-24> <label class=md-nav__link for=nav-24> Peripherals <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Peripherals data-md-level=1> <label class=md-nav__title for=nav-24> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Peripherals </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-24-1 type=checkbox id=nav-24-1> <label class=md-nav__link for=nav-24-1> Displays <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Displays data-md-level=2> <label class=md-nav__title for=nav-24-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Displays </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Displays/ title=Displays class=md-nav__link> Displays </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../A4988-Stepper-Motor-Controller/ title="A4988 stepper motor controller" class=md-nav__link> A4988 stepper motor controller </a> </li> <li class=md-nav__item> <a href=../AM2301/ title="AM2301 temperature and humidity sensor" class=md-nav__link> AM2301 temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../APDS-9960/ title="APDS 9960" class=md-nav__link> APDS 9960 </a> </li> <li class=md-nav__item> <a href=../AZ-7798/ title="AZ 7798" class=md-nav__link> AZ 7798 </a> </li> <li class=md-nav__item> <a href=../BH1750/ title=BH1750 class=md-nav__link> BH1750 </a> </li> <li class=md-nav__item> <a href=../BME280/ title=None class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../BME680/ title=BME680 class=md-nav__link> BME680 </a> </li> <li class=md-nav__item> <a href=../BME280/ title="BMP280 pressure sensor" class=md-nav__link> BMP280 pressure sensor </a> </li> <li class=md-nav__item> <a href=../CC2530/ title=CC2530 class=md-nav__link> CC2530 </a> </li> <li class=md-nav__item> <a href=../Moisture-Sensor-and-Chirp%21-Sensor/ title="Chirp! moisture sensor" class=md-nav__link> Chirp! moisture sensor </a> </li> <li class=md-nav__item> <a href=../DHT11/ title=DHT11 class=md-nav__link> DHT11 </a> </li> <li class=md-nav__item> <a href=../DS18x20/ title=DS18x20 class=md-nav__link> DS18x20 </a> </li> <li class=md-nav__item> <a href=../DS3231/ title=DS3231 class=md-nav__link> DS3231 </a> </li> <li class=md-nav__item> <a href=../HM-10/ title="HM 10" class=md-nav__link> HM 10 </a> </li> <li class=md-nav__item> <a href=../HM-17/ title="HM 17" class=md-nav__link> HM 17 </a> </li> <li class=md-nav__item> <a href=../HC-SR04/ title="HC SR04" class=md-nav__link> HC SR04 </a> </li> <li class=md-nav__item> <a href=../Honeywell-HIH/ title="Honeywell HIH" class=md-nav__link> Honeywell HIH </a> </li> <li class=md-nav__item> <a href=../IR-Remote/ title="IR Remote" class=md-nav__link> IR Remote </a> </li> <li class=md-nav__item> <a href=../LM75AD/ title=LM75AD class=md-nav__link> LM75AD </a> </li> <li class=md-nav__item> <a href=../MCP230xx/ title=MCP230xx class=md-nav__link> MCP230xx </a> </li> <li class=md-nav__item> <a href=../MGC3130/ title=MGC3130 class=md-nav__link> MGC3130 </a> </li> <li class=md-nav__item> <a href=../MH-Z19B/ title="MH Z19B" class=md-nav__link> MH Z19B </a> </li> <li class=md-nav__item> <a href=../MLX90614/ title=MLX90614 class=md-nav__link> MLX90614 </a> </li> <li class=md-nav__item> <a href=../MPR121/ title="MPR121 I2C Proximity Capacitive Touch Sensor Controller" class=md-nav__link> MPR121 I<sup>2</sup>C Proximity Capacitive Touch Sensor Controller </a> </li> <li class=md-nav__item> <a href=../MPU-6050/ title="MPU 6050" class=md-nav__link> MPU 6050 </a> </li> <li class=md-nav__item> <a href=../NRF24L01/ title=NRF24L01 class=md-nav__link> NRF24L01 </a> </li> <li class=md-nav__item> <a href=../P1-Smart-Meter/ title="Kaifa MA105C Energy Meter" class=md-nav__link> Kaifa MA105C Energy Meter </a> </li> <li class=md-nav__item> <a href=../PAJ7620/ title=PAJ7620 class=md-nav__link> PAJ7620 </a> </li> <li class=md-nav__item> <a href=../PCA9685/ title=PCA9685 class=md-nav__link> PCA9685 </a> </li> <li class=md-nav__item> <a href=../PN532/ title=PN532 class=md-nav__link> PN532 </a> </li> <li class=md-nav__item> <a href=../PZEM-0XX/ title="PZEM 0XX" class=md-nav__link> PZEM 0XX </a> </li> <li class=md-nav__item> <a href=../RCWL-0516/ title="RCWL 0516" class=md-nav__link> RCWL 0516 </a> </li> <li class=md-nav__item> <a href=../RDM6300/ title=RDM6300 class=md-nav__link> RDM6300 </a> </li> <li class=md-nav__item> <a href=../SDS011/ title=SDS011 class=md-nav__link> SDS011 </a> </li> <li class=md-nav__item> <a href=../SHT30/ title=SHT30 class=md-nav__link> SHT30 </a> </li> <li class=md-nav__item> <a href=../TX2x/ title=TX2x class=md-nav__link> TX2x </a> </li> <li class=md-nav__item> <a href=../TSL2561/ title=TSL2561 class=md-nav__link> TSL2561 </a> </li> <li class=md-nav__item> <a href=../VEML6070/ title=VEML6070 class=md-nav__link> VEML6070 </a> </li> <li class=md-nav__item> <a href=../VL53L0x/ title=VL53L0x class=md-nav__link> VL53L0x </a> </li> <li class=md-nav__item> <a href=../WS2812B-RGB-Shield/ title="WS2812B RGB Shield" class=md-nav__link> WS2812B RGB Shield </a> </li> <li class=md-nav__item> <a href=../WS2812B-and-WS2813/ title="WS2812B and WS2813" class=md-nav__link> WS2812B and WS2813 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-25 type=checkbox id=nav-25> <label class=md-nav__link for=nav-25> Supported Devices <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="Supported Devices" data-md-level=1> <label class=md-nav__title for=nav-25> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ title="Configuring unknown devices" class=md-nav__link> Configuring unknown devices </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' title="All Supported Devices" class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ title="Supported Modules" class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-26 type=checkbox id=nav-26> <label class=md-nav__link for=nav-26> Help <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Help data-md-level=1> <label class=md-nav__title for=nav-26> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ title=FAQ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ title=Troubleshooting class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ title="Device Recovery" class=md-nav__link> Device Recovery </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Contributing/ title=Contributing class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=//discord.gg/Ks2Kzd4 title="Discord Community" class=md-nav__link> Discord Community </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/Scripting-Cookbook.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/></svg> </a> <p><a id=top></a> - <a href=#Scripting-Language-Example>Scripting Language Example</a> - <a href=#Sensor-Logging>Sensor Logging</a> - <a href=#e-Paper-29-Display-with-SGP30-and-BME280>e-Paper 29 Display with SGP30 and BME280</a> - <a href=#e-Paper-42-Display-with-SHT31-and-BME280>e-Paper 42 Display with SHT31 and BME280</a> - <a href=#ILI-9488-Color-LCD-Display-with-BMP280-and-VL5310X>ILI 9488 Color LCD Display with BMP280 and VL5310X</a> - <a href=#LED-Bar-Display-with-WS2812-LED-Chain>LED Bar Display with WS2812 LED Chain</a> - <a href=#Multiple-IR-Receiver-Synchronization>Multiple IR Receiver Synchronization</a> - <a href=#Fast-Polling>Fast Polling</a> - <a href=#Switching-and-Dimming-By-Recognizing-Mains-Power-Frequency>Switching and Dimming By Recognizing Mains Power Frequency</a> - <a href=#Web-UI>Web UI</a> - <a href=#hue-emulation>Hue Emulation</a> - <a href=#alexa-controlled-mcp230xx-i2c-gpio-expander>Alexa Controlled MCP230xx I<sup>2</sup>C GPIO Expander</a> - <a href=#Retrieve-network-gateway-IP-Address>Retrieve network gateway IP Address</a> - <a href=#Send-e-mail>Send e-mail</a></p> <hr> <h4>Scripting Language Example</h4> <p><strong>Actually this code is too large</strong>. This is only meant to show some of the possibilities</p> <blockquote> <p><strong>&gt;D</strong><br> ; define all vars here<br> p:mintmp=10 (p:means permanent)<br> p:maxtmp=30<br> t:timer1=30 (t:means countdown timer)<br> t:mt=0<br> i:count=0 (i:means auto counter)<br> hello=&quot;hello world&quot;<br> string=&quot;xxx&quot;<br> url=&quot;[<em>IP</em>]&quot;<br> hum=0<br> temp=0<br> timer=0<br> dimmer=0<br> sw=0<br> rssi=0<br> param=0</p> <p>col=&quot;&quot;<br> ocol=&quot;&quot;<br> chan1=0<br> chan2=0<br> chan3=0</p> <p>ahum=0<br> atemp=0<br> tcnt=0<br> hour=0<br> state=1<br> m:med5=0<br> M:movav=0<br> ; define array with 10 entries<br> m:array=0 10</p> <p><strong>&gt;B</strong><br> string=hello+"how are you?"<br> =>print BOOT executed<br> =>print %hello%<br> =>mp3track 1</p> <p>; list gpio pin definitions<br> for cnt 0 16 1<br> tmp=pd[cnt]<br> =&gt;print %cnt% = %tmp%<br> next</p> <p>; get gpio pin for relais 1<br> tmp=pn[21]<br> =&gt;print relais 1 is on pin %tmp%</p> <p>; pulse relais over raw gpio<br> spin(tmp 1)<br> delay(100)<br> spin(tmp 0)</p> <p>; raw pin level<br> =&gt;print level of gpio1 %pin[1]%</p> <p>; pulse over tasmota cmd<br> =&gt;power 1<br> delay(100)<br> =&gt;power 0</p> <p><strong>&gt;T</strong><br> hum=BME280#Humidity<br> temp=BME280#Temperature<br> rssi=Wifi#RSSI<br> string=SleepMode</p> <p>; add to median filter<br> median=temp<br> ; add to moving average filter<br> movav=hum</p> <p>; show filtered results<br> =&gt;print %median% %movav%</p> <p>if chg[rssi]&gt;0<br> then =&gt;print rssi changed to %rssi%<br> endif</p> <p>if temp>30<br> and hum>70<br> then =>print damn hot!<br> endif</p> <p><strong>&gt;S</strong><br> ; every second but not completely reliable time here<br> ; use upsecs and uptime or best t: for reliable timers</p> <p>; arrays<br> array[1]=4<br> array[2]=5<br> tmp=array[1]+array[2]</p> <p>; call subrountines with parameters <br> =#sub1("hallo")<br> =#sub2(999)</p> <p>; stop timer after expired<br> if timer1==0<br> then timer1=-1<br> =&gt;print timer1 expired<br> endif</p> <p>; auto counter with restart<br> if count&gt;=10<br> then =&gt;print 10 seconds over<br> count=0<br> endif</p> <p>if upsecs%5==0<br> then =>print %upsecs% (every 5 seconds)<br> endif</p> <p>; not recommended for reliable timers<br> timer+=1<br> if timer>=5<br> then =>print 5 seconds over (may be)<br> timer=0<br> endif</p> <p>dimmer+=1<br> if dimmer>100<br> then dimmer=0<br> endif</p> <p>=>dimmer %dimmer%<br> =>WebSend %url% dimmer %dimmer%</p> <p>; show on display<br> dp0<br> =>displaytext [c1l1f1s2p20] dimmer=%dimmer%</p> <p>=>print %upsecs% %uptime% %time% %sunrise% %sunset% %tstamp%</p> <p>if time>sunset<br> and time&lt; sunrise<br> then<br> ; night time<br> if pwr[1]==0<br> then =>power1 1<br> endif<br> else<br> ; day time<br> if pwr[1]>0<br> then =>power1 0<br> endif<br> endif</p> <p>; clr display on boot<br> if boot>0<br> then =>displaytext [z]<br> endif</p> <p>; frost warning<br> if temp&lt;0<br> and mt&lt;=0<br> then =#sendmail("frost alert")<br> ; alarm only every 5 minutes<br> mt=300<br> =&gt;mp3track 2<br> endif</p> <p>; var has been updated<br> if upd[hello]&gt;0<br> then =&gt;print %hello%<br> endif</p> <p>; send to Thingspeak every 60 seconds<br> ; average data in between<br> if upsecs%60==0 <br> then<br> ahum/=tcnt<br> atemp/=tcnt<br> =&gt;WebSend [<em>IP</em>]/update?key=<em>token</em>&amp;field1=%atemp%&amp;field2=%ahum%<br> tcnt=0<br> atemp=0<br> ahum=0 <br> else<br> ahum+=hum<br> atemp+=temp<br> tcnt+=1<br> endif</p> <p>hour=int(time/60)<br> if chg[hour]&gt;0<br> then<br> ; exactly every hour<br> =&gt;print full hour reached<br> endif</p> <p>if time&gt;5 {<br> =&gt;print more then 5 minutes after midnight <br> } else {<br> =&gt;print less then 5 minutes after midnight<br> }</p> <p>; publish abs hum every teleperiod time<br> if mqtts&gt;0<br> and upsecs%tper==0<br> then<br> ; calc abs humidity<br> tmp=pow(2.718281828 (17.67*temp)/(temp+243.5))<br> tmp=(6.112*tmp*hum*18.01534)/((273.15+temp)*8.31447215)<br> ; publish median filtered value<br> =&gt;Publish tele/%topic%/SENSOR {"Script":{"abshum":%med(0 tmp)%}}<br> endif</p> <p>;switch case state machine <br> switch state<br> case 1<br> =&gt;print state=%state% , start<br> state+=1<br> case 2<br> =&gt;print state=%state%<br> state+=1<br> case 3<br> =&gt;print state=%state% , reset<br> state=1<br> ends</p> <p>; subroutines<br> #sub1(string)<br> =&gt;print sub1: %string%<br> #sub2(param)<br> =&gt;print sub2: %param%</p> <p>#sendmail(string)<br> =&gt;sendmail [smtp.gmail.com:465:user:passwd:<a href=mailto:sender@gmail.de>&#115;&#101;&#110;&#100;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#100;&#101;</a>:<a href=mailto:rec@gmail.de>&#114;&#101;&#99;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#100;&#101;</a>:alarm] %string%</p> <p><strong>&gt;E</strong><br> =>print event executed!</p> <p>; get HSBColor 1. component<br> tmp=st(HSBColor , 1)</p> <p>; check if switch changed state<br> sw=sw[1]<br> if chg[sw]&gt;0<br> then =>power1 %sw%<br> endif</p> <p>hello=&quot;event occured&quot;</p> <p>; check for Color change (Color is a string)<br> col=Color<br> ; color change needs 2 string vars<br> if col!=ocol<br> then ocol=col<br> =&gt;print color changed %col%<br> endif</p> <p>; or check change of color channels<br> chan1=Channel[1]<br> chan2=Channel[2]<br> chan3=Channel[3]</p> <p>if chg[chan1]&gt;0<br> or chg[chan2]&gt;0<br> or chg[chan3]&gt;0<br> then =&gt; color has changed<br> endif</p> <p>; compose color string for red<br> col=hn(255)+hn(0)+hn(0)<br> =&gt;color %col%</p> <p><strong>&gt;R</strong><br> =>print restarting now</p> </blockquote> <hr> <h4>Sensor Logging</h4> <blockquote> <p>; define all vars here<br> ; reserve large strings<br> <strong>&gt;D 48</strong><br> hum=0<br> temp=0<br> fr=0<br> res=0<br> ; moving average for 60 seconds<br> M:mhum=0 60<br> M:mtemp=0 60<br> str=""</p> <p><strong>&gt;B</strong><br> ; set sensor file download link <br> fl1("slog.txt")<br> ; delete file in case we want to start fresh<br> ;fd("slog.txt")</p> <p>; list all files in root directory<br> fr=fo("/" 0)<br> for cnt 1 20 1<br> res=fr(str fr)<br> if res&gt;0<br> then<br> =&gt;print %cnt% : %str%<br> else<br> break<br> endif<br> next<br> fc(fr)</p> <p><strong>&gt;T</strong><br> ; get sensor values<br> temp=BME280#Temperature<br> hum=BME280#Humidity</p> <p><strong>&gt;S</strong><br> ; average sensor values every second<br> mhum=hum<br> mtemp=temp</p> <p>; write average to sensor log every minute<br> if upsecs%60==0<br> then<br> ; open file for write<br> fr=fo("slog.txt" 1)<br> ; compose string for tab delimited file entry<br> str=s(upsecs)+"\t"+s(mhum)+"\t"+s(mtemp)+"\n"<br> ; write string to log file<br> res=fw(str fr)<br> ; close file<br> fc(fr)<br> endif</p> <p><strong>&gt;R</strong> </p> </blockquote> <hr> <h4>e-Paper 29 Display with SGP30 and BME280</h4> <p>Some variables are set from ioBroker </p> <blockquote> <p><strong>&gt;D</strong><br> hum=0<br> temp=0<br> press=0<br> ahum=0<br> tvoc=0<br> eco2=0<br> zwz=0<br> wr1=0<br> wr2=0<br> wr3=0<br> otmp=0<br> pwl=0<br> tmp=0<br> ; DisplayText substituted to save script space DT="DisplayText"<br> ; preset units in case they are not available <br> punit="hPa"<br> tunit="C"</p> <p><strong>&gt;B</strong><br> ;reset auto draw<br> =&gt;%DT% [zD0]<br> ;clr display and draw a frame<br> =&gt;%DT% [x0y20h296x0y40h296]</p> <p><strong>&gt;T</strong><br> ; get telemetry sensor values<br> temp=BME280#Temperature<br> hum=BME280#Humidity<br> press=BME280#Pressure<br> tvoc=SGP30#TVOC<br> eco2=SGP30#eCO2<br> ahum=SGP30#aHumidity<br> tunit=TempUnit<br> punit=PressureUnit</p> <p><strong>&gt;S</strong><br> // update display every <a href=../Commands/#teleperiod><code>TelePeriod</code></a><br> if upsecs%tper==0<br> then<br> dp2<br> =&gt;%DT% [f1p7x0y5]%temp% %tunit%<br> =&gt;%DT% [p5x70y5]%hum% %%[x250y5t] <br> =&gt;%DT% [p11x140y5]%press% %punit%<br> =&gt;%DT% [p10x30y25]TVOC: %tvoc% ppb<br> =&gt;%DT% [p10x160y25]eCO2: %eco2% ppm<br> =&gt;%DT% [p10c26l5]ahum: %ahum% g^m3</p> <p>dp0<br> =&gt;%DT% [p25c1l5]WR 1 (Dach) : %wr1% W<br> =&gt;%DT% [p25c1l6]WR 2 (Garage): %-wr3% W<br> =&gt;%DT% [p25c1l7]WR 3 (Garten): %-wr2% W<br> =&gt;%DT% [p25c1l8]Aussentemperatur: %otmp% C<br> =&gt;%DT% [x170y95r120:30f2p6x185y100] %pwl% %%<br> ; now update screen<br> =&gt;%DT% [d]<br> endif</p> <p><strong>&gt;E</strong> </p> <p><strong>&gt;R</strong> </p> </blockquote> <hr> <h4>e-Paper 42 Display with SHT31 and BME280</h4> <p>This script shows 2 graphs on an 4.2 inch e-Paper display: 1. some local sensors, and 2. power statistics<br> - The first graph is the battery level of a solar battery (Tesla PowerWall 2)<br> - The second graph shows the solar yield of the roof panels in Watts<br> - Another special feature is that this script displays daily and weekly averages (via moving average) of all power IO of the house.<br> - Since the display is a full update panel it is updated only once a minute<br> - Some values (like power meters) are set remotely from ioBroker </p> <blockquote> <p><strong>&gt;D</strong><br> hum=0<br> temp=0<br> press=0<br> zwz=0<br> wr1=0<br> wr2=0<br> wr3=0<br> otmp=0<br> pwl=0<br> ez1=0<br> sez1=0<br> M:mez1=0 7<br> ezh=0<br> sezh=0<br> M:mezh=0 7<br> vzh=0<br> svzh=0<br> M:mvzh=0 7 </p> <p>hr=0<br> t1=0<br> ; DisplayText substituted to save script space DT="DisplayText" </p> <p><strong>&gt;B</strong><br> =&gt;%DT% [IzD0]<br> =&gt;%DT% [zG10352:5:40:-350:80:10080:0:100f3x360y40]100 %%[x360y115]0 %%<br> =&gt;%DT% [f1x100y25]Powerwall - 7 Tage[f1x360y75] 0 %%<br> =&gt;%DT% [G10353:5:140:-350:80:10080:0:5000f3x360y140]+5000 W[x360y215]0 W<br> =&gt;%DT% [f1x70y125]Volleinspeisung - 7 Tage[f1x360y180] 0 W<br> =&gt;%DT% [p13x10y230]WR 1,2,3:<br> =&gt;%DT% [p13x10y245]H-Einsp.:<br> =&gt;%DT% [p13x10y260]H-Verbr.:<br> =&gt;%DT% [p13x10y275]D-Einsp.:<br> =&gt;%DT% [d] </p> <p><strong>&gt;T</strong><br> press=BMP280#Pressure<br> temp=SHT3X_0x44#Temperature<br> hum=SHT3X_0x44#Humidity </p> <p><strong>&gt;S</strong><br> if upsecs%60==0<br> then<br> dp2<br> =&gt;%DT% [f1p7x0y5]%temp% C<br> =&gt;%DT% [x0y20h400x250y5T][x350t][f1p10x70y5]%hum% %%<br> =&gt;%DT% [p10x140y5]%press% hPa<br> dp0<br> =&gt;%DT% [p5x360y75]%pwl% %%<br> =&gt;%DT% [p6x360y180]%wr1%W<br> =&gt;%DT% [g0:%pwl%g1:%wr1%] </p> <p>=&gt;%DT% [p24x75y230] %wr1% W : %-wr2% W : %-wr3% W<br> =&gt;%DT% [p-10x75y245]%ezh% kWh<br> =&gt;%DT% [p-10x75y260]%vzh% kWh<br> =&gt;%DT% [p-10x75y275]%ez1% kWh </p> <p>t1=mezh<em>7<br> =&gt;%DT% [p-10x150y245]: %t1% kWh<br> t1=mvzh</em>7<br> =&gt;%DT% [p-10x150y260]: %t1% kWh<br> t1=mez1*7<br> =&gt;%DT% [p-10x150y275]: %t1% kWh </p> <p>dp1 t1=ezh-sezh<br> =&gt;%DT% [p12x250y245]: %t1% kWh<br> t1=vzh-svzh<br> =&gt;%DT% [p12x250y260]: %t1% kWh<br> t1=ez1-sez1<br> =&gt;%DT% [p12x250y275]: %t1% kWh </p> <p>dp0<br> =&gt;%DT% [f2p5x320y250] %otmp%C </p> <p>=&gt;%DT% [d]<br> endif </p> <p>hr=hours<br> if chg[hr]&gt;0<br> and hr==0<br> then<br> mez1=ez1-sez1<br> sez1=ez1<br> mezh=ezh-sezh<br> sezh=ezh<br> mvzh=vzh-svzh<br> svzh=vzh<br> endif </p> <p>if sezh==0<br> then<br> sez1=ez1<br> sezh=ezh<br> svzh=vzh<br> endif </p> </blockquote> <hr> <h4>ILI 9488 Color LCD Display with BMP280 and VL5310X</h4> <p>Shows various BMP280 energy graphs<br> Turn display on and off using VL5310X proximity sensor to prevent burn-in</p> <p>Some variables are set from ioBroker</p> <blockquote> <p><strong>&gt;D</strong><br> temp=0<br> press=0<br> zwz=0<br> wr1=0<br> wr2=0<br> wr3=0<br> otmp=0<br> pwl=0<br> tmp=0<br> dist=0<br> ; DisplayText substituted to save script space DT="DisplayText"<br> punit="hPa"<br> tunit="C"<br> hour=0</p> <p><strong>&gt;B</strong><br> =&gt;%DT% [z]</p> <p>// define 2 graphs, 2. has 3 tracks<br> =&gt;%DT% [zCi1G2656:5:20:400:80:1440:-5000:5000:3Ci7f3x410y20]+5000 W[x410y95]-5000 W [Ci7f1x70y3] Zweirichtungsz~80hler - 24 Stunden<br> =&gt;%DT% [Ci1G2657:5:120:400:80:1440:0:5000:3Ci7f3x410y120]+5000 W[x410y195]0 W [Ci7f1x70y103] Wechselrichter 1-3 - 24 Stunden<br> =&gt;%DT% [Ci1G2658:5:120:400:80:1440:0:5000:16][Ci1G2659:5:120:400:80:1440:0:5000:5]<br> =&gt;%DT% [f1s1b0:260:260:100&#8203;:50:2:11:4:2:Rel 1:b1:370:260:100&#8203;:50:2:11:4:2:Dsp off:]<br> =&gt;mp3volume 100<br> =&gt;mp3track 4</p> <p><strong>&gt;T</strong><br> ; get some telemetry values<br> temp=BMP280#Temperature<br> press=BMP280#Pressure<br> tunit=TempUnit<br> punit=PressureUnit<br> dist=VL53L0X#Distance</p> <p>; check proximity sensor to turn display on and off to prevent burn-in<br> if dist&gt;300<br> then<br> if pwr[2]&gt;0<br> then<br> =&gt;power2 0<br> endif<br> else<br> if pwr[2]==0<br> then<br> =&gt;power2 1<br> endif<br> endif</p> <p><strong>&gt;S</strong><br> ; update graph every teleperiod<br> if upsecs%tper==0<br> then<br> dp2<br> =&gt;%DT% [f1Ci3x40y260w30Ci1]<br> =&gt;%DT% [Ci7x120y220t]<br> =&gt;%DT% [Ci7x180y220T]<br> =&gt;%DT% [Ci7p8x120y240]%temp% %tunit% <br> =&gt;%DT% [Ci7x120y260]%press% %punit%<br> =&gt;%DT% [Ci7x120y280]%dist% mm<br> dp0<br> =&gt;%DT% [g0:%zwz%g1:%wr1%g2:%-wr2%g3:%-wr3%]<br> if zwz&gt;0<br> then<br> =&gt;%DT% [p-8x410y55Ci2Bi0]%zwz% W<br> else<br> =&gt;%DT% [p-8x410y55Ci3Bi0]%zwz% W<br> endif<br> =&gt;%DT% [p-8x410y140Ci3Bi0]%wr1% W<br> =&gt;%DT% [p-8x410y155Ci16Bi0]%-wr2% W<br> =&gt;%DT% [p-8x410y170Ci5Bi0]%-wr3% W<br> endif</p> <p>; chime every full hour<br> hour=int(time/60)<br> if chg[hour]&gt;0<br> then =&gt;mp3track 4<br> endif</p> <p><strong>&gt;E</strong> </p> <p><strong>&gt;R</strong> </p> </blockquote> <hr> <h4>LED Bar Display with WS2812 LED Chain</h4> <p>Used to display home's solar power input/output (+-5000 Watts)</p> <blockquote> <p><strong>&gt;D</strong><br> m:array=0 60 ;defines array for 60 led pixels<br> cnt=0<br> val=0<br> ind=0<br> ; rgb values for grid<br> colr1=0x050000<br> colr2=0x050100<br> colg1=0x000300<br> colg2=0x020300<br> ledbar=0<br> blue=64<br> pixels=60<br> steps=10<br> div=0<br> tog=0<br> max=5000<br> min=-5000<br> pos=0</p> <p><strong>&gt;B</strong><br> div=pixels/steps<br> =#prep<br> ws2812(array)</p> <p>; ledbar is set from broker </p> <p><strong>&gt;S</strong><br> if ledbar&lt;min<br> then ledbar=min<br> endif</p> <p>if ledbar&gt;max<br> then ledbar=max<br> endif</p> <p>pos=(ledbar/max)*(pixels/2)<br> if ledbar&gt;0<br> then<br> pos+=(pixels/2)<br> if pos&gt;pixels-1<br> then pos=pixels<br> endif<br> else<br> pos+=(pixels/2)+1<br> if pos&gt;pixels-1<br> then pos=1<br> endif<br> endif</p> <p>if pos&lt;1<br> or pos&gt;pixels<br> then pos=1<br> endif</p> <p>=#prep</p> <p>if ledbar==0<br> then<br> array[pos]=blue<br> array[pos-1]=blue<br> else<br> array[pos]=blue<br> endif</p> <p>; only used if power is off<br> ; so lets may be used normally if on<br> if pwr[1]==0<br> then<br> ws2812(array)<br> endif</p> <p>; subroutine for grid </p> </blockquote> <h1 id=prep>prep<a class=headerlink href=#prep title="Permanent link">~</a></h1> <p>for cnt 1 pixels 1<br> ind+=1<br> if ind&gt;div<br> then ind=1<br> tog^=1<br> endif</p> <blockquote> <p>if cnt&lt;=pixels/2<br> then<br> if tog&gt;0<br> then val=colr1<br> else val=colr2<br> endif<br> else<br> if tog&gt;0<br> then val=colg1<br> else val=colg2<br> endif<br> endif<br> array[cnt]=val<br> next</p> <p><strong>&gt;R</strong> </p> </blockquote> <hr> <h4>Multiple IR Receiver Synchronization</h4> <p>Shows how a Magic Home with IR receiver works<br> Synchronizes 2 Magic Home devices by also sending the commands to a second Magic Home via <a href=../Commands/#websend><code>WebSend</code></a></p> <p><strong>Script example using <code>if then else</code></strong> </p> <blockquote> <p>; expand default string length to be able to hold <code>WebSend [xxx.xxx.xxx.xxx]</code><br> <strong>&gt;D 25</strong><br> istr=""<br> ws="WebSend [<em>IP</em>]"</p> <p>; event section<br> <strong>&gt;E</strong><br> ; get ir data<br> istr=IrReceived#Data</p> <p>; on<br> if istr=="0x00F7C03F"<br> then<br> =&gt;wakeup<br> =&gt;%ws% wakeup<br> endif</p> <p>; off<br> if istr=="0x00F740BF"<br> then<br> =&gt;power1 0<br> =&gt;%ws% power1 0<br> endif</p> <p>;white<br> if istr=="0x00F7E01F"<br> then<br> =&gt;color 000000ff<br> =&gt;%ws% color 000000ff<br> endif</p> <p>;red<br> if istr=="0x00F720DF"<br> then<br> =&gt;color ff000000<br> =&gt;%ws% color ff000000<br> endif</p> <p>;green<br> if istr=="0x00F7A05F"<br> then<br> =&gt;color 00ff0000<br> =&gt;%ws% color 00ff0000<br> endif</p> <p>;blue<br> if istr=="0x00F7609F"<br> then<br> =&gt;color 0000ff00<br> =&gt;%ws% color 0000ff00<br> endif</p> <p>; dimmer up<br> if istr=="0x00F700FF"<br> then<br> =&gt;dimmer +<br> =&gt;%ws% dimmer +<br> endif</p> <p>;dimmer down<br> if istr=="0x00F7807F"<br> then<br> =&gt;dimmer -<br> =&gt;%ws% dimmer -<br> endif</p> <p>istr=""</p> </blockquote> <p><strong>Script example using <code>switch case ends</code></strong> </p> <blockquote> <p>; expand default string length to be able to hold <code>WebSend [xxx.xxx.xxx.xxx]</code><br> <strong>&gt;D</strong> 25<br> istr=""<br> ws="WebSend [<em>IP</em>]" </p> <p>; event section<br> <strong>&gt;E</strong><br> ; get ir data<br> istr=IrReceived#Data </p> <p>switch istr<br> ; on<br> case "0x00F7C03F"<br> =&gt;wakeup<br> =&gt;%ws% wakeup </p> <p>;off<br> case "0x00F740BF"<br> =&gt;power1 0<br> =&gt;%ws% power1 0 </p> <p>;white<br> case "0x00F7E01F"<br> =&gt;color 000000ff<br> =&gt;%ws% color 000000ff </p> <p>;red<br> case "0x00F720DF"<br> =&gt;color ff000000<br> =&gt;%ws% color ff000000 </p> <p>;green<br> case "0x00F7A05F"<br> =&gt;color 00ff0000<br> =&gt;%ws% color 00ff0000 </p> <p>;blue<br> case "0x00F7609F"<br> =&gt;color 0000ff00<br> =&gt;%ws% color 0000ff00 </p> <p>; dimmer up<br> case "0x00F700FF"<br> =&gt;dimmer +<br> =&gt;%ws% dimmer + </p> <p>; dimmer down<br> case "0x00F7807F"<br> =&gt;dimmer -<br> =&gt;%ws% dimmer -<br> ends </p> <p>istr="" </p> </blockquote> <hr> <h4>Fast Polling</h4> <blockquote> <p>; expand default string length to be able to hold <code>WebSend [xxx.xxx.xxx.xxx]</code><br> <strong>&gt;D 25</strong><br> sw=0<br> ws="WebSend [<em>IP</em>]"<br> timer=0<br> hold=0<br> toggle=0</p> <p><strong>&gt;B</strong><br> ; gpio 5 button input<br> spinm(5,0)</p> <p>; fast section 100ms<br> <strong>&gt;F</strong><br> sw=pin[5]<br> ; 100 ms timer<br> timer+=1</p> <p>; 3 seconds long press<br> ; below 0,5 short press<br> if sw==0<br> and timer&gt;5<br> and timer&lt;30<br> then<br> ; short press<br> ;=&gt;print short press<br> toggle^=1<br> =&gt;%ws% power1 %toggle%<br> endif</p> <p>if sw&gt;0<br> then<br> ;pressed<br> if timer&gt;30<br> then<br> ; hold<br> hold=1<br> ;=&gt;print hold=%timer%<br> if toggle&gt;0<br> then<br> =&gt;%ws% dimmer +<br> else<br> =&gt;%ws% dimmer -<br> endif<br> endif<br> else<br> timer=0<br> hold=0<br> endif</p> </blockquote> <hr> <h4>Switching and Dimming By Recognizing Mains Power Frequency</h4> <p>Switching in Tasmota is usually done by High/Low (+3.3V/GND) changes on a GPIO. However, for devices like the <a href=https://templates.blakadder.com/qs-wifi_D01_dimmer.html>Moes QS-WiFi-D01 Dimmer</a>, this is achieved by a pulse frequency when connected to the GPIO, and these pulses are captured by <code>Counter1</code> in Tasmota. <img alt=pushbutton-input src=https://user-images.githubusercontent.com/36734573/61955930-5d90e480-afbc-11e9-8d7e-00ac526874d3.png></p> <ul> <li>When the <strong>light is OFF</strong> and there is a <strong>short period</strong> of pulses <strong>-&gt;</strong> then turn the light <strong>ON</strong> at the previous dimmer level.</li> <li>When the <strong>light is ON</strong> and there is a <strong>short period</strong> of pulses <strong>-&gt;</strong> then turn the light <strong>OFF</strong>.</li> <li>When there is a longer period of pulses (i.e., <strong>HOLD</strong>) <strong>-&gt;</strong> toggle dimming direction and then adjust the brightness level as long as the button is pressed or until the limits are reached.</li> </ul> <p><a href=https://github.com/arendst/Tasmota/issues/6085#issuecomment-512353010>#6085 (comment)</a></p> <p>In the Data Section &gt;D at the beginning of the Script the following initialization variables may be changed: - dim multiplier - 0..2.55 set the dimming increment value - dim lower limit - range for the dimmer value for push-button operation (set according to your bulb); min 0 - dim upper limit - range for the dimmer value for push-button operation (set according to your bulb); max 100 - start dim level - initial dimmer level after power-up or restart; max 100</p> <blockquote> <p><strong>&gt;D</strong><br> sw=0<br> tmp=0<br> cnt=0<br> tmr=0<br> hold=0<br> powert=0<br> slider=0<br> dim=""<br> shortprl=2 ;short press lo limit<br> shortpru=10;short press up limit<br> dimdir=0 ;dim direction 0/1<br> dimstp=2 ;dim step/speed 1 to 5<br> dimmlp=2.2 ;dim multiplier<br> dimll=15 ;dim lower limit<br> dimul=95 ;dim upper limit<br> dimval=70 ;start dim level </p> <p><strong>&gt;B</strong><br> =&gt;print "WiFi-Dimmer-Script-v0.2"<br> =&gt;Counter1 0<br> =&gt;Baudrate 9600<br> ; boot sequence<br> =#senddim(dimval)<br> delay(1000)<br> =#senddim(0) </p> <p><strong>&gt;F</strong><br> cnt=pc[1]<br> if chg[cnt]&gt;0<br> ; sw pressed<br> then sw=1<br> else sw=0<br> ; sw not pressed<br> endif </p> <p>; 100ms timer<br> tmr+=1 </p> <p>; short press<br> if sw==0<br> and tmr&gt;shortprl<br> and tmr&lt;shortpru<br> then<br> powert^=1 </p> <p>; change light on/off<br> if powert==1<br> then<br> =#senddim(dimval)<br> else<br> =#senddim(0)<br> endif<br> endif </p> <p>; long press<br> if sw&gt;0<br> then<br> if hold==0<br> then </p> <p>; change dim direction<br> dimdir^=1<br> endif<br> if tmr&gt;shortpru<br> then<br> hold=1<br> if powert&gt;0 </p> <p>; dim when on &amp; hold<br> then<br> if dimdir&gt;0<br> then </p> <p>; increase dim level<br> dimval+=dimstp<br> if dimval&gt;dimul<br> then </p> <p>; upper limit<br> dimval=dimul<br> endif<br> =#senddim(dimval)<br> else </p> <p>; decrease dim level<br> dimval-=dimstp<br> if dimval&lt;dimll<br> then </p> <p>; lower limit<br> dimval=dimll<br> endif<br> =#senddim(dimval)<br> endif<br> endif<br> endif<br> else<br> tmr=0<br> hold=0<br> endif </p> <p><strong>&gt;E</strong><br> slider=Dimmer </p> <p>; slider change<br> if chg[slider]&gt;0<br> then </p> <p>; dim according slider<br> if slider&gt;0<br> then<br> dimval=slider<br> =#senddim(dimval)<br> else<br> powert=0<br> =#senddim(0)<br> endif<br> endif </p> <p>if pwr[1]==1<br> ; on/off webui<br> then<br> powert=1<br> =#senddim(dimval)<br> else<br> powert=0<br> =#senddim(0)<br> endif </p> <p>; subroutine dim </p> </blockquote> <h1 id=senddimtmp>senddim(tmp)<a class=headerlink href=#senddimtmp title="Permanent link">~</a></h1> <p>dim="FF55"+hn(tmp*dimmlp)+"05DC0A"<br> =&gt;SerialSend5 %dim%<br> =&gt;Dimmer %tmp%<br> # </p> <hr> <h4>Web UI</h4> <p>An example to show how to implement a web UI. This example controls a light via <code>WebSend</code> </p> <blockquote> <p><strong>&gt;D</strong><br> dimmer=0<br> sw=0<br> color=""<br> col1=""<br> red=0<br> green=0<br> blue=0<br> ww=0 </p> <p><strong>&gt;F</strong><br> color=hn(red)+hn(green)+hn(blue)+hn(ww)<br> if color!=col1<br> then<br> col1=color<br> =&gt;websend [192.168.178.75] color %color%<br> endif </p> <p>if chg[dimmer]&gt;0<br> then<br> =&gt;websend [192.168.178.75] dimmer %dimmer%<br> endif </p> <p>if chg[sw]&gt;0<br> then<br> =&gt;websend [192.168.178.75] power1 %sw%<br> endif </p> <p><strong>&gt;W</strong><br> bu(sw "Light on" "Light off")<br> ck(sw "Light on/off   ")<br> sl(0 100 dimmer "0" "Dimmer" "100")<br> sl(0 255 red "0" "red" "255")<br> sl(0 255 green "0" "green" "255")<br> sl(0 255 blue "0" "blue" "255")<br> sl(0 255 ww "0" "warm white" "255")<br> tx(color "color:   ") </p> </blockquote> <hr> <h4>Hue Emulation</h4> <p>An example to show how to respond to Alexa requests via Hue Emulation</p> <p>When Alexa sends on/off, dimmer, and color (via hsb), send commands to a MagicHome device</p> <blockquote> <p><strong>&gt;D</strong><br> pwr1=0<br> hue1=0<br> sat1=0<br> bri1=0<br> tmp=0 </p> <p><strong>&gt;E</strong><br> if upd[hue1]&gt;0<br> or upd[sat1]&gt;0<br> or upd[bri1]&gt;0<br> then<br> tmp=hue1/182<br> -&gt;websend [192.168.178.84] hsbcolor %tmp%,%sat1%,%bri1%<br> endif </p> <p>if upd[pwr1]&gt;0<br> then<br> -&gt;websend [192.168.178.84] power1 %pwr1%<br> endif </p> <p><strong>&gt;H</strong><br> ; on,hue,sat,bri,ct<br> livingroom,E,on=pwr1,hue=hue1,sat=sat1,bri=bri1 </p> </blockquote> <hr> <h4>Alexa Controlled MCP230xx I<sup>2</sup>C GPIO Expander</h4> <p>Uses Tasmota's Hue Emulation capabilities for Alexa interface</p> <blockquote> <p>; define vars<br> <strong>&gt;D</strong><br> p:p1=0<br> p:p2=0<br> p:p3=0<br> p:p4=0 </p> <p>; init ports<br> <strong>&gt;B</strong><br> -&gt;sensor29 0,5,0<br> -&gt;sensor29 1,5,0<br> -&gt;sensor29 2,5,0<br> -&gt;sensor29 3,5,0<br> -&gt;sensor29 0,%0p1%<br> -&gt;sensor29 1,%0p2%<br> -&gt;sensor29 2,%0p3%<br> -&gt;sensor29 3,%0p4% </p> <p>; define Alexa virtual devices<br> <strong>&gt;H</strong><br> port1,S,on=p1<br> port2,S,on=p2<br> port3,S,on=p3<br> port4,S,on=p4 </p> <p>; handle events<br> <strong>&gt;E</strong><br> print EVENT </p> <p>if upd[p1]&gt;0<br> then<br> -&gt;sensor29 0,%0p1%<br> endif<br> if upd[p2]&gt;0<br> then<br> -&gt;sensor29 1,%0p2%<br> endif<br> if upd[p3]&gt;0<br> then<br> -&gt;sensor29 2,%0p3%<br> endif<br> if upd[p4]&gt;0<br> then<br> -&gt;sensor29 3,%0p4%<br> endif </p> <p>=#pub </p> <p>; publish routine </p> </blockquote> <h1 id=pub>pub<a class=headerlink href=#pub title="Permanent link">~</a></h1> <p>=&gt;publish stat/%topic%/RESULT {"MCP23XX":{"p1":%0p1%,"p2":%0p2%,"p3":%0p3%,"p4":%0p4%}}<br> svars </p> <blockquote> <p>; web interface<br> <strong>&gt;W</strong><br> bu(p1 "p1 on" "p1 off")bu(p2 "p2 on" "p2 off")bu(p3 "p3 on" "p3 off")bu(p4 "p4 on" "p4 off") </p> </blockquote> <hr> <h4>Retrieve network gateway IP Address</h4> <blockquote> <p><strong>&gt;D</strong><br> gw="" </p> <p>; Request Status information. The response will trigger the <code>&gt;U</code> section<br> <strong>&gt;B</strong><br> +&gt;status 5 </p> <p>; Read the status JSON payload<br> <strong>&gt;U</strong><br> gw=StatusNET#Gateway<br> print %gw% </p> </blockquote> <hr> <h4>Send e-mail</h4> <blockquote> <p><strong>&gt;D 25</strong><br> day1=0<br> et=0<br> to="mrx@gmail.com"</p> <p><strong>&gt;T</strong><br> et=ENERGY#Total </p> <p><strong>&gt;S</strong><br> ; send at midnight<br> day1=day<br> if chg[day1]&gt;0<br> then<br> =&gt;sendmail [*:*:*:*:*:\%to\%:energy report]*<br> endif </p> <p><strong>&gt;m</strong><br> email report at %tstamp%<br> your power consumption today was %et% KWh<br> # </p> </blockquote> <hr> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M297.216 243.2c0 15.616-11.52 28.416-26.112 28.416-14.336 0-26.112-12.8-26.112-28.416s11.52-28.416 26.112-28.416c14.592 0 26.112 12.8 26.112 28.416zm-119.552-28.416c-14.592 0-26.112 12.8-26.112 28.416s11.776 28.416 26.112 28.416c14.592 0 26.112-12.8 26.112-28.416.256-15.616-11.52-28.416-26.112-28.416zM448 52.736V512c-64.494-56.994-43.868-38.128-118.784-107.776l13.568 47.36H52.48C23.552 451.584 0 428.032 0 398.848V52.736C0 23.552 23.552 0 52.48 0h343.04C424.448 0 448 23.552 448 52.736zm-72.96 242.688c0-82.432-36.864-149.248-36.864-149.248-36.864-27.648-71.936-26.88-71.936-26.88l-3.584 4.096c43.52 13.312 63.744 32.512 63.744 32.512-60.811-33.329-132.244-33.335-191.232-7.424-9.472 4.352-15.104 7.424-15.104 7.424s21.248-20.224 67.328-33.536l-2.56-3.072s-35.072-.768-71.936 26.88c0 0-36.864 66.816-36.864 149.248 0 0 21.504 37.12 78.08 38.912 0 0 9.472-11.52 17.152-21.248-32.512-9.728-44.8-30.208-44.8-30.208 3.766 2.636 9.976 6.053 10.496 6.4 43.21 24.198 104.588 32.126 159.744 8.96 8.96-3.328 18.944-8.192 29.44-15.104 0 0-12.8 20.992-46.336 30.464 7.68 9.728 16.896 20.736 16.896 20.736 56.576-1.792 78.336-38.912 78.336-38.912z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.23350dc5.min.js></script> <script src=../assets/javascripts/bundle.36a8f969.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.3bc815f0.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>